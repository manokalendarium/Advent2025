<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mama Kalend√°riuma 2025</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --accent: #66ccff;
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --luxury-red: #80001a;
            --glass: rgba(20, 20, 30, 0.6);
            --glass-border: rgba(255, 255, 255, 0.15);
            --msg-me: #007aff;
            --msg-them: rgba(255, 255, 255, 0.1);
        }

        body { 
            margin: 0; font-family: 'Nunito', sans-serif; 
            background: #050515; color: white; overflow: hidden; height: 100vh; 
        }
        
        /* AURORA H√ÅTT√âR */
        .aurora-bg { position: absolute; width: 100%; height: 100%; z-index: -1; overflow: hidden; background: radial-gradient(circle at 50% 100%, #1a0b2e, #000); }
        .orb { position: absolute; border-radius: 50%; filter: blur(90px); opacity: 0.5; animation: float 10s infinite alternate; }
        
        @keyframes float { from { transform: translate(0,0); } to { transform: translate(30px, 50px); } }

        /* H√ìES√âS */
        .snowflake { position: absolute; background: white; border-radius: 50%; animation: fall linear infinite; pointer-events: none; }
        @keyframes fall { to { transform: translateY(105vh); } }

        /* ELRENDEZ√âS */
        #root { height: 100%; }
        .app-container { display: flex; flex-direction: column; height: 100%; max-width: 600px; margin: 0 auto; padding: 20px; box-sizing: border-box; position: relative; }

        /* FEJL√âC */
        header { text-align: center; margin-bottom: 15px; margin-top: 10px; }
        h1 { margin: 0; font-weight: 900; font-size: 28px; background: linear-gradient(45deg, #cca43b, #ffd700); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-shadow: 0 0 20px rgba(255, 215, 0, 0.3); }
        .countdown { font-family: monospace; font-size: 12px; color: var(--accent); background: rgba(0,0,0,0.6); padding: 6px 12px; border-radius: 12px; margin-top: 8px; display: inline-block; border: 1px solid var(--glass-border); }

        /* NAPT√ÅR R√ÅCS */
        .grid {
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px;
            overflow-y: auto; padding: 15px;
            background: var(--glass); border: 1px solid var(--glass-border); border-radius: 24px;
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            scrollbar-width: none; flex-grow: 1;
        }
        .grid::-webkit-scrollbar { display: none; }

        .day-cell {
            aspect-ratio: 1;
            background: rgba(255,255,255,0.03);
            border-radius: 18px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            font-weight: bold; font-size: 22px; color: white;
            border: 1px solid rgba(255,255,255,0.05);
            transition: all 0.2s; cursor: pointer; position: relative;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        .day-cell:active { transform: scale(0.95); }
        .day-cell.unlocked { border-color: var(--accent); background: rgba(102, 204, 255, 0.15); box-shadow: 0 0 15px rgba(102, 204, 255, 0.3); color: var(--accent); }
        .day-cell.locked { opacity: 0.5; color: #777; background: rgba(50,0,0,0.3); border-color: rgba(255,0,0,0.2); }
        .lock-icon { font-size: 12px; margin-top: 5px; opacity: 0.6; }
        .gift-icon { font-size: 28px; }

        /* ALS√ì S√ÅV */
        .bottom-bar { margin-top: 15px; display: flex; justify-content: center; }
        .msg-btn {
            background: var(--luxury-red); border: 1px solid rgba(255, 215, 0, 0.3);
            color: #ffe6a0; padding: 14px 30px; border-radius: 25px; font-weight: bold; cursor: pointer;
            display: flex; align-items: center; gap: 10px; font-size: 16px;
            box-shadow: 0 5px 20px rgba(128, 0, 26, 0.4); transition: transform 0.1s;
            position: relative;
        }
        .msg-btn:active { transform: scale(0.95); }
        .badge { background: red; color: white; font-size: 10px; width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; position: absolute; top: -5px; right: -5px; border: 2px solid #fff; }

        /* √âRTES√çT√âS */
        .notification-container {
            position: absolute; top: 10px; left: 10px; right: 10px;
            display: flex; flex-direction: column; gap: 10px;
            pointer-events: none; z-index: 200;
        }
        .notification {
            background: rgba(30, 30, 40, 0.95); backdrop-filter: blur(15px);
            padding: 15px; border-radius: 18px; border: 1px solid rgba(255,255,255,0.15);
            display: flex; gap: 12px; align-items: start;
            box-shadow: 0 10px 30px rgba(0,0,0,0.6);
            pointer-events: auto; cursor: pointer;
            animation: slideIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform-origin: top center;
        }
        @keyframes slideIn { from { transform: translateY(-50px) scale(0.9); opacity: 0; } to { transform: translateY(0) scale(1); opacity: 1; } }

        /* MODALOK (Story & Chat) */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7); backdrop-filter: blur(8px);
            z-index: 50; display: flex; align-items: center; justify-content: center;
            animation: fadeIn 0.3s;
        }
        .modal-content {
            width: 90%; max-width: 450px; background: #fffaf0; color: #333;
            border-radius: 24px; overflow: hidden; display: flex; flex-direction: column;
            box-shadow: 0 25px 50px rgba(0,0,0,0.5); border: 2px solid #cca43b;
            max-height: 80vh;
        }
        
        /* STORY VIEW */
        .story-header { background: var(--luxury-red); color: #ffe6a0; padding: 20px; text-align: center; font-size: 24px; font-family: 'Times New Roman', serif; font-weight: bold; }
        .story-body { padding: 25px; font-size: 18px; line-height: 1.6; overflow-y: auto; font-family: 'Times New Roman', serif; }
        .story-footer { padding: 20px; text-align: center; border-top: 1px solid rgba(0,0,0,0.1); background: #fffaf0; }
        .close-btn { width: 100%; padding: 12px; background: var(--luxury-red); color: white; border: none; border-radius: 12px; font-weight: bold; font-size: 16px; cursor: pointer; }

        /* CHAT VIEW */
        .chat-modal {
            width: 100%; height: 100%; max-width: 100%; max-height: 100%; background: #000;
            border-radius: 0; display: flex; flex-direction: column;
        }
        .chat-header {
            padding: 15px; background: rgba(20,20,20,0.9); border-bottom: 1px solid #333;
            display: flex; align-items: center; justify-content: space-between;
        }
        .chat-list {
            flex-grow: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px;
            background: radial-gradient(circle at center, #1a1a2e, #000);
        }
        .msg-group { display: flex; flex-direction: column; gap: 5px; }
        .date-label { text-align: center; font-size: 11px; color: #666; margin: 10px 0; }
        
        .msg { max-width: 75%; padding: 10px 14px; border-radius: 18px; font-size: 15px; line-height: 1.4; position: relative; word-wrap: break-word; }
        .msg.them { background: var(--msg-them); color: white; align-self: flex-start; border-bottom-left-radius: 4px; }
        .msg.me { background: var(--msg-me); color: white; align-self: flex-end; border-bottom-right-radius: 4px; }
        
        .chat-input-area {
            padding: 10px 15px; background: rgba(30,30,30,0.9); border-top: 1px solid #333;
            display: flex; gap: 10px; align-items: center;
        }
        .chat-input {
            flex-grow: 1; background: #333; border: none; color: white; padding: 10px 15px;
            border-radius: 20px; font-size: 16px; outline: none;
        }
        .send-btn {
            background: none; border: none; font-size: 24px; cursor: pointer; color: var(--accent);
        }
        .send-btn:disabled { color: #555; }

        /* TYPING INDICATOR */
        .typing { display: flex; gap: 4px; padding: 10px 15px; background: var(--msg-them); border-radius: 18px; width: fit-content; align-self: flex-start; border-bottom-left-radius: 4px; }
        .dot { width: 6px; height: 6px; background: #aaa; border-radius: 50%; animation: bounce 1.4s infinite ease-in-out both; }
        .dot:nth-child(1) { animation-delay: -0.32s; } .dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
        
        /* TESZT MEN√ú */
        .test-btn { position: absolute; top: 20px; left: 20px; font-size: 24px; opacity: 0.3; cursor: pointer; z-index: 10; }
        .test-panel { position: absolute; top: 60px; left: 20px; background: rgba(0,0,0,0.9); padding: 15px; border-radius: 15px; border: 1px solid #555; z-index: 200; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useLayoutEffect } = React;

        // ‚ö†Ô∏è API KULCS
        const API_KEY = "AIzaSyBSk3j5AAD4Gwge3pe5IUay8wQ5jqyFyPc";

        // --- ADATOK ---
        const characters = {
            hanna: { name: "Hanna", icon: "üéÄ", desc: "r√≥zsasz√≠n, gondoskod√≥ l√°ny v√≠zil√≥", style: "Kedves, any√°skod√≥, sok emojit haszn√°l." },
            herold: { name: "Herold", icon: "ü¶õ", desc: "lila, puf√≥k √©s fal√°nk v√≠zil√≥", style: "Vicces, √©hes, szeleburdi." },
            bucko: { name: "Buck√≥", icon: "üê≥", desc: "k√©k, b√°tor kis b√°lna", style: "B√°tor, lelkes, vizet emleget." }
        };

        const storyData = [
            { id: 1, title: "A nagy elutaz√°s", message: "A reggel k√∂d√∂sen indult... Papa √©s Mama elindultak. Herold coc√≥ az ablakban √°llt. 'Ne itasd az egereket!' ‚Äì mondta Hanna. Buck√≥ t√©sztasz≈±r≈ëvel a fej√©n tisztelgett.", char: "hanna", msgs: ["Szia Mama! ‚ù§Ô∏è Ne agg√≥dj √©rt√ºnk, nagyon √ºgyesek vagyunk itt otthon! Herold m√°r nem is s√≠r. Vigy√°zz magadra! Puszilunk!", "K√©sz√≠tettem neked egy kis csomagot az √∫tra. Haszn√°ld ezt a Mini k√©zkr√©met, hogy puha maradjon a kezed!"] },
            { id: 2, title: "Els≈ë este", message: "Furcsa csend. Buck√≥ a k√°dban aludt, mert hi√°nyzott neki a tenger. A t√∂bbiek a sz≈ënyegen kempingeztek. 'Ha bet√∂r≈ë j√∂n, csapkodni fogok!'", char: "bucko", msgs: ["Jelentem: a h√°z biztons√°gos! A f√ºrd≈ëk√°dban alszom, onnan mindent hallok. üê≥", "Hogy te is nyugodtan aludj, k√ºld√∂k neked egy kis Levendul√°s p√°rnapermentet. Sz√©p √°lmokat!"] },
            { id: 3, title: "Palacsinta party", message: "Hanna f≈ëz√∂tt. Lila fest√©k ker√ºlt a t√©szt√°ba. Az els≈ë palacsinta a plafonra ragadt. Buck√≥ s√≥sat k√©rt, de spen√≥tos lett.", char: "herold", msgs: ["Bocsi a konyh√°√©rt... üòÖ Kicsit lila lett a plafon, de finom volt!", "Itt egy Arcmaszk neked, hogy te is sz√©p√ºlj, ha m√°r mi maszatosak vagyunk!"] },
            // ... 24 napig gener√°ljuk (r√∂vid√≠tve a p√©lda kedv√©√©rt, de m≈±k√∂dik minddel)
        ];

        // Placeholderek 24-ig
        for(let i=storyData.length + 1; i<=24; i++) {
            storyData.push({ id: i, title: `${i}. Nap`, message: "M√©g k√©sz√ºl a t√∂rt√©net...", char: "hanna", msgs: ["Szia! M√©g nem √≠rtam meg a mai napot.", "De itt egy kis szeretet csomag!"] });
        }

        // --- GEMINI AI SERVICE ---
        async function callGemini(userMessage, characterKey, context) {
            const char = characters[characterKey];
            const prompt = `
            Te vagy ${char.name}, egy ${char.desc}.
            A gazd√°dnak, 'Mam√°nak' √≠rsz chat √ºzenetet. St√≠lusod: ${char.style}.
            A mai nap esem√©nye: ${context}.
            V√°laszolj a Mam√°nak erre: "${userMessage}".
            Legy√©l r√∂vid (max 2 mondat), kedves √©s vicces. K√∂sz√∂nj el a v√©g√©n, mert dolgod van.
            `;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });
                const data = await response.json();
                return data.candidates[0].content.parts[0].text;
            } catch (e) {
                console.error(e);
                return "H√∫, tele a sz√°m bejglivel, nem tudok besz√©lni! üéÑ (Nincs net)";
            }
        }

        // --- F≈ê APP KOMPONENS ---
        function App() {
            const [unlockedDays, setUnlockedDays] = useState([]); // [1, 2]
            const [chatHistory, setChatHistory] = useState({}); // { 1: [{text:..., isMe: false}, ...], ... }
            const [activeModal, setActiveModal] = useState(null); // 'story' | 'chat'
            const [currentDay, setCurrentDay] = useState(null); // A megnyitott nap objektuma
            const [notifications, setNotifications] = useState([]);
            const [unreadCount, setUnreadCount] = useState(0);
            const [testMode, setTestMode] = useState(false);
            const [showTestMenu, setShowTestMenu] = useState(false);
            const [countdown, setCountdown] = useState("Sz√°mol√°s...");
            const [typingDay, setTypingDay] = useState(null); // Melyik napn√°l √≠r √©pp az AI
            const [inputValue, setInputValue] = useState("");

            const chatEndRef = useRef(null);

            // Bet√∂lt√©s
            useEffect(() => {
                const savedDays = JSON.parse(localStorage.getItem('openedDays')) || [];
                const savedChats = JSON.parse(localStorage.getItem('chatHistory2')) || {};
                setUnlockedDays(savedDays);
                setChatHistory(savedChats);
                
                // Egyszer≈±s√≠tett unread logika: ha van nyitott nap
                setUnreadCount(savedDays.length > 0 ? 1 : 0);
            }, []);

            // Visszasz√°ml√°l√≥
            useEffect(() => {
                const t = setInterval(() => {
                    const target = new Date("Dec 24, 2025 18:00:00").getTime();
                    const diff = target - new Date().getTime();
                    if (diff > 0) {
                        const d = Math.floor(diff / (1000 * 60 * 60 * 24));
                        const h = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                        const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                        setCountdown(`M√©g ${d} nap ${h} √≥ra ${m} perc`);
                    } else setCountdown("BOLDOG KAR√ÅCSONYT!");
                }, 1000);
                return () => clearInterval(t);
            }, []);

            // Auto scroll chat
            useLayoutEffect(() => {
                chatEndRef.current?.scrollIntoView({ behavior: "smooth" });
            }, [chatHistory, activeModal, typingDay]);

            // √ârtes√≠t√©s kezel≈ë
            const triggerNotification = (name, msg, icon) => {
                const id = Date.now();
                setNotifications(prev => [{id, name, msg, icon}, ...prev]);
                // Hang
                // new Audio('notification.mp3').play().catch(()=>{}); 
                setTimeout(() => {
                    setNotifications(prev => prev.filter(n => n.id !== id));
                }, 6000);
            };

            // Nap nyit√°sa
            const handleDayClick = (day) => {
                const today = new Date().getDate();
                // √âlesben: new Date().getMonth() === 11 && day.id <= today
                const isAvailable = testMode || day.id <= today; 
                
                if (isAvailable) {
                    // Ha m√©g nem nyitottuk ki
                    if (!unlockedDays.includes(day.id)) {
                        const newUnlocked = [...unlockedDays, day.id];
                        setUnlockedDays(newUnlocked);
                        localStorage.setItem('openedDays', JSON.stringify(newUnlocked));
                        
                        // Chat inicializ√°l√°s az alap √ºzenetekkel
                        const initialMsgs = day.msgs.map(m => ({ text: m, isMe: false }));
                        const newChats = { ...chatHistory, [day.id]: initialMsgs };
                        setChatHistory(newChats);
                        localStorage.setItem('chatHistory2', JSON.stringify(newChats));
                        
                        setUnreadCount(prev => prev + 1);
                        
                        // √ârtes√≠t√©sek l√°ncol√°sa
                        const char = characters[day.char];
                        triggerNotification(char.name, day.msgs[0], char.icon);
                        setTimeout(() => {
                            triggerNotification(char.name, day.msgs[1], "üéÅ");
                        }, 5000);
                    }
                    
                    setCurrentDay(day);
                    setActiveModal('story');
                } else {
                    // Dorg√°l√°s
                    const scolds = ["M√©g nem szabad! ü§´", "Ez m√©g alszik! üò¥", "Ejnye-bejnye! üëÄ", "V√°rj t√ºrelmesen! üéÑ"];
                    triggerNotification("Rendszer", scolds[Math.floor(Math.random()*scolds.length)], "üîí");
                }
            };

            // √úzenetk√ºld√©s
            const handleSendMessage = async () => {
                if (!inputValue.trim() || !currentDay) return;
                const text = inputValue;
                setInputValue("");
                
                // 1. User √ºzenet ment√©se
                const dayId = currentDay.id;
                const newMsg = { text, isMe: true };
                const updatedHistory = { ...chatHistory, [dayId]: [...(chatHistory[dayId] || []), newMsg] };
                setChatHistory(updatedHistory);
                localStorage.setItem('chatHistory2', JSON.stringify(updatedHistory));
                
                // 2. AI Gondolkodik
                setTypingDay(dayId);
                
                // 3. AI H√≠v√°s
                const charKey = currentDay.char;
                const context = `Mese: ${currentDay.message}. Aj√°nd√©k amit kapott: ${currentDay.msgs[1]}`;
                const aiResponseText = await callGemini(text, charKey, context);
                
                // 4. V√°lasz ment√©se
                const aiMsg = { text: aiResponseText, isMe: false };
                const finalHistory = { ...updatedHistory, [dayId]: [...updatedHistory[dayId], aiMsg] };
                
                setTypingDay(null);
                setChatHistory(finalHistory);
                localStorage.setItem('chatHistory2', JSON.stringify(finalHistory));
            };

            // Chat megnyit√°sa (√ñsszes√≠tett n√©zet helyett az aktu√°lis napra f√≥kusz√°lhatunk, 
            // vagy list√°zhatjuk a karaktereket. Most a Swift logika alapj√°n a karakterek list√°ja)
            const openChatList = () => {
                setUnreadCount(0);
                setActiveModal('chatList');
            };
            
            const openChatDetail = (charKey) => {
                // Megkeress√ºk az utols√≥ olyan napot, ami ehhez a karakterhez tartozik √©s nyitva van
                const relevantDays = unlockedDays
                    .map(id => storyData.find(d => d.id === id))
                    .filter(d => d.char === charKey)
                    .sort((a,b) => a.id - b.id);
                    
                if (relevantDays.length > 0) {
                    // Egyben mutatjuk az √∂sszes besz√©lget√©st ezzel a karakterrel
                    setActiveModal('chatDetail');
                    // Be√°ll√≠tjuk a 'currentDay'-t a legutols√≥ra, hogy tudjuk kinek √≠runk
                    setCurrentDay(relevantDays[relevantDays.length-1]); 
                }
            };

            // RESET
            const fullReset = () => {
                localStorage.clear();
                location.reload();
            };

            return (
                <div className="app-container">
                    {/* TESZT MEN√ú */}
                    <div className="test-btn" onClick={() => setShowTestMenu(!showTestMenu)}>‚öôÔ∏è</div>
                    {showTestMenu && (
                        <div className="test-panel">
                            <h3>Teszt Panel</h3>
                            <label><input type="checkbox" checked={testMode} onChange={e => setTestMode(e.target.checked)} /> Teszt M√≥d (Nyitva)</label>
                            <br /><br />
                            <button onClick={fullReset} style={{background:'red', color:'white', border:'none', padding:'5px', borderRadius:'5px'}}>üóëÔ∏è RESET</button>
                        </div>
                    )}

                    {/* H√ÅTT√âR */}
                    <div className="aurora-bg">
                        <div className="orb orb-1"></div>
                        <div className="orb orb-2"></div>
                        <div className="orb orb-3"></div>
                    </div>
                    <div id="snow-container">
                        {[...Array(50)].map((_, i) => (
                            <div key={i} className="snowflake" style={{
                                left: Math.random()*100+'%', 
                                animationDuration: (Math.random()*3+2)+'s', 
                                width: (Math.random()*4+2)+'px', height: (Math.random()*4+2)+'px',
                                animationDelay: Math.random()*5+'s'
                            }}></div>
                        ))}
                    </div>

                    {/* TARTALOM */}
                    <header>
                        <h1>MAMA KALEND√ÅRIUMA</h1>
                        <div className="countdown">{countdown}</div>
                    </header>

                    <div className="grid">
                        {storyData.map(day => {
                             const isUnlocked = unlockedDays.includes(day.id);
                             const isAvailable = testMode || day.id <= new Date().getDate();
                             return (
                                <div key={day.id} 
                                     className={`day-cell ${isUnlocked ? 'unlocked' : (isAvailable ? '' : 'locked')}`}
                                     onClick={() => handleDayClick(day)}>
                                    {isUnlocked ? <div className="gift-icon">üéÅ</div> : <div>{day.id}</div>}
                                    {!isUnlocked && !isAvailable && <div className="lock-icon">üîí</div>}
                                </div>
                             );
                        })}
                    </div>

                    <div className="bottom-bar">
                        <div className="msg-btn" onClick={openChatList}>
                            üí¨ √úzenetek
                            {unreadCount > 0 && <div className="badge">{unreadCount}</div>}
                        </div>
                    </div>

                    {/* √âRTES√çT√âSEK STACK */}
                    <div className="notification-container">
                        {notifications.map(n => (
                            <div key={n.id} className="notification" onClick={openChatList}>
                                <div style={{fontSize: '24px'}}>{n.icon}</div>
                                <div>
                                    <div style={{fontWeight: 'bold', marginBottom: '2px'}}>{n.name} <span style={{fontSize:'10px', color:'#aaa', fontWeight:'normal'}}>Most</span></div>
                                    <div style={{fontSize: '12px', opacity: 0.8}}>{n.msg}</div>
                                </div>
                            </div>
                        ))}
                    </div>

                    {/* MESE MODAL */}
                    {activeModal === 'story' && currentDay && (
                        <div className="modal-overlay" onClick={() => setActiveModal(null)}>
                            <div className="modal-content" onClick={e => e.stopPropagation()}>
                                <div className="story-header">üìú {currentDay.title}</div>
                                <div className="story-body">
                                    {currentDay.message}
                                </div>
                                <div className="story-footer">
                                    <div style={{color: 'var(--accent)', fontStyle: 'italic', marginBottom: '10px'}}>üí° Nyisd meg az √ºzeneteket!</div>
                                    <button className="close-btn" onClick={() => setActiveModal(null)}>Bez√°r√°s</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* CHAT LISTA MODAL */}
                    {activeModal === 'chatList' && (
                        <div className="modal-overlay" onClick={() => setActiveModal(null)}>
                            <div className="modal-content chat-modal" onClick={e => e.stopPropagation()}>
                                <div className="chat-header">
                                    <span style={{fontWeight:'bold', fontSize:'18px'}}>√úzenetek</span>
                                    <button onClick={() => setActiveModal(null)} style={{background:'none',border:'none',color:'var(--accent)',fontSize:'16px'}}>Bez√°r√°s</button>
                                </div>
                                <div className="chat-list" style={{padding:0}}>
                                    {['herold', 'hanna', 'bucko'].map(key => {
                                        const char = characters[key];
                                        // Keress√ºk a legutols√≥ √ºzenetet ett≈ël a karaktert≈ël
                                        // Sz≈±rj√ºk a storyData-t azokra a napokra, amik nyitva vannak √©s ehhez a karakterhez tartoznak
                                        const relevantDays = unlockedDays.map(id => storyData.find(d => d.id === id)).filter(d => d.char === key).sort((a,b) => a.id - b.id);
                                        if (relevantDays.length === 0) return null;
                                        
                                        const lastDay = relevantDays[relevantDays.length-1];
                                        const history = chatHistory[lastDay.id] || [];
                                        const lastMsg = history.length > 0 ? history[history.length-1].text : "√öj √ºzenet...";

                                        return (
                                            <div key={key} onClick={() => openChatDetail(key)} style={{display:'flex', gap:'15px', padding:'15px', borderBottom:'1px solid #333', cursor:'pointer', background:'rgba(255,255,255,0.05)'}}>
                                                <div style={{fontSize:'30px', width:'50px', textAlign:'center'}}>{char.icon}</div>
                                                <div style={{flexGrow:1}}>
                                                    <div style={{fontWeight:'bold', fontSize:'16px'}}>{char.name}</div>
                                                    <div style={{fontSize:'13px', color:'#aaa', overflow:'hidden', textOverflow:'ellipsis', whiteSpace:'nowrap', maxWidth:'200px'}}>{lastMsg}</div>
                                                </div>
                                                <div style={{fontSize:'12px', color:'#666'}}>Most</div>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        </div>
                    )}

                    {/* CHAT R√âSZLETEK (KONKR√âT BESZ√âLGET√âS) */}
                    {activeModal === 'chatDetail' && currentDay && (
                        <div className="modal-overlay" onClick={() => setActiveModal('chatList')}>
                            <div className="modal-content chat-modal" onClick={e => e.stopPropagation()}>
                                <div className="chat-header">
                                    <div style={{display:'flex', alignItems:'center', gap:'10px'}}>
                                        <button onClick={() => setActiveModal('chatList')} style={{background:'none',border:'none',color:'var(--accent)',fontSize:'20px'}}>‚Äπ</button>
                                        <span style={{fontSize:'24px'}}>{characters[currentDay.char].icon}</span>
                                        <span style={{fontWeight:'bold', fontSize:'18px'}}>{characters[currentDay.char].name}</span>
                                    </div>
                                </div>
                                
                                <div className="chat-list">
                                    {/* V√©gigmegy√ºnk az √∂sszes napon, ami ehhez a karakterhez tartozik √©s nyitva van, hogy l√°ssuk az el≈ëzm√©nyeket */}
                                    {unlockedDays
                                        .map(id => storyData.find(d => d.id === id))
                                        .filter(d => d.char === currentDay.char)
                                        .sort((a,b) => a.id - b.id)
                                        .map(day => {
                                            const history = chatHistory[day.id] || [];
                                            return (
                                                <div key={day.id} className="msg-group">
                                                    <div className="date-label">December {day.id}.</div>
                                                    {history.map((msg, idx) => (
                                                        <div key={idx} className={`msg-row ${msg.isMe ? 'me' : 'them'}`} style={{justifyContent: msg.isMe ? 'flex-end' : 'flex-start', display:'flex'}}>
                                                            {!msg.isMe && <div className="avatar">{characters[day.char].icon}</div>}
                                                            <div className={`msg ${msg.isMe ? 'me' : 'them'}`}>{msg.text}</div>
                                                        </div>
                                                    ))}
                                                </div>
                                            )
                                        })
                                    }
                                    
                                    {typingDay && (
                                        <div className="msg-row them" style={{display:'flex'}}>
                                            <div className="avatar">{characters[storyData.find(d=>d.id===typingDay).char].icon}</div>
                                            <div className="typing">
                                                <div className="dot"></div><div className="dot"></div><div className="dot"></div>
                                            </div>
                                        </div>
                                    )}
                                    <div ref={chatEndRef} />
                                </div>

                                <div className="chat-input-area">
                                    <input 
                                        className="chat-input" 
                                        placeholder="√çrj neki..." 
                                        value={inputValue}
                                        onChange={e => setInputValue(e.target.value)}
                                        onKeyPress={e => e.key === 'Enter' && handleSendMessage()}
                                        disabled={!!typingDay}
                                    />
                                    <button className="send-btn" onClick={handleSendMessage} disabled={!inputValue.trim() || !!typingDay}>‚û§</button>
                                </div>
                            </div>
                        </div>
                    )}

                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
