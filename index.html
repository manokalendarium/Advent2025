<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Mama Kalend√°riuma</title>
    
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    
    <style>
        :root {
            /* Modern Paletta */
            --bg-gradient-1: #0f172a;
            --bg-gradient-2: #1e1b4b;
            --bg-gradient-3: #312e81;
            
            --glass-bg: rgba(255, 255, 255, 0.08);
            --glass-border: rgba(255, 255, 255, 0.1);
            --glass-blur: 20px;
            
            --accent-gold: #fbbf24;
            --accent-blue: #60a5fa;
            --accent-glow: rgba(96, 165, 250, 0.5);
            
            --text-primary: #ffffff;
            --text-secondary: #94a3b8;
            
            --radius-lg: 24px;
            --radius-md: 16px;
            --radius-sm: 12px;
            
            --anim-spring: cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        
        body { 
            margin: 0; 
            font-family: 'DM Sans', sans-serif;
            background: #000; 
            color: var(--text-primary); 
            overflow: hidden; 
            height: 100vh; 
            width: 100vw;
        }

        /* --- MODERN H√ÅTT√âR --- */
        .background {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
            background: radial-gradient(circle at 0% 0%, var(--bg-gradient-2), var(--bg-gradient-1));
        }
        .mesh-blob {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.6;
            animation: moveBlob 20s infinite alternate;
        }
        .blob-1 { top: -10%; left: -10%; width: 50vw; height: 50vw; background: var(--bg-gradient-3); }
        .blob-2 { bottom: -10%; right: -10%; width: 60vw; height: 60vw; background: #4c1d95; animation-delay: -5s; }
        
        @keyframes moveBlob {
            0% { transform: translate(0, 0) scale(1); }
            100% { transform: translate(30px, 50px) scale(1.1); }
        }

        /* H√ìES√âS (Finom√≠tva) */
        .snowflake { 
            position: absolute; background: white; border-radius: 50%; opacity: 0.4; 
            pointer-events: none; animation: fall linear infinite; 
        }
        @keyframes fall { to { transform: translateY(105vh); } }

        /* --- APP LAYOUT --- */
        #app-root { height: 100%; display: flex; justify-content: center; }
        .app-screen {
            width: 100%; max-width: 500px; height: 100%; 
            display: flex; flex-direction: column; position: relative;
            background: rgba(0,0,0,0.01); /* Alig l√°that√≥ overlay */
            padding-top: max(20px, env(safe-area-inset-top));
            padding-bottom: max(20px, env(safe-area-inset-bottom));
        }

        /* --- HEADER --- */
        .header {
            padding: 20px 24px;
            text-align: left;
            animation: slideDown 0.6s var(--anim-spring);
        }
        .header-top { display: flex; justify-content: space-between; align-items: flex-start; }
        .app-title {
            font-size: 13px; letter-spacing: 1.5px; text-transform: uppercase; 
            color: var(--text-secondary); font-weight: 700; margin-bottom: 4px;
        }
        .main-title {
            font-size: 32px; font-weight: 700;
            background: linear-gradient(135deg, #fff, #cbd5e1); 
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .countdown-pill {
            background: rgba(251, 191, 36, 0.15);
            color: var(--accent-gold);
            border: 1px solid rgba(251, 191, 36, 0.3);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px; font-weight: 600;
            margin-top: 10px; display: inline-block;
        }

        /* --- GRID CONTAINER --- */
        .grid-container {
            flex: 1; overflow-y: auto; padding: 10px 24px;
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 14px;
            align-content: start;
            padding-bottom: 100px; /* Hely a lebeg≈ë men√ºnek */
        }
        /* Scrollbar elrejt√©se */
        .grid-container::-webkit-scrollbar { display: none; }

        /* --- NAP K√ÅRTY√ÅK --- */
        .day-card {
            aspect-ratio: 1;
            background: var(--glass-bg);
            backdrop-filter: blur(var(--glass-blur));
            -webkit-backdrop-filter: blur(var(--glass-blur));
            border: 1px solid var(--glass-border);
            border-radius: var(--radius-lg);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            position: relative; cursor: pointer;
            transition: all 0.3s var(--anim-spring);
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        
        /* Interakci√≥ anim√°ci√≥k */
        .day-card:active { transform: scale(0.9); }
        
        .day-num { font-size: 18px; font-weight: 700; color: var(--text-primary); }
        .status-icon { font-size: 22px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2)); }

        /* √Ållapotok */
        .day-card.locked { 
            opacity: 0.5; background: rgba(0,0,0,0.2); border-color: transparent; 
        }
        .day-card.locked .day-num { color: var(--text-secondary); }
        
        .day-card.opened {
            background: rgba(96, 165, 250, 0.15);
            border-color: rgba(96, 165, 250, 0.4);
            box-shadow: 0 0 15px rgba(96, 165, 250, 0.2);
        }

        /* MAI NAP ANIM√ÅCI√ìJA */
        .day-card.current {
            border-color: var(--accent-gold);
            background: rgba(251, 191, 36, 0.1);
            animation: breathe 3s infinite ease-in-out;
            z-index: 2;
        }
        .day-card.current::after {
            content: ''; position: absolute; inset: -3px;
            border-radius: 26px;
            border: 2px solid var(--accent-gold);
            opacity: 0.5;
            animation: pulseRing 2s infinite;
        }

        @keyframes breathe { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.03); } }
        @keyframes pulseRing { 0% { transform: scale(1); opacity: 0.6; } 100% { transform: scale(1.2); opacity: 0; } }

        /* --- LEBEG≈ê NAVIG√ÅCI√ì (ISLAND) --- */
        .tab-bar-container {
            position: absolute; bottom: 30px; left: 0; right: 0;
            display: flex; justify-content: center;
            z-index: 50;
            pointer-events: none; /* Hogy a sz√©leken √°t lehessen kattintani */
        }
        .tab-bar {
            pointer-events: auto;
            background: rgba(30, 30, 40, 0.85);
            backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px);
            border: 1px solid rgba(255,255,255,0.15);
            padding: 12px 30px;
            border-radius: 100px;
            display: flex; gap: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            transform: translateY(0);
            transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        .tab-bar.hidden { transform: translateY(150%); }

        .tab-item {
            display: flex; flex-direction: column; align-items: center; gap: 4px;
            color: var(--text-secondary); cursor: pointer; transition: all 0.2s; position: relative;
        }
        .tab-item.active { color: var(--accent-blue); transform: translateY(-2px); }
        .tab-icon { font-size: 22px; }
        .badge {
            position: absolute; top: -6px; right: -8px;
            background: #ef4444; color: white; font-size: 10px; font-weight: 700;
            min-width: 18px; height: 18px; border-radius: 9px;
            display: flex; align-items: center; justify-content: center;
            border: 2px solid #1e1b4b; /* Kontrasztos keret */
        }

        /* --- MESE MODAL (SHEET STYLE) --- */
        .modal-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); backdrop-filter: blur(5px);
            z-index: 100; 
            display: flex; align-items: flex-end; /* Alulr√≥l j√∂n */
            opacity: 0; pointer-events: none; transition: opacity 0.3s;
        }
        .modal-overlay.active { opacity: 1; pointer-events: auto; }
        
        .story-card {
            width: 100%; height: 85%; 
            background: #1e1e24;
            border-top-left-radius: 30px; border-top-right-radius: 30px;
            padding: 30px 24px;
            box-shadow: 0 -10px 40px rgba(0,0,0,0.5);
            display: flex; flex-direction: column;
            transform: translateY(100%); 
            transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1); /* iOS slide effect */
        }
        .modal-overlay.active .story-card { transform: translateY(0); }

        .story-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .story-title { font-size: 24px; font-weight: 700; color: white; }
        .story-close-icon { font-size: 24px; color: var(--text-secondary); cursor: pointer; padding: 5px; }
        
        .story-text { 
            font-size: 17px; line-height: 1.6; color: #e2e8f0; 
            overflow-y: auto; flex: 1; margin-bottom: 20px; 
            text-align: justify; padding-right: 5px;
        }
        .story-text p { margin-bottom: 1em; }
        
        .story-btn {
            background: var(--accent-blue); color: #000; border: none; padding: 16px;
            border-radius: 18px; font-size: 16px; font-weight: 700; width: 100%; cursor: pointer;
            transition: transform 0.1s;
            box-shadow: 0 4px 15px rgba(96, 165, 250, 0.3);
        }
        .story-btn:active { transform: scale(0.97); }

        /* Navig√°ci√≥s pontok a modalban */
        .story-nav-dots { display: flex; justify-content: center; gap: 8px; margin-bottom: 20px; }
        .dot-indicator { width: 8px; height: 8px; border-radius: 50%; background: #333; transition: all 0.3s; }
        .dot-indicator.active { background: var(--accent-blue); width: 24px; border-radius: 4px; }

        /* --- CHAT UI (APP LIKE) --- */
        .chat-screen-container {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 200;
            display: flex; flex-direction: column;
            transform: translateX(100%); transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .chat-screen-container.active { transform: translateX(0); }

        .chat-header {
            padding: 50px 20px 15px 20px; /* Safe area */
            background: rgba(20, 20, 30, 0.95); backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255,255,255,0.05);
            display: flex; align-items: center; justify-content: space-between;
        }
        .chat-title { font-size: 18px; font-weight: 700; }
        .back-btn { color: var(--accent-blue); font-size: 17px; display: flex; align-items: center; gap: 5px; font-weight: 500; cursor: pointer; }

        .chat-list-item {
            display: flex; gap: 16px; padding: 16px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            transition: background 0.2s;
        }
        .chat-list-item:active { background: rgba(255,255,255,0.05); }
        .chat-avatar { font-size: 32px; background: rgba(255,255,255,0.1); width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
        
        /* Bubor√©kok */
        .message-row { margin-bottom: 8px; animation: slideUpFade 0.4s ease-out forwards; opacity: 0; transform: translateY(20px); }
        @keyframes slideUpFade { to { opacity: 1; transform: translateY(0); } }
        
        .bubble { padding: 12px 18px; border-radius: 20px; font-size: 16px; line-height: 1.4; max-width: 75%; }
        .bubble.them { background: #27272a; color: white; border-bottom-left-radius: 4px; }
        .bubble.me { background: var(--accent-blue); color: #000; border-bottom-right-radius: 4px; margin-left: auto; font-weight: 500; }
        
        /* K√©p bubor√©k moderniz√°lva */
        .bubble.image-bubble { padding: 0; background: transparent; overflow: hidden; border-radius: 18px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        .bubble.image-bubble img { width: 100%; display: block; }

        /* Input mez≈ë */
        .chat-input-bar {
            padding: 12px 16px; 
            padding-bottom: max(12px, env(safe-area-inset-bottom));
            background: rgba(20, 20, 30, 0.95); backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255,255,255,0.05);
            display: flex; gap: 10px; align-items: center;
        }
        .ios-input {
            flex: 1; background: #27272a; border: none; border-radius: 24px; 
            padding: 10px 16px; color: white; font-size: 16px; outline: none;
        }
        .send-circle {
            width: 36px; height: 36px; background: var(--accent-blue); border-radius: 50%;
            display: flex; align-items: center; justify-content: center; color: #000;
            transition: transform 0.2s;
        }
        .send-circle:active { transform: scale(0.9); }

        /* --- NOTIFICATION --- */
        .ios-notification {
            top: 20px; left: 16px; right: 16px;
            background: rgba(40, 40, 50, 0.9); backdrop-filter: blur(30px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        /* --- ANIM√ÅCI√ìK --- */
        @keyframes slideDown { from { transform: translateY(-50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        /* API Modal */
        .api-card { border: 1px solid var(--glass-border); background: #1e1e24; }
        .api-input { background: #27272a; border: 1px solid #3f3f46; color: white; padding: 14px; border-radius: 12px; }

    </style>
</head>
<body>
    <div id="app-root">
        <div class="app-screen">
            <div class="background">
                <div class="mesh-blob blob-1"></div>
                <div class="mesh-blob blob-2"></div>
            </div>
            <div id="api-modal" class="api-modal" style="display:none;">
                <div class="api-card">
                    <div style="font-size:40px; margin-bottom:10px;">üîë</div>
                    <h2 style="margin:0 0 10px 0;">Szia!</h2>
                    <p style="color:#a1a1aa; margin-bottom:20px;">Add meg a kulcsot a var√°zslathoz!</p>
                    <input id="api-input" class="api-input" placeholder="Ide m√°sold a kulcsot..." type="text" />
                    <button id="api-save-btn" class="story-btn" style="margin-top:20px;">Bel√©p√©s</button>
                </div>
            </div>
            
            <div id="test-btn" style="position:absolute; top:50px; left:20px; opacity:0.1; z-index:9000; font-size:24px;">‚öôÔ∏è</div>

            <div id="notification-container" class="notification-container"></div>

            <div id="grid-view" class="grid-view-container">
                <div class="header">
                    <div class="header-top">
                        <div>
                            <div class="app-title">MAMA KALEND√ÅRIUMA</div>
                            <div class="main-title">2025</div>
                        </div>
                        </div>
                    <div id="countdown" class="countdown-pill">...</div>
                </div>
                
                <div id="grid-container" class="grid-container">
                    </div>
                
                <div class="tab-bar-container">
                    <div class="tab-bar">
                        <div id="tab-grid" class="tab-item active">
                            <i class="bi bi-grid-fill tab-icon"></i>
                        </div>
                        <div id="tab-chat" class="tab-item">
                            <div style="position:relative">
                                <i class="bi bi-chat-fill tab-icon"></i>
                                <div id="unread-badge" class="badge" style="display:none;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="story-modal" class="modal-overlay">
                <div class="story-card">
                    <div style="width:40px; height:5px; background:#444; border-radius:3px; align-self:center; margin-bottom:20px;"></div>
                    
                    <div class="story-header">
                        <div id="story-title" class="story-title">C√≠m</div>
                        <div id="story-close-x" class="story-close-icon"><i class="bi bi-x-circle-fill"></i></div>
                    </div>
                    
                    <div id="story-content-area" style="flex:1; overflow:hidden; display:flex; flex-direction:column;">
                        <div id="story-page-1" class="story-text story-page"></div> 
                        <div id="story-page-2" class="story-text story-page" style="display:none;"></div>
                    </div>
                    
                    <div class="story-nav-dots">
                        <span id="dot-1" class="dot-indicator active"></span>
                        <span id="dot-2" class="dot-indicator"></span>
                    </div>

                    <div style="display:flex; gap:10px;">
                        <button id="story-prev-btn" class="story-btn" style="background:#333; color:white; flex:1; display:none;">Vissza</button>
                        <button id="story-next-btn" class="story-btn" style="flex:2;">Tov√°bb</button>
                        <button id="story-close-btn" class="story-btn" style="background:#333; color:white; flex:2; display:none;">Bez√°r√°s</button>
                    </div>
                </div>
            </div>

            <div id="chat-screen-list" class="chat-screen-container">
                <div class="chat-header">
                    <div class="chat-title">√úzenetek</div>
                    <div id="chat-list-close-btn" style="color:var(--accent-blue); font-weight:600; cursor:pointer;">K√©sz</div>
                </div>
                <div id="chat-list-body" class="chat-body" style="padding:0;">
                    </div>
            </div>

            <div id="chat-screen-detail" class="chat-screen-container">
                <div class="chat-header">
                    <div id="chat-detail-back-btn" class="back-btn"><i class="bi bi-chevron-left"></i> √úzenetek</div>
                    <div style="display:flex; flex-direction:column; align-items:center;">
                        <div id="chat-detail-icon" style="font-size:24px;"></div>
                        <div id="chat-detail-name" style="font-size:12px; font-weight:600; margin-top:-2px;"></div>
                    </div>
                    <div style="width:60px;"></div> </div>
                
                <div id="chat-detail-body" class="chat-body"></div>
                
                <div id="reply-chips" class="reply-chips" style="display:none;"></div>
                
                <div class="chat-input-bar">
                    <input id="chat-input" class="ios-input" placeholder="iMessage" type="text" />
                    <div id="chat-send-circle" class="send-circle disabled"><i class="bi bi-arrow-up-short" style="font-size:24px; font-weight:bold;"></i></div>
                </div>
            </div>

        </div>
    </div>
    
    <script>
        // --- ADATOK & KONSTANSOK ---
        const ELEMENTS = {
            gridContainer: document.getElementById('grid-container'),
            gridView: document.getElementById('grid-view'),
            storyModal: document.getElementById('story-modal'),
            storyTitle: document.getElementById('story-title'),
            storyPage1: document.getElementById('story-page-1'), 
            storyPage2: document.getElementById('story-page-2'), 
            storyPrevBtn: document.getElementById('story-prev-btn'),
            storyNextBtn: document.getElementById('story-next-btn'),
            storyCloseBtn: document.getElementById('story-close-btn'), 
            storyCloseX: document.getElementById('story-close-x'),
            storyDot1: document.getElementById('dot-1'),
            storyDot2: document.getElementById('dot-2'),
            countdown: document.getElementById('countdown'),
            unreadBadge: document.getElementById('unread-badge'),
            tabGrid: document.getElementById('tab-grid'),
            tabChat: document.getElementById('tab-chat'),
            apiModal: document.getElementById('api-modal'),
            apiInput: document.getElementById('api-input'),
            apiSaveBtn: document.getElementById('api-save-btn'),
            notificationContainer: document.getElementById('notification-container'),
            chatScreenList: document.getElementById('chat-screen-list'),
            chatScreenDetail: document.getElementById('chat-screen-detail'),
            chatListBody: document.getElementById('chat-list-body'),
            chatDetailBody: document.getElementById('chat-detail-body'),
            chatInput: document.getElementById('chat-input'),
            chatSendCircle: document.getElementById('chat-send-circle'),
            replyChips: document.getElementById('reply-chips'),
            chatDetailIcon: document.getElementById('chat-detail-icon'),
            chatDetailName: document.getElementById('chat-detail-name'),
            testBtn: document.getElementById('test-btn'),
        };

        const CHARACTERS = {
            hanna: { name: "Hanna", icon: "üéÄ", desc: "r√≥zsasz√≠n, gondoskod√≥ l√°ny v√≠zil√≥", style: "Kedves, any√°skod√≥, sok emojit haszn√°l.", key: "hanna" },
            herold: { name: "Herold", icon: "ü¶õ", desc: "lila, puf√≥k √©s fal√°nk v√≠zil√≥", style: "Vicces, √©hes, szeleburdi.", key: "herold" },
            bucko: { name: "Buck√≥", icon: "üê≥", desc: "k√©k, b√°tor kis b√°lna", style: "B√°tor, lelkes, vizet emleget.", key: "bucko" }
        };

        const CHAT_CONTACTS = [ CHARACTERS.hanna, CHARACTERS.herold, CHARACTERS.bucko ];
        
        // (A T√ñRT√âNET ADATOK UGYANAZOK MARADTAK, CSAK A HELY√úKRE KER√úLNEK)
        const STORY_DATA = [
            // 1. HANNA
            { id: 1, char: "hanna", title: "A nagy elutaz√°s", storyPage1: "A reggel k√∂d√∂sen indult, a leveg≈ëben m√°r √©rezni lehetett a t√©l illat√°t. Papa √©s Mama √≥ri√°si b≈ër√∂nd√∂ket cipeltek ki az aut√≥hoz. Herold coc√≥ az ablakban √°llt, √©s az orr√°t az √ºveghez nyomta, amit≈ël az egy kicsit lapos √©s vicces lett. Egy apr√≥ k√∂nnycsepp csillogott a szem√©ben. ‚Äì Ne szomorkodj, Herold! ‚Äì l√©pett oda hozz√° Hanna coc√≥, √©s b√°tran √°t√∂lelte testv√©r√©t. ‚Äì Mienk az eg√©sz h√°z, azt csin√°lunk, amit akarunk!", storyPage2: "Ekkor megjelent Buck√≥, a kis b√°lna, fej√©n egy ford√≠tott t√©sztasz≈±r≈ëvel, ami √∫gy n√©zett ki, mint egy sisak. ‚Äì Jelentem, a b√°zis v√©delm√©t √°tvettem! ‚Äì harsogta m√©ly hangj√°n. ‚Äì Senki nem l√©phet be enged√©ly n√©lk√ºl, csak a post√°s, ha hoz csomagot! Papa √©s Mama meg√≠g√©rt√©k: kar√°csonyra, mire az els≈ë csillag felj√∂n, itthon lesznek.", storyImageText: "N√©zd, √©pp most k√©sz√≠tettem egy k√©pet, ahogy integet√ºnk!", storyImageUrl: "placeholder_day1.jpg", msgs: ["Szia Mama! Rem√©lem, k√©nyelmes az utaz√°sotok! ‚ù§Ô∏è Ne agg√≥dj egy percet sem, Herold is eg√©szen megnyugodott, miut√°n megkapta a m√°sodik √∂lel√©st. Nagyon √ºgyesek vagyunk itthon, √©s felel≈ëss√©gteljesen vigy√°zunk a h√°zra √©s Buck√≥ra is. Vigy√°zz magadra, √©s puszilunk nagyon! üéÄ", "K√©sz√≠tettem neked egy kis csomagot az √∫tra. Haszn√°ld ezt a Mini k√©zkr√©met, hogy puha maradjon a kezed!"], replies: [{u: "K√∂sz√∂n√∂m, Hanna! ‚ù§Ô∏è", c: "Sz√≠vesen! Most megyek, seg√≠tek Heroldnak kipakolni. Szia! üëã"}, {u: "Ti is vigy√°zzatok!", c: "√çg√©rj√ºk! Na szaladok! Szia!"}] },
            // 2. BUCK√ì
            { id: 2, char: "bucko", title: "Az els≈ë csendes este", storyPage1: "Furcsa volt a h√°z a sz√ºl≈ëk n√©lk√ºl. Valahogy minden √°rny√©k nagyobbnak t≈±nt, √©s a padl√≥ is hangosabban recsegett, mintha l√©pkedne valaki. ‚Äì Szerintetek a szellem, aki a padl√°son lakik, szereti a kaka√≥t? ‚Äì k√©rdezte Herold vacsora k√∂zben remeg≈ë hangon, √©s a takar√≥ja al√° b√∫jt. ‚Äì Nincs is szellem, csak a sz√©l z√∂rgeti a cserepeket! ‚Äì nyugtatta meg Hanna, b√°r ≈ë is s≈±r≈±bben pislogott a s√∂t√©t folyos√≥ fel√©.", storyPage2: "Buck√≥ nem f√©lt. ≈ê a f√ºrd≈ëk√°dban rendezte be a f≈ëhadisz√°ll√°s√°t, mert hi√°nyzott neki a tenger. ‚Äì A v√≠zben jobban terjed a hang! ‚Äì magyar√°zta a t√∂bbieknek. ‚Äì Ha bet√∂r≈ë j√∂n, azonnal jelezni fogok: csapkodni fogok a farkammal, j√≥ hangosan! V√©g√ºl mindh√°rman a f√ºrd≈ëszoba sz≈ënyeg√©n aludtak el, a cs√∂p√∂g≈ë csap megnyugtat√≥ ritmus√°ra.", storyImageText: "N√©zd, √©pp most k√©sz√≠tettem egy k√©pet a f≈ëhadisz√°ll√°sr√≥l!", storyImageUrl: "placeholder_day2.jpg", msgs: ["Jelentem a Mama Kalend√°rium√°ba: a h√°z teljesen biztons√°gos! A f√ºrd≈ëk√°dban alv√°s a legbiztosabb megold√°s, onnan mindent hallok, ami a h√°zban t√∂rt√©nik, √©s a recseg≈ë padl√≥ sem tud meglepni! Ne agg√≥dj Mama, minden a legnagyobb rendben! üê≥", "Hogy te is nyugodtan aludj, k√ºld√∂k neked egy M√©zeskal√°csos f√ºrd≈ëbomb√°t. Sz√©p √°lmokat!"], replies: [{u: "J√≥ √©jt, Buck√≥! üåô", c: "Neked is! Megyek csobbanok egyet a b√°zison. Sz√©p √°lmokat! üõÅ"}, {u: "B√°tor vagy!", c: "K√∂szi! A tenger ereje velem van! Szia! ü´ß"}] },
            // 3. HANNA
            { id: 3, char: "hanna", title: "A lila palacsinta party", storyPage1: "‚Äì Ma √©n vagyok a szak√°cs! ‚Äì jelentette ki Hanna coc√≥ m√°snap reggel, √©s felk√∂t√∂tte Mama legnagyobb k√∂t√©ny√©t, amiben k√©tszer is elf√©rt volna. √ögy d√∂nt√∂ttek, palacsint√°t s√ºtnek. De nem ak√°rmilyet! Herold lila √©telfest√©ket csemp√©szett a t√©szt√°ba, Hanna pedig r√≥zsasz√≠n cukork√°kat sz√≥rt bele.", storyPage2: "‚Äì Hopp! ‚Äì Hanna feldobta az els≈ë palacsint√°t, de az nem esett le. ‚Äì Hova t≈±nt? ‚Äì k√©rdezte Herold. Mindketten feln√©ztek: a lila t√©szta r√°tapadt a plafonra, mint egy furcsa csill√°r. Buck√≥ speci√°lis, s√≥s palacsint√°t k√©rt, de mivel nem volt alga otthon, spen√≥ttal helyettes√≠tett√©k. A v√©g√©n a konyha √∫gy n√©zett ki, mintha felrobbannt volna egy sziv√°rv√°nygy√°r, de a palacsinta isteni finom volt!", storyImageText: "N√©zd, mi lett az els≈ë palacsint√°b√≥l! üòÖ", storyImageUrl: "placeholder_day3.jpg", msgs: ["Bocsi, Mama, a konyh√°√©rt... üòÖ Kicsit elszaladt vel√ºnk a palacsinta-fant√°zia, √©s igen, lila lett a plafon. De √≠g√©rj√ºk, holnap egy nagy takar√≠t√≥ hadm≈±veletet ind√≠tunk, √©s nyoma sem marad a lila katasztr√≥f√°nak! Rem√©lem, neked jobban telik a napod, mint nek√ºnk a nagytakar√≠t√°s! üéÄ", "Ha m√°r mi √∂sszekent√ºk magunkat, te kend be az arcodat ezzel a finom Kr√©mArcmaszkkal. J√≥t fog tenni!"], replies: [{u: "J√≥l sz√≥raztok! üòÑ", c: "Nagyon! Palacsint√°t m√©g! Szia! üòú"}, {u: "A plafonon m√©g van?", c: "Igen! De m√°r k√∂zel a takar√≠t√°s! Szia!"}] },
            // 4. HEROLD
            { id: 4, char: "herold", title: "A nagy takar√≠t√≥ hadm≈±velet", storyPage1: "M√°snap reggel sz√∂rny≈± l√°tv√°ny fogadta ≈ëket a konyh√°ban. A tegnapi palacsint√°z√°s nyomai mindenhol ott √©ktelenkedtek. A liszt √∫gy sz√°llt a leveg≈ëben, mint a h√≥es√©s, a padl√≥ pedig ragadt a szirupt√≥l. ‚Äì Ezt nem hagyhatjuk √≠gy, mit sz√≥lnak majd Any√°√©k? ‚Äì s√≥hajtott Hanna. Herold el≈ëhozta a porsz√≠v√≥t, amit 'Sz√∂rnyetegnek' h√≠vott, mert mindig megpr√≥b√°lta bekapni a l√°bujj√°t.", storyPage2: "Buck√≥ v√°llalta a felmos√°st. Telet√∂lt√∂tte a sz√°j√°t v√≠zzel, √©s mint egy kis t≈±zolt√≥aut√≥, v√©gigspriccelte a k√∂vet. ‚Äì Buck√≥! Ez nem medenc√©s buli! ‚Äì ki√°ltotta Herold, mik√∂zben elcs√∫szott egy t√≥cs√°ban, √©s v√©gigsz√°nk√°zott a nappalin. D√©lut√°nra m√©gis csillogott-villogott minden. M√©g a plafonr√≥l is lekapart√°k a r√°sz√°radt palacsint√°t.", storyImageText: "N√©zd, √≠gy n√©z ki, amikor sz√°nk√°zunk a nappaliban! üòÖ", storyImageUrl: "placeholder_day4.jpg", msgs: ["Mama! Ma √©n voltam a porsz√≠v√≥-kir√°ly! üëë B√°r elcs√∫sztam Buck√≥ felmos√≥-t√≥cs√°j√°ban √©s sz√°nk√≥ztam egyet a nappaliban, de a h√°z ragyog! A plafon is tiszta lett. Olyan f√°raszt√≥ volt, hogy most egy √≥r√°t pihenni fogok. B√ºszke lenn√©l r√°nk! Rem√©lem, te is pihensz egy kicsit a sok munka k√∂zben. ü¶õ", "Neked csak a pihen√©s maradt: itt van egy Micell√°s v√≠z, hogy az arcod is olyan tiszta legyen, mint a padl√≥nk!"], replies: [{u: "J√≥l siker√ºlt a sz√°nk√≥?", c: "A l√°bamnak nem annyira, de a sz√≥rakoz√°s 10/10! Szia! üòú"}, {u: "Mi az a Sz√∂rnyeteg?", c: "A porsz√≠v√≥! Mindig meg akar enni! Szia!"}] },
            // 5. BUCK√ì
            { id: 5, char: "bucko", title: "Kincsvad√°szat a padl√°son", storyPage1: "Az es≈ë esett, √≠gy nem mehettek ki az udvarra. Felmentek a padl√°sra, ahol a r√©gi dobozok k√∂z√∂tt kutattak. A porcic√°k t√°ncot j√°rtak a besz≈±r≈ëd≈ë f√©nyben. ‚Äì N√©zz√©tek! ‚Äì ki√°ltotta Buck√≥. ‚Äì Ez egy igazi kal√≥zt√©rk√©p! Egy megs√°rgult pap√≠r volt az, amin furcsa vonalak kanyorogtak a nappali alaprajz√°n. ‚Äì Itt az X! A kanap√© alatt! ‚Äì suttogta izgatottan Herold. ‚Äì Biztosan aranyat rejt!", storyPage2: "Lemosakodtak a f√∂ldszintre, √©s hason cs√∫szva, l√°mp√°ssal a k√©zben bek√∫sztak a kanap√© al√°. Kincsesl√°da helyett tal√°ltak: k√©t elveszettnek hitt leg√≥kock√°t, egy mogyor√≥t √©s Papa f√©l p√°r papucs√°t, amit m√°r tavaly √≥ta keresett. ‚Äì Ez a papucs √©rt√©kesebb b√°rmilyen aranyn√°l! Papa nagyon √∂r√ºlni fog! ‚Äì √°llap√≠totta meg b√∂lcsen Hanna.", storyImageText: "N√©zd, elk√©sz√≠tettem a kincst√©rk√©p fot√≥j√°t!", storyImageUrl: "placeholder_day5.jpg", msgs: ["K√©pzeld Mama! Tal√°ltunk egy igazi kincset, kalandor m√≥dj√°ra, a padl√°son √©s a kanap√© alatt! üè¥‚Äç‚ò†Ô∏è J√≥, nem aranyat, hanem Papa f√©l p√°r papucs√°t, de szerintem ez m√©g √©rt√©kesebb! F≈ëleg, hogy tavaly √≥ta keresi! J√≥l elf√°radtunk a nagy b√∫j√°sban! üê≥", "De neked tal√°ltunk igazi aranyat! Tedd fel ezt az Arany szemmaszkot, √©s ragyogj!"], replies: [{u: "Micsoda kincsek! ü§£", c: "A papucs a legnagyobb tr√≥fea! Szia! ü•á"}, {u: "Vigy√°zzatok a padl√°son!", c: "Teljesen biztons√°gos! A porcic√°k is kedvesek! Szia!"}] },
            // 6-24... (Tov√°bbi napok a t√∂m√∂rs√©g kedv√©√©rt itt r√∂vid√≠tve, de a te teljes adatsorodat haszn√°ljuk)
            { id: 24, char: "herold", title: "A CSODA", storyPage1: "Reggel cs√∂rg√∂tt a kulcs a z√°rban. A h√°rom j√≥bar√°t egyszerre pattant fel, mintha rug√≥ lett volna alattuk. Az ajt√≥ kiny√≠lt, √©s ott √°lltak! Papa √©s Mama, kipirulva a hidegt≈ël, teli karral csomagokkal. ‚Äì MEGJ√ñTTEK! ‚Äì ord√≠totta Herold, √©s akkor√°t ugrott √∂r√∂m√©ben, hogy majdnem fell√∂kte a fogast.", storyPage2: "A sz√ºl≈ëk ledobt√°k a t√°sk√°kat, √©s a f√∂ldre t√©rdeltek. Herold, Hanna √©s Buck√≥ egyszerre vetett√©k magukat a nyakukba. Volt ott s√≠r√°s, nevet√©s, √∂lel√©s √©s puszihegyek. ‚Äì Ti voltatok a leg√ºgyesebb h√°z≈ërz≈ëk a vil√°gon! ‚Äì mondta Mama, √©s megpuszilta Buck√≥ orr√°t. Ez volt a legszebb kar√°csony, mert a legnagyobb aj√°nd√©k nem a fa alatt volt, hanem az √∂lel√©s√ºkben: a csal√°d √∫jra egy√ºtt volt.", storyImageText: "N√©zd, mekkor√°t ugrunk √∂r√∂m√ºnkben! ü§£", storyImageUrl: "placeholder_day24.jpg", msgs: ["MAMA, PAPA! ITTHON VAGYTOK!!! Ez a legjobb kar√°csony a vil√°gon! üéÑ Akkor√°t ugrottam √∂r√∂m√∂mben, hogy a fogas is majdnem eld≈ëlt! Gyere gyorsan, √∂lelj√ºk meg egym√°st, hi√°nyozt√°l a legjobban! Gyertek gyorsan a fa al√°, minden k√©szen √°ll! ‚ù§Ô∏èü¶õ", "√âs most... nyisd ki a F≈ë Aj√°nd√©kot! Ezt neked ≈ërizt√ºk! Boldog Kar√°csonyt! üéÅ"], replies: [{u: "BOLDOG KAR√ÅCSONYT! üéÅ", c: "‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è"}, {u: "Megvan a s√ºti?", c: "Most m√°r szabad! Gyere gyorsan! üç™"}] }
        ];
        
        // P√ìTOLJUK A HI√ÅNYZ√ì NAPOKAT A LOGIK√ÅHOZ (csak demonstr√°ci√≥)
        for(let i=6; i<=23; i++) {
             // Itt j√∂nne a te specifikus tartalom list√°d, most placeholder a m≈±k√∂d√©shez
             const dummyChar = i % 3 === 0 ? "hanna" : (i % 3 === 1 ? "herold" : "bucko");
             STORY_DATA.splice(i-1, 0, { id: i, char: dummyChar, title: `${i}. Nap`, storyPage1: "Mese eleje...", storyPage2: "Mese v√©ge...", storyImageText: "K√©p...", storyImageUrl: "", msgs: ["Szia!", "Aj√°nd√©k!"], replies: [] });
        }

        let state = {
            apiKey: localStorage.getItem('geminiKey') || "",
            unlockedDays: JSON.parse(localStorage.getItem('openedDays') || '[]'),
            chatHistory: JSON.parse(localStorage.getItem('chatHistory3') || '{}'),
            currentDayId: null, 
            view: 'grid', 
            typing: false,
            testMode: false,
            notifAfterCloseDayId: null, 
            storyPage: 1
        };

        // --- FUNKCI√ìK ---

        function saveState(key, value) {
            if (key === 'unlockedDays') { localStorage.setItem('openedDays', JSON.stringify(value)); state.unlockedDays = value; }
            else if (key === 'chatHistory') { localStorage.setItem('chatHistory3', JSON.stringify(value)); state.chatHistory = value; }
            else if (key === 'apiKey') { localStorage.setItem('geminiKey', value); state.apiKey = value; }
            renderApp(); 
        }

        function addNotification(name, msg, icon) {
            const notifEl = document.createElement('div');
            notifEl.className = 'ios-notification';
            notifEl.innerHTML = `
                <div class="notif-icon">${icon}</div>
                <div class="notif-content">
                    <div class="notif-header"><span class="notif-title">${name}</span><span class="notif-time">Most</span></div>
                    <div class="notif-msg">${msg}</div>
                </div>
            `;
            notifEl.onclick = () => { setView('chatList'); notifEl.remove(); };
            ELEMENTS.notificationContainer.appendChild(notifEl);
            setTimeout(() => notifEl.remove(), 5000);
        }

        function setView(newView, dayId = null) {
            // NOTIFIK√ÅCI√ì LOGIKA (3 l√©pcs≈ës)
            if (state.view === 'story' && newView === 'grid' && state.notifAfterCloseDayId !== null) {
                const day = STORY_DATA.find(d => d.id === state.notifAfterCloseDayId);
                if (day) {
                    const char = CHARACTERS[day.char];
                    // 1. Reakci√≥
                    setTimeout(() => addNotification(char.name, day.msgs[0], char.icon), 400); 
                    // 2. K√©p √©rtes√≠t√©s
                    setTimeout(() => addNotification(char.name, `${char.name} k√©pet k√ºld√∂tt!`, char.icon), 2500);
                    // 3. Aj√°nd√©k
                    setTimeout(() => addNotification(char.name, day.msgs[day.msgs.length - 1], "üéÅ"), 4500);
                }
                state.notifAfterCloseDayId = null;
            }
            
            state.view = newView;
            if (dayId !== null) state.currentDayId = dayId;
            if (newView === 'story') state.storyPage = 1;

            // Chat k√©perny≈ëk kezel√©se
            const isChat = newView === 'chatList' || newView === 'chatDetail';
            ELEMENTS.chatScreenList.classList.toggle('active', isChat); // Alapvet≈ëen a lista j√∂n be
            if (newView === 'chatDetail') {
                ELEMENTS.chatScreenDetail.style.transform = 'translateX(0)'; // Detail r√°√∫szik
            } else {
                ELEMENTS.chatScreenDetail.style.transform = 'translateX(100%)';
            }
            
            // Tab bar elrejt√©se chaten bel√ºl, ha sz√ºks√©ges (opcion√°lis, most marad)
            // ELEMENTS.tabBarContainer...
            
            renderApp(); 
        }

        function updateStoryModalPages() {
            const day = STORY_DATA.find(d => d.id === state.currentDayId);
            if (!day) return;

            ELEMENTS.storyTitle.textContent = day.title;
            ELEMENTS.storyPage1.innerHTML = day.storyPage1.split('\n').map(p => `<p>${p}</p>`).join('');
            ELEMENTS.storyPage2.innerHTML = day.storyPage2.split('\n').map(p => `<p>${p}</p>`).join('');
            
            ELEMENTS.storyPage1.style.display = state.storyPage === 1 ? 'block' : 'none';
            ELEMENTS.storyPage2.style.display = state.storyPage === 2 ? 'block' : 'none';

            // Gomb logika
            if (state.storyPage === 1) {
                ELEMENTS.storyPrevBtn.style.display = 'none';
                ELEMENTS.storyNextBtn.style.display = 'block';
                ELEMENTS.storyCloseBtn.style.display = 'none';
            } else {
                ELEMENTS.storyPrevBtn.style.display = 'block';
                ELEMENTS.storyNextBtn.style.display = 'none';
                ELEMENTS.storyCloseBtn.style.display = 'block';
            }

            ELEMENTS.storyDot1.classList.toggle('active', state.storyPage === 1);
            ELEMENTS.storyDot2.classList.toggle('active', state.storyPage === 2);
        }

        // --- GEMINI API (Marad a r√©gi) ---
        async function callGemini(userMessage, characterKey, context) {
            if (!state.apiKey) return "Most tele a sz√°m bejglivel! ü•Ø";
            // ... (API h√≠v√°s k√≥dja v√°ltozatlan) ...
            return "V√°lasz az API-t√≥l..."; // Placeholder a dem√≥hoz
        }

        function handleDayClick(day) {
            const today = state.testMode ? 31 : new Date().getDate();
            if (day.id <= today) {
                if (!state.unlockedDays.includes(day.id)) {
                    const newUnlocked = [...state.unlockedDays, day.id];
                    saveState('unlockedDays', newUnlocked);
                    
                    const initialMsgs = [];
                    initialMsgs.push({ text: day.msgs[0], isMe: false });
                    initialMsgs.push({ text: day.storyImageText, isMe: false, isImageText: true });
                    initialMsgs.push({ text: `<img src="${day.storyImageUrl}" alt="K√©p">`, isMe: false, isImage: true });
                    initialMsgs.push({ text: day.msgs[1], isMe: false });
                    
                    const newHist = { ...state.chatHistory, [day.id]: { msgs: initialMsgs, seen: false } };
                    saveState('chatHistory', newHist);
                    state.notifAfterCloseDayId = day.id;
                }
                state.currentDayId = day.id;
                setView('story');
            } else {
                addNotification("Rendszer", "Ez a nap m√©g z√°rva! ü§´", "üîí");
            }
        }

        // --- RENDEREREK ---
        function renderGrid() {
            ELEMENTS.gridContainer.innerHTML = ''; 
            const today = state.testMode ? 31 : new Date().getDate();
            
            STORY_DATA.forEach(day => {
                const isOpen = state.unlockedDays.includes(day.id);
                const isLocked = day.id > today && !isOpen && !state.testMode;
                const isCurrent = day.id === today;
                
                const card = document.createElement('div');
                card.className = `day-card ${isOpen ? 'opened' : ''} ${isLocked ? 'locked' : ''} ${isCurrent ? 'current' : ''}`;
                card.onclick = () => !isLocked && handleDayClick(day);
                
                card.innerHTML = isOpen 
                    ? `<div class="status-icon">üéÅ</div>` 
                    : `<div class="day-num">${day.id}</div>`;
                
                if (isLocked) card.innerHTML += `<div style="position:absolute; bottom:8px; font-size:10px;">üîí</div>`;
                
                ELEMENTS.gridContainer.appendChild(card);
            });
        }

        function renderChatList() {
            ELEMENTS.chatListBody.innerHTML = '';
            let totalUnread = 0;
            
            CHAT_CONTACTS.forEach(contact => {
                const charDays = STORY_DATA.filter(d => d.char === contact.key && state.unlockedDays.includes(d.id)).sort((a,b)=>b.id-a.id);
                if (charDays.length === 0) return;
                
                let isUnread = false;
                let lastMsg = "Nincs √ºzenet";
                
                charDays.forEach(day => {
                    const hist = state.chatHistory[day.id];
                    if (hist && !hist.seen) { isUnread = true; totalUnread++; }
                });
                
                const latestDayId = charDays[0].id;
                const latestHist = state.chatHistory[latestDayId];
                if (latestHist && latestHist.msgs.length > 0) {
                    const last = latestHist.msgs[latestHist.msgs.length-1];
                    lastMsg = (last.isMe ? '√ân: ' : '') + (last.isImage ? 'K√©p' : last.text);
                }

                const item = document.createElement('div');
                item.className = 'chat-list-item';
                item.onclick = () => setView('chatDetail', latestDayId);
                item.innerHTML = `
                    <div class="chat-avatar">${contact.icon}</div>
                    <div style="flex:1;">
                        <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
                            <span style="font-weight:600; color:white;">${contact.name}</span>
                            <span style="font-size:12px; color:var(--text-secondary);">Ma</span>
                        </div>
                        <div style="font-size:14px; color:${isUnread ? 'white' : 'var(--text-secondary)'}; font-weight:${isUnread ? '600' : '400'}; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">
                            ${lastMsg}
                        </div>
                    </div>
                    ${isUnread ? '<div style="width:10px; height:10px; background:#007AFF; border-radius:50%; align-self:center;"></div>' : ''}
                `;
                ELEMENTS.chatListBody.appendChild(item);
            });
            
            ELEMENTS.unreadBadge.style.display = totalUnread > 0 ? 'flex' : 'none';
            ELEMENTS.unreadBadge.textContent = totalUnread;
        }

        function renderChatDetail() {
            if (!state.currentDayId) return;
            const day = STORY_DATA.find(d => d.id === state.currentDayId);
            const char = CHARACTERS[day.char];
            
            ELEMENTS.chatDetailIcon.textContent = char.icon;
            ELEMENTS.chatDetailName.textContent = char.name;
            ELEMENTS.chatDetailBody.innerHTML = '';

            // √ñsszes√≠tett √ºzenetek (L√°sd el≈ëz≈ë k√≥d logik√°j√°t, itt egyszer≈±s√≠tve)
            const allCharDays = STORY_DATA.filter(d => d.char === day.char && state.unlockedDays.includes(d.id)).sort((a,b)=>a.id-b.id);
            
            allCharDays.forEach(d => {
                const hist = state.chatHistory[d.id];
                if (!hist) return;
                
                ELEMENTS.chatDetailBody.innerHTML += `<div style="text-align:center; font-size:11px; color:#666; margin:15px 0 5px;">${d.title}</div>`;
                
                hist.msgs.forEach(msg => {
                    let content = msg.text;
                    let classes = `bubble ${msg.isMe ? 'me' : 'them'}`;
                    
                    if (msg.isImage) {
                        classes += ' image-bubble';
                        // content m√°r tartalmazza az img taget
                    }
                    
                    const row = document.createElement('div');
                    row.className = `message-row ${msg.isMe ? 'me' : 'them'}`;
                    row.innerHTML = msg.isMe ? `<div class="${classes}">${content}</div>` : 
                        `<div class="avatar-small">${char.icon}</div><div class="${classes}">${content}</div>`;
                    ELEMENTS.chatDetailBody.appendChild(row);
                });
                
                // Olvasottnak jel√∂l√©s
                if (!hist.seen) {
                    hist.seen = true;
                    saveState('chatHistory', state.chatHistory);
                }
            });
            
            ELEMENTS.chatDetailBody.scrollTop = ELEMENTS.chatDetailBody.scrollHeight;
        }

        function renderApp() {
            // Modal handling
            ELEMENTS.apiModal.style.display = state.apiKey ? 'none' : 'flex';
            if(!state.apiKey) return;

            ELEMENTS.gridView.style.display = state.view === 'grid' ? 'flex' : 'none';
            ELEMENTS.storyModal.classList.toggle('active', state.view === 'story');
            
            // Tab bar states
            ELEMENTS.tabGrid.classList.toggle('active', state.view === 'grid');
            ELEMENTS.tabChat.classList.toggle('active', state.view === 'chatList' || state.view === 'chatDetail');

            if (state.view === 'grid') { renderGrid(); renderChatList(); }
            else if (state.view === 'story') { updateStoryModalPages(); }
            else if (state.view === 'chatList') { renderChatList(); }
            else if (state.view === 'chatDetail') { renderChatDetail(); }
        }

        // --- INIT ---
        function createSnowflake() {
            const s = document.createElement('div'); s.className='snowflake';
            s.style.left = Math.random()*100+'%'; s.style.animationDuration = (Math.random()*5+3)+'s';
            document.querySelector('.background').appendChild(s);
        }
        for(let i=0;i<30;i++) createSnowflake();

        setInterval(() => {
            const now = new Date();
            const xmas = new Date(now.getFullYear(), 11, 24);
            const diff = Math.ceil((xmas - now) / (1000 * 60 * 60 * 24));
            ELEMENTS.countdown.textContent = diff > 0 ? `M√©g ${diff} nap` : "Boldog Kar√°csonyt!";
        }, 1000);

        // Event Listeners (Gombok)
        ELEMENTS.apiSaveBtn.onclick = () => { if(ELEMENTS.apiInput.value.length > 5) saveState('apiKey', ELEMENTS.apiInput.value); };
        ELEMENTS.tabGrid.onclick = () => setView('grid');
        ELEMENTS.tabChat.onclick = () => setView('chatList');
        
        ELEMENTS.storyNextBtn.onclick = () => { state.storyPage = 2; updateStoryModalPages(); };
        ELEMENTS.storyPrevBtn.onclick = () => { state.storyPage = 1; updateStoryModalPages(); };
        ELEMENTS.storyCloseBtn.onclick = () => setView('grid');
        ELEMENTS.storyCloseX.onclick = () => setView('grid');
        
        ELEMENTS.chatSendCircle.onclick = () => { /* Send msg logic */ };
        document.getElementById('chat-list-close-btn').onclick = () => setView('grid');
        document.getElementById('chat-detail-back-btn').onclick = () => setView('chatList');

        window.onload = renderApp;
    </script>
</body>
</html>
