<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mama Kalend√°riuma 2025</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --accent: #66ccff;
            --text: #ffffff;
            --glass: rgba(0, 0, 0, 0.4);
            --glass-border: rgba(255, 255, 255, 0.1);
        }

        body { margin: 0; font-family: 'Nunito', sans-serif; background: #050515; color: white; overflow: hidden; height: 100vh; }
        
        /* AURORA H√ÅTT√âR */
        .aurora-bg { position: absolute; width: 100%; height: 100%; z-index: -1; overflow: hidden; }
        .orb { position: absolute; border-radius: 50%; filter: blur(80px); opacity: 0.4; animation: float 10s infinite alternate; }
        
        @keyframes float { from { transform: translate(0,0); } to { transform: translate(20px, 40px); } }

        /* H√ìES√âS */
        .snowflake { position: absolute; background: white; border-radius: 50%; animation: fall linear infinite; }
        @keyframes fall { to { transform: translateY(105vh); } }

        /* F≈ê KONT√âNER */
        .app-container {
            display: flex; flex-direction: column; height: 100%; max-width: 600px; margin: 0 auto; padding: 20px; box-sizing: border-box; position: relative;
        }

        /* C√çM */
        header { text-align: center; margin-bottom: 20px; }
        h1 { margin: 0; font-weight: 900; background: linear-gradient(45deg, #cca43b, #ffd700); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-shadow: 0 0 20px rgba(255, 215, 0, 0.3); }
        .countdown { font-family: monospace; font-size: 12px; color: var(--accent); background: rgba(0,0,0,0.5); padding: 5px 10px; border-radius: 10px; margin-top: 5px; display: inline-block; }

        /* R√ÅCS */
        .grid {
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px;
            overflow-y: auto; padding: 15px;
            background: var(--glass); border: 1px solid var(--glass-border); border-radius: 24px;
            backdrop-filter: blur(10px);
            scrollbar-width: none;
        }
        .grid::-webkit-scrollbar { display: none; }

        .day-cell {
            aspect-ratio: 1;
            background: rgba(255,255,255,0.05);
            border-radius: 16px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            font-weight: bold; font-size: 20px;
            border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.2s;
            cursor: pointer; position: relative;
        }
        .day-cell:active { transform: scale(0.95); }
        .day-cell.unlocked { border-color: var(--accent); background: rgba(102, 204, 255, 0.15); box-shadow: 0 0 15px rgba(102, 204, 255, 0.2); }
        .day-cell.locked { opacity: 0.6; color: #aaa; }
        .lock-icon { font-size: 12px; margin-top: 5px; opacity: 0.5; }

        /* GOMBOK */
        .btn {
            background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255,255,255,0.2);
            color: white; padding: 12px 20px; border-radius: 20px; font-weight: bold; cursor: pointer;
            display: flex; align-items: center; gap: 8px; backdrop-filter: blur(5px);
        }
        .bottom-bar { margin-top: 20px; display: flex; justify-content: center; gap: 15px; }
        .badge { background: red; color: white; font-size: 10px; width: 18px; height: 18px; border-radius: 50%; display: flex; align-items: center; justify-content: center; position: absolute; top: -5px; right: -5px; }

        /* √âRTES√çT√âS */
        .notification {
            position: absolute; top: 10px; left: 10px; right: 10px;
            background: rgba(20, 20, 20, 0.9); backdrop-filter: blur(15px);
            padding: 15px; border-radius: 18px; border: 1px solid rgba(255,255,255,0.1);
            display: flex; gap: 12px; align-items: start;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            animation: slideDown 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 100; cursor: pointer;
        }
        @keyframes slideDown { from { transform: translateY(-100px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        /* MODAL (Mese / Chat) */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); backdrop-filter: blur(5px);
            z-index: 50; display: flex; align-items: center; justify-content: center;
            animation: fadeIn 0.3s;
        }
        .modal-content {
            width: 90%; max-width: 400px; max-height: 85vh;
            background: #1a1a1a; border: 1px solid #333; border-radius: 24px;
            display: flex; flex-direction: column; overflow: hidden;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
        .modal-header { padding: 15px; background: rgba(255,255,255,0.05); display: flex; justify-content: space-between; align-items: center; }
        .modal-body { padding: 20px; overflow-y: auto; line-height: 1.6; color: #ddd; }
        .chat-body { padding: 15px; display: flex; flex-direction: column; gap: 15px; background: #000; flex-grow: 1; overflow-y: auto; }
        
        /* CHAT BUBOR√âKOK */
        .msg { max-width: 80%; padding: 10px 14px; border-radius: 18px; font-size: 14px; position: relative; }
        .msg.them { background: #333; align-self: flex-start; border-bottom-left-radius: 4px; }
        .msg.me { background: #007aff; align-self: flex-end; border-bottom-right-radius: 4px; }
        .avatar { font-size: 24px; margin-right: 10px; }
        .msg-row { display: flex; align-items: flex-end; }
        
        /* √çR... ANIM√ÅCI√ì */
        .typing { display: flex; gap: 4px; padding: 8px 12px; background: #333; border-radius: 15px; width: fit-content; margin-left: 40px; margin-bottom: 10px; }
        .dot { width: 6px; height: 6px; background: #888; border-radius: 50%; animation: bounce 1.4s infinite; }
        .dot:nth-child(2) { animation-delay: 0.2s; } .dot:nth-child(3) { animation-delay: 0.4s; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }

        /* V√ÅLASZ GOMBOK */
        .reply-area { padding: 15px; background: #1a1a1a; display: flex; gap: 10px; overflow-x: auto; }
        .reply-chip { 
            background: rgba(102, 204, 255, 0.1); border: 1px solid var(--accent); color: var(--accent);
            padding: 8px 16px; border-radius: 20px; white-space: nowrap; cursor: pointer; font-size: 14px;
        }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- ADATOK ---
        const characters = {
            hanna: { name: "Hanna", icon: "üéÄ", color: "pink" },
            herold: { name: "Herold", icon: "ü¶õ", color: "purple" },
            bucko: { name: "Buck√≥", icon: "üê≥", color: "blue" }
        };

        const stories = [
            { id: 1, title: "A nagy elutaz√°s", msg: "A reggel k√∂d√∂sen indult... Papa √©s Mama elindultak. Herold coc√≥ az ablakban √°llt. 'Ne itasd az egereket!' ‚Äì mondta Hanna. Buck√≥ t√©sztasz≈±r≈ëvel a fej√©n tisztelgett.", char: "hanna", chats: ["Szia Mama! ‚ù§Ô∏è Ne agg√≥dj, vigy√°zunk a h√°zra!", "K√©sz√≠tettem neked egy kis csomagot. Haszn√°ld ezt a Mini k√©zkr√©met, hogy puha maradjon a kezed!"], replies: [{u: "K√∂sz√∂n√∂m, Hanna!", c: "Sz√≠vesen! Megyek kicsomagolni. Szia!"}, {u: "Vigy√°zzatok!", c: "√çg√©rj√ºk! Szia!"}] },
            { id: 2, title: "Els≈ë este", msg: "Furcsa csend. Buck√≥ a k√°dban aludt. 'Ha bet√∂r≈ë j√∂n, csapkodni fogok!'", char: "bucko", chats: ["Jelentem: a h√°z biztons√°gos! A k√°dban alszom. üê≥", "K√ºld√∂k neked egy kis Levendul√°s olajat a nyugodt alv√°shoz!"], replies: [{u: "J√≥ √©jt!", c: "Neked is! Csobbanok. P√°!"}, {u: "B√°tor vagy!", c: "K√∂szi! Most beb√∫jok a habokba."}] },
            { id: 3, title: "Palacsinta party", msg: "Hanna f≈ëz√∂tt. A palacsinta a plafonra ragadt. Buck√≥ s√≥sat k√©rt.", char: "hanna", chats: ["Bocsi a konyh√°√©rt... üòÖ Kicsit lila lett a plafon.", "De itt egy Kr√©mes Arcmaszk neked, hogy te is sz√©p√ºlj!"], replies: [{u: "Jaj, ti kis maszatok!", c: "H√°t ja... na megyek takar√≠tani. Puszi!"}, {u: "Im√°dom a maszkot!", c: "K√∂szi! Lemosom a lisztet magamr√≥l."}] },
            { id: 4, title: "Takar√≠t√°s", msg: "A liszt √∫gy sz√°llt, mint a h√≥. Herold porsz√≠v√≥zott, Buck√≥ vizet spriccelt.", char: "herold", chats: ["Mama! Ma √©n voltam a porsz√≠v√≥-kir√°ly! üëë", "Neked csak a pihen√©s maradt: itt van egy Micell√°s v√≠z, hogy ragyogj!"], replies: [{u: "√úgyes vagy!", c: "K√∂szi! Most megetetem a porsz√≠v√≥t. Szia!"}, {u: "Csak √≥vatosan!", c: "Vigy√°zok! Futok tov√°bb!"}] },
            { id: 5, title: "Kincsvad√°szat", msg: "Tal√°ltak egy t√©rk√©pet. Kincs helyett Papa papucsa lett meg.", char: "bucko", chats: ["K√©pzeld! Tal√°ltunk kincset!! (Apa papucs√°t) üè¥‚Äç‚ò†Ô∏è", "De neked tal√°ltunk igazit! Tedd fel ezt az Arany szemmaszkot, √©s ragyogj!"], replies: [{u: "Meglett a papucs?!", c: "Meg! Visszaviszem. Szia!"}, {u: "K√∂szi a kincset!", c: "Sz√≠vesen! Megyek, mert t√ºssz√∂g√∂k a port√≥l."}] },
            // Ide j√∂het a t√∂bbi nap... (A p√©lda kedv√©√©rt gener√°lok p√°rat)
        ];
        
        // Placeholderek 24-ig
        for(let i=6; i<=24; i++) {
            stories.push({ id: i, title: `${i}. Nap`, msg: "M√©g k√©sz√ºl a meglepet√©s...", char: "herold", chats: ["Szia Mama! M√©g dolgozunk ezen!", "Addig is itt egy kis szeretet csomag!"], replies: [{u: "K√∂szi!", c: "Sz√≠vesen!"}] });
        }

        // --- F≈ê KOMPONENS ---
        function App() {
            const [unlockedDays, setUnlockedDays] = useState([]);
            const [chatHistory, setChatHistory] = useState({}); // { dayId: { step: 0 } }
            const [activeModal, setActiveModal] = useState(null); // 'story', 'chat'
            const [currentDay, setCurrentDay] = useState(null);
            const [notifications, setNotifications] = useState([]);
            const [unreadCount, setUnreadCount] = useState(0);
            const [testMode, setTestMode] = useState(false);
            const [countdown, setCountdown] = useState("Sz√°mol√°s...");

            // Bet√∂lt√©s
            useEffect(() => {
                const savedDays = JSON.parse(localStorage.getItem('openedDays')) || [];
                const savedChat = JSON.parse(localStorage.getItem('chatHistory')) || {};
                setUnlockedDays(savedDays);
                setChatHistory(savedChat);
                
                // Unread count: azok a napok, ahol m√©g nem v√°laszoltunk (step < 3)
                // Itt egyszer≈±s√≠tve: ha kinyitotta a napot, de nem l√°tta a chatet
            }, []);

            // Visszasz√°ml√°l√≥
            useEffect(() => {
                const timer = setInterval(() => {
                    const target = new Date("Dec 24, 2025 18:00:00").getTime();
                    const now = new Date().getTime();
                    const diff = target - now;
                    if (diff > 0) {
                        const d = Math.floor(diff / (1000 * 60 * 60 * 24));
                        const h = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                        const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                        setCountdown(`M√©g ${d} nap ${h} √≥ra ${m} perc`);
                    } else setCountdown("BOLDOG KAR√ÅCSONYT!");
                }, 1000);
                return () => clearInterval(timer);
            }, []);

            // √ârtes√≠t√©s kezel√©s
            const addNotification = (name, text, icon) => {
                const id = Date.now();
                setNotifications(prev => [{id, name, text, icon}, ...prev]);
                setTimeout(() => {
                    setNotifications(prev => prev.filter(n => n.id !== id));
                }, 6000);
            };

            const handleDayClick = (day) => {
                const today = new Date().getDate();
                // √âlesben: new Date().getMonth() === 11 && day.id <= today
                const isAvailable = testMode || day.id <= today; // Teszt: minden el√©rhet≈ë ha a d√°tum engedi vagy test mode
                
                if (isAvailable) {
                    if (!unlockedDays.includes(day.id)) {
                        // √öj nyit√°s
                        const newUnlocked = [...unlockedDays, day.id];
                        setUnlockedDays(newUnlocked);
                        localStorage.setItem('openedDays', JSON.stringify(newUnlocked));
                        setUnreadCount(c => c + 1);
                        
                        // √ârtes√≠t√©sek ind√≠t√°sa
                        const char = characters[day.char];
                        addNotification(char.name, day.chats[0], char.icon);
                        setTimeout(() => {
                            addNotification(char.name, day.chats[1], "üéÅ");
                        }, 4000);
                    }
                    setCurrentDay(day);
                    setActiveModal('story');
                } else {
                    // Dorg√°l√°s
                    const scolds = ["M√©g nem szabad! ü§´", "Ez m√©g alszik! üò¥", "Ejnye-bejnye! üëÄ"];
                    addNotification("Rendszer", scolds[Math.floor(Math.random()*scolds.length)], "üîí");
                }
            };

            const openChat = () => {
                setUnreadCount(0);
                setActiveModal('chat');
            };

            // Chat logika
            const handleReply = (dayId, replyIndex) => {
                const day = stories.find(d => d.id === dayId);
                const reply = day.replies[replyIndex];
                
                // Mentj√ºk a v√°laszt
                const newHistory = { ...chatHistory, [dayId]: { replyIndex, timestamp: Date.now() } };
                setChatHistory(newHistory);
                localStorage.setItem('chatHistory', JSON.stringify(newHistory));
            };

            return (
                <div className="app-container">
                    {/* H√ÅTT√âR */}
                    <div className="aurora-bg">
                        <div className="orb" style={{background: '#66ccff', width: '300px', top: '20%', left: '10%'}}></div>
                        <div className="orb" style={{background: 'purple', width: '250px', bottom: '20%', right: '10%'}}></div>
                    </div>
                    {[...Array(50)].map((_, i) => <div key={i} className="snowflake" style={{left: Math.random()*100+'%', animationDuration: (Math.random()*3+2)+'s', width: (Math.random()*5+2)+'px', height: (Math.random()*5+2)+'px'}}></div>)}

                    {/* √âRTES√çT√âSEK */}
                    <div style={{position: 'absolute', top: 10, left: 10, right: 10, zIndex: 200}}>
                        {notifications.map(n => (
                            <div key={n.id} className="notification" onClick={openChat}>
                                <div style={{fontSize: '24px'}}>{n.icon}</div>
                                <div>
                                    <div style={{fontWeight: 'bold', marginBottom: '2px'}}>{n.name}</div>
                                    <div style={{fontSize: '12px', opacity: 0.8}}>{n.text}</div>
                                </div>
                            </div>
                        ))}
                    </div>

                    {/* TARTALOM */}
                    <header>
                        <div style={{fontSize: '32px'}} onClick={() => setTestMode(!testMode)}>‚ùÑÔ∏è</div>
                        <h1>MAMA KALEND√ÅRIUMA</h1>
                        <div className="countdown">{countdown}</div>
                    </header>

                    <div className="grid">
                        {stories.map(day => (
                            <div key={day.id} 
                                 className={`day-cell ${unlockedDays.includes(day.id) ? 'unlocked' : (testMode || day.id <= new Date().getDate()) ? '' : 'locked'}`}
                                 onClick={() => handleDayClick(day)}>
                                {unlockedDays.includes(day.id) ? 'üéÅ' : day.id}
                                {!unlockedDays.includes(day.id) && (!testMode && day.id > new Date().getDate()) && <div className="lock-icon">üîí</div>}
                            </div>
                        ))}
                    </div>

                    <div className="bottom-bar">
                        <div className="btn" onClick={openChat} style={{position: 'relative'}}>
                            <span>üí¨</span> √úzenetek
                            {unreadCount > 0 && <div className="badge">{unreadCount}</div>}
                        </div>
                    </div>

                    {/* MESE MODAL */}
                    {activeModal === 'story' && currentDay && (
                        <div className="modal-overlay" onClick={() => setActiveModal(null)}>
                            <div className="modal-content" onClick={e => e.stopPropagation()}>
                                <div className="modal-header">
                                    <span>üìú {currentDay.title}</span>
                                    <button className="btn" style={{padding: '5px 10px'}} onClick={() => setActiveModal(null)}>‚úï</button>
                                </div>
                                <div className="modal-body">
                                    <p>{currentDay.msg}</p>
                                    <hr style={{borderColor: 'rgba(255,255,255,0.1)', margin: '20px 0'}} />
                                    <div style={{textAlign: 'center', fontStyle: 'italic', color: '#66ccff'}}>
                                        üí° N√©zd meg az √ºzeneteket, aj√°nd√©kod √©rkezett!
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* CHAT MODAL */}
                    {activeModal === 'chat' && (
                        <div className="modal-overlay" onClick={() => setActiveModal(null)}>
                            <div className="modal-content" style={{height: '100%', borderRadius: 0, width: '100%', maxWidth: '100%'}} onClick={e => e.stopPropagation()}>
                                <div className="modal-header" style={{background: 'rgba(0,0,0,0.8)'}}>
                                    <span>üí¨ Besz√©lget√©sek</span>
                                    <button className="btn" onClick={() => setActiveModal(null)}>Bez√°r√°s</button>
                                </div>
                                <div className="chat-body">
                                    {unlockedDays.map(id => {
                                        const day = stories.find(d => d.id === id);
                                        const char = characters[day.char];
                                        const state = chatHistory[id] || {};
                                        const hasReplied = state.replyIndex !== undefined;

                                        return (
                                            <div key={id}>
                                                <div style={{textAlign: 'center', fontSize: '10px', color: '#555', margin: '10px 0'}}>December {day.id}.</div>
                                                
                                                {/* Pl√ºss √ºzenetek */}
                                                <div className="message-group">
                                                    <div className="msg-row">
                                                        <div className="avatar">{char.icon}</div>
                                                        <div className="msg them">{day.chats[0]}</div>
                                                    </div>
                                                    <div className="msg-row" style={{marginTop: '5px'}}>
                                                        <div className="avatar" style={{opacity: 0}}>x</div>
                                                        <div className="msg them">{day.chats[1]}</div>
                                                    </div>
                                                </div>

                                                {/* V√°laszok */}
                                                {hasReplied ? (
                                                    <>
                                                        <div className="msg me" style={{marginTop: '10px'}}>{day.replies[state.replyIndex].u}</div>
                                                        <div className="msg-row" style={{marginTop: '10px'}}>
                                                            <div className="avatar">{char.icon}</div>
                                                            <div className="msg them">{day.replies[state.replyIndex].c}</div>
                                                        </div>
                                                    </>
                                                ) : (
                                                    <div className="reply-area">
                                                        {day.replies.map((r, idx) => (
                                                            <div key={idx} className="reply-chip" onClick={() => handleReply(day.id, idx)}>
                                                                {r.u}
                                                            </div>
                                                        ))}
                                                    </div>
                                                )}
                                            </div>
                                        );
                                    })}
                                    {unlockedDays.length === 0 && <div style={{textAlign:'center', color:'#666', marginTop: '50px'}}>M√©g √ºres a postal√°da... Nyiss ki egy ablakot!</div>}
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
