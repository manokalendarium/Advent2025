<!DOCTYPE html>
<html lang="hu">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Mama Kalend√°riuma</title>

    <link
      href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
    />

    <style>
      :root {
        --ios-blue: #007aff;
        --ios-gray: #262629;
        --ios-bg: #000000;
        --ios-text: #ffffff;
        --ios-gray-text: #8e8e93;
        --glass: rgba(30, 30, 30, 0.6);
        --glass-border: rgba(255, 255, 255, 0.15);
        --royal-gold: #ffd700;
      }

      * {
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
      }
      body {
        margin: 0;
        font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display",
          "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        background: #000;
        color: white;
        overflow: hidden;
        height: 100vh;
        width: 100vw;
      }

      /* --- ANIM√ÅCI√ìK --- */
      @keyframes popIn {
        0% {
          transform: scale(0.8);
          opacity: 0;
        }
        100% {
          transform: scale(1);
          opacity: 1;
        }
      }
      @keyframes slideUp {
        0% {
          transform: translateY(20px);
          opacity: 0;
        }
        100% {
          transform: translateY(0);
          opacity: 1;
        }
      }
      @keyframes shine {
        0% {
          left: -100%;
        }
        100% {
          left: 100%;
        }
      }
      @keyframes float {
        0% {
          transform: translate(0, 0);
        }
        100% {
          transform: translate(40px, 60px);
        }
      }
      @keyframes notifSlide {
        from {
          transform: translateY(-100px);
        }
        to {
          transform: translateY(0);
        }
      }

      /* Kattint√°s effekt (rug√≥s) */
      .clickable:active {
        transform: scale(0.95);
        transition: transform 0.1s;
      }

      /* --- H√ÅTT√âR & EFFEKTEK --- */
      /* --- H√ÅTT√âR & EFFEKTEK (KAR√ÅCSONYI JAV√çT√ÅS) --- */
      .background {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
        /* M√©ly, s√∂t√©tv√∂r√∂s alap, ami √ºnnep√©lyes */
        background: radial-gradient(circle at center, #2b0a0a, #000000);
        filter: blur(10px);
      }
      .orb {
        position: absolute;
        border-radius: 50%;
        filter: blur(90px); /* Puh√°bb, k√∂d√∂sebb f√©nyek */
        opacity: 0.6;
        animation: float 15s infinite ease-in-out alternate;
      }
      .orb-1 {
        width: 350px;
        height: 350px;
        /* √únnepi piros */
        background: #d42426;
        top: -60px;
        left: -60px;
      }
      .orb-2 {
        width: 450px;
        height: 450px;
        /* Feny≈ëz√∂ld */
        background: #ff0000;
        bottom: -100px;
        right: -100px;
        animation-delay: -5s;
      }

      .snowflake {
        position: absolute;
        background: white; /* Ez adja a feh√©r sz√≠nt */
        border-radius: 50%;
        opacity: 0.8;
        pointer-events: none;
        animation: fall linear infinite;
        box-shadow: 0 0 5px rgba(255, 255, 255, 0.8); /* Ragyog√≥bb h√≥pih√©k */
      }
      @keyframes fall {
        to {
          transform: translateY(105vh);
        }
      }

      /* --- F≈ê TART√ÅLY --- */
      #app-root {
        height: 100%;
        display: flex;
        justify-content: center;
      }
      .app-screen {
        width: 100%;
        max-width: 480px;
        height: 100%;
        display: flex;
        flex-direction: column;
        position: relative;
        background: rgba(0, 0, 0, 0.2);
        overflow: hidden;
      }

      /* --- API KULCS MODAL --- */
      .api-modal {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        z-index: 999;
        display: flex;
        align-items: center;
        justify-content: center;
        animation: popIn 0.3s ease-out;
      }
      .api-card {
        width: 85%;
        background: #1c1c1e;
        padding: 30px;
        border-radius: 24px;
        text-align: center;
        border: 1px solid #333;
        box-shadow: 0 20px 50px rgba(0, 0, 0, 0.8);
      }
      .api-input {
        width: 100%;
        padding: 12px;
        margin: 15px 0;
        background: #2c2c2e;
        border: 1px solid #444;
        border-radius: 12px;
        color: white;
        font-size: 16px;
        outline: none;
      }

      /* --- HEADER, CAROUSEL, TAB BAR --- */
      .grid-view-container {
        flex: 1;
        display: flex;
        flex-direction: column;
      }
      .header {
        padding: 20px;
        text-align: center;
        position: relative;
        z-index: 10;
      }
      .app-title {
        font-size: 12px;
        letter-spacing: 2px;
        text-transform: uppercase;
        color: rgba(255, 255, 255, 0.5);
        margin-bottom: 5px;
      }
      .main-title {
        font-size: 28px;
        font-weight: 800;
        background: linear-gradient(135deg, #fff, #ccc);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        text-shadow: 0 4px 20px rgba(255, 255, 255, 0.3);
      }
      .countdown {
        font-family: monospace;
        font-size: 11px;
        background: rgba(255, 255, 255, 0.1);
        padding: 4px 8px;
        border-radius: 6px;
        display: inline-block;
        margin-top: 8px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: var(--royal-gold);
      }

      /* --- CAROUSEL CONTAINER --- */
      .grid-container {
        flex: 1;
        overflow-x: auto;
        overflow-y: hidden;
        padding: 0 22.5vw;
        display: flex;
        gap: 20px;
        align-items: center;
        scroll-snap-type: x mandatory;
        scroll-behavior: smooth;
        perspective: 1000px;
      }

      .grid-container::-webkit-scrollbar {
        display: none;
      }

      /* --- KISEBB K√ÅRTY√ÅK --- */
      .day-card {
        min-width: 55vw;
        height: 45vh;
        background: rgba(255, 183, 0, 0.266);
        border-radius: 28px;
        border: 1px solid rgba(255, 204, 0, 0.1);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        position: relative;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        box-shadow: 0 10px 30px rgba(255, 170, 0, 0.4);

        scroll-snap-align: center;
        flex-shrink: 0;
        overflow: hidden;
      }

      .day-card.locked {
        opacity: 0.5;
        transform: scale(0.9);
        filter: grayscale(80%);

        background: rgba(255, 0, 0, 0.4);
        border-color: rgba(255, 0, 0, 0.05);
      }

      .day-num {
        font-size: 70px;
        font-weight: 800;
        background: linear-gradient(to bottom, #fff, #888);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      .status-icon {
        font-size: 50px;
        animation: popIn 0.3s;
      }

      .day-card.opened {
        background: rgba(0, 255, 47, 0.15);
        border-color: rgba(0, 255, 42, 0.5);
        box-shadow: 0 0 30px rgba(0, 255, 26, 0.25);
        transform: scale(1.05);
      }

      .day-card.opened::after {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 50%;
        height: 100%;
        background: linear-gradient(
          to right,
          transparent,
          rgba(255, 255, 255, 0.1),
          transparent
        );
        transform: skewX(-25deg);
        animation: shine 4s infinite;
      }

      .tab-bar {
        background: rgba(20, 20, 20, 0.85);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        padding: 10px 30px 30px 30px;
        display: flex;
        justify-content: space-around;
        z-index: 20;
      }
      .tab-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 4px;
        color: #888;
        cursor: pointer;
        transition: color 0.2s;
        position: relative;
      }
      .tab-item.active {
        color: #007aff;
        transform: scale(1.1);
        transition: transform 0.2s;
      }
      .tab-icon {
        font-size: 24px;
      }
      .tab-label {
        font-size: 10px;
        font-weight: 500;
      }
      .badge {
        position: absolute;
        top: -2px;
        right: -5px;
        background: #ff3b30;
        color: white;
        font-size: 10px;
        font-weight: bold;
        min-width: 16px;
        height: 16px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 2px;
        animation: popIn 0.3s;
      }

      /* --- MESE MODAL --- */
      .modal-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(5px);
        z-index: 50;
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s;
      }
      .modal-overlay.active {
        opacity: 1;
        pointer-events: auto;
      }

      .story-card {
        width: 85%;
        max-height: 80%;
        background: #1c1c1e;
        border-radius: 24px;
        padding: 24px;
        box-shadow: 0 20px 50px rgba(0, 0, 0, 0.8);
        border: 1px solid rgba(255, 255, 255, 0.1);
        display: flex;
        flex-direction: column;
        transform: scale(0.9);
        transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      }
      .modal-overlay.active .story-card {
        transform: scale(1);
      }

      .story-title {
        font-size: 22px;
        font-weight: 700;
        margin-bottom: 15px;
        color: white;
        text-align: center;
      }
      .story-text {
        font-size: 17px;
        line-height: 1.5;
        color: #ddd;
        overflow-y: auto;
        flex: 1;
        margin-bottom: 5px;
        font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display",
          "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        text-align: justify;
        padding-right: 5px;
        animation: slideUp 0.3s ease-out;
      }
      .story-text p {
        margin: 1em 0;
      }
      .story-btn {
        background: #007aff;
        color: white;
        border: none;
        padding: 10px;
        border-radius: 14px;
        font-size: 15px;
        font-weight: 600;
        width: 100%;
        cursor: pointer;
        transition: all 0.1s;
      }
      .story-btn:active {
        transform: scale(0.95);
      }
      .dot-indicator {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #444;
        transition: background 0.3s;
      }
      .dot-indicator.active {
        background: #007aff;
        transform: scale(1.2);
      }

      /* --- CHAT K√âPERNY≈êK --- */
      .chat-screen-container {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #000;
        z-index: 100;
        display: flex;
        flex-direction: column;
        transform: translateX(100%);
        transition: transform 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
      }
      .chat-screen-container.active {
        transform: translateX(0);
      }

      .chat-header {
        background: rgba(20, 20, 20, 0.85);
        backdrop-filter: blur(20px);
        padding: 70px 0px 10px 0px;
        display: flex;
        align-items: center;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        z-index: 20;
      }
      .back-btn {
        color: #007aff;
        font-size: 17px;
        display: flex;
        align-items: center;
        gap: 5px;
        cursor: pointer;
      }
      .chat-avatar-header {
        display: flex;
        flex-direction: column;
        align-items: center;
        flex: 1;
        margin-right: 40px;
      }
      .header-avatar {
        font-size: 24px;
        margin-bottom: 2px;
        transition: transform 0.2s;
        cursor: pointer;
      }
      .header-avatar:active {
        transform: scale(1.2);
      }
      .header-name {
        font-size: 12px;
        color: #fff;
        font-weight: 500;
      }

      .chat-body {
        flex: 1;
        overflow-y: auto;
        padding: 15px;
        display: flex;
        flex-direction: column;
        gap: 8px;
        padding-bottom: 80px;
        scroll-behavior: smooth;
      }
      .message-row {
        display: flex;
        width: 100%;
        margin-bottom: 4px;
        opacity: 0;
        animation: slideUp 0.3s forwards;
      }
      .message-row.me {
        justify-content: flex-end;
      }
      .message-row.them {
        justify-content: flex-start;
        align-items: flex-end;
      }

      .avatar-small {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        background: #333;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
        margin-right: 8px;
      }

      .bubble.image-bubble {
        background: none;
        padding: 0;
        border-radius: 20px 20px 20px 4px;
        overflow: hidden;
        max-width: 75%;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      }
      .bubble.image-bubble img {
        max-width: 100%;
        display: block;
        border-radius: 12px;
        filter: brightness(0.95);
      }

      .bubble {
        max-width: 75%;
        padding: 10px 16px;
        font-size: 17px;
        line-height: 1.4;
        position: relative;
      }
      .bubble.me {
        background: #007aff;
        color: white;
        border-radius: 20px 20px 4px 20px;
      }
      .bubble.them {
        background: #262628;
        color: white;
        border-radius: 20px 20px 20px 4px;
      }

      .chat-input-bar {
        position: absolute;
        bottom: 0;
        width: 100%;
        background: rgba(20, 20, 20, 0.9);
        backdrop-filter: blur(20px);
        padding: 10px 15px 30px 15px;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .ios-input {
        flex: 1;
        background: #1c1c1e;
        border: 1px solid #333;
        border-radius: 20px;
        padding: 8px 15px;
        color: white;
        font-size: 17px;
        outline: none;
      }
      .send-circle {
        width: 30px;
        height: 30px;
        background: #007aff;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 16px;
        cursor: pointer;
        transition: all 0.2s;
      }
      .send-circle:active {
        transform: scale(0.9);
      }
      .send-circle.disabled {
        background: #444;
        color: #888;
        pointer-events: none;
      }

      .typing-bubble {
        background: #262628;
        padding: 12px 16px;
        border-radius: 20px;
        width: fit-content;
        display: flex;
        gap: 4px;
        align-items: center;

        border-bottom-left-radius: 4px;
        animation: popIn 0.3s;
      }
      .dot {
        width: 6px;
        height: 6px;
        background: #8e8e93;
        border-radius: 50%;
        animation: bounce 1.4s infinite ease-in-out both;
      }
      .dot:nth-child(1) {
        animation-delay: -0.32s;
      }
      .dot:nth-child(2) {
        animation-delay: -0.16s;
      }
      @keyframes bounce {
        0%,
        80%,
        100% {
          transform: scale(0);
        }
        40% {
          transform: scale(1);
        }
      }

      .reply-chips {
        display: flex;
        gap: 8px;
        padding: 10px 15px;
        overflow-x: auto;
        background: rgba(20, 20, 20, 0.9);
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        animation: slideUp 0.3s;
      }
      .chip {
        background: #1c1c1e;
        color: #007aff;
        border: 1px solid #007aff;
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 15px;
        white-space: nowrap;
        cursor: pointer;
        transition: background 0.1s;
      }
      .chip:active {
        background: #007aff;
        color: white;
        transform: scale(0.95);
      }

      /* --- iOS NOTIFICATION --- */
      .notification-container {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 200;
      }
      .ios-notification {
        position: absolute;
        top: 10px;
        left: 10px;
        right: 10px;
        background: rgba(30, 30, 30, 0.85);
        backdrop-filter: blur(25px);
        border-radius: 18px;
        padding: 12px;
        display: flex;
        gap: 12px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
        pointer-events: auto;
        cursor: pointer;
        animation: notifSlide 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }
      .notif-icon {
        width: 40px;
        height: 40px;
        background: #333;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 22px;
      }
      .notif-content {
        flex: 1;
      }
      .notif-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: 2px;
      }
      .notif-title {
        font-weight: 600;
        font-size: 14px;
        color: white;
      }
      .notif-msg {
        font-size: 14px;
        color: #fff;
        line-height: 1.2;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }

      .test-btn {
        position: absolute;
        top: 20px;
        left: 20px;
        font-size: 24px;
        opacity: 0.5;
        cursor: pointer;
        z-index: -1000;
        transition: opacity 0.2s;
      }
      .test-btn:active {
        opacity: 0;
        transform: scale(1.2);
      }
      /* --- GY≈∞JTEM√âNY √âS GAL√âRIA ST√çLUSOK --- */
      .collection-grid {
        display: grid;
        grid-template-columns: 1fr 1fr; /* K√©t oszlop */
        gap: 15px;
        padding: 20px;
        width: 100%;
        overflow-y: auto;
        padding-bottom: 80px; /* Hely a tab bar-nak */
      }

      .collection-card {
        background: #1c1c1e;
        border: 1px solid rgba(255, 215, 0, 0.2); /* Aranyos keret */
        border-radius: 16px;
        padding: 15px;
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        animation: popIn 0.3s backwards;
      }

      .gift-icon {
        font-size: 30px;
        margin-bottom: 8px;
      }

      .gift-name {
        font-size: 14px;
        font-weight: 600;
        color: white;
      }

      .gift-day {
        font-size: 10px;
        color: #888;
        margin-top: 4px;
        text-transform: uppercase;
      }

      .gallery-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr); /* H√°rom oszlop */
        gap: 2px;
        width: 100%;
        overflow-y: auto;
        padding-bottom: 80px;
      }

      .gallery-item {
        position: relative;
        aspect-ratio: 1; /* N√©gyzet alak√∫ */
        overflow: hidden;
        cursor: pointer;
        animation: popIn 0.3s backwards;
      }

      .gallery-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s;
      }

      .gallery-item:active img {
        transform: scale(0.95);
        opacity: 0.8;
      }

      /* Rejtj√ºk az √ºres √°llapotot, ha van tartalom */
      .hidden {
        display: none !important;
      }
    </style>
  </head>
  <body>
    <div id="app-root">
      <div class="app-screen">
        <div class="background">
          <div class="orb orb-1"></div>
          <div class="orb orb-2"></div>
        </div>

        <div id="api-modal" class="api-modal" style="display: none">
          <div class="api-card">
            <div style="font-size: 40px">üîë</div>
            <h2>Szia Mama!</h2>
            <p>K√©rlek add meg a szupertitkos jelsz√≥t!</p>
            <input
              id="api-input"
              class="api-input"
              placeholder="M√°sold ide a jelsz√≥t..."
              type="text"
            />
            <button id="api-save-btn" class="story-btn clickable">
              Bel√©p√©s
            </button>
          </div>
        </div>

        <div id="test-btn" class="test-btn">‚öôÔ∏è</div>

        <div id="notification-container" class="notification-container"></div>

        <div id="grid-view" class="grid-view-container">
          <div class="header">
            <div class="app-title">MAMA KALEND√ÅRIUMA</div>
            <div class="main-title">2025</div>
            <div id="countdown" class="countdown"></div>
          </div>
          <div id="grid-container" class="grid-container"></div>
        </div>

        <div
          id="collection-view"
          class="grid-view-container"
          style="display: none"
        >
          <div class="header">
            <div class="app-title">MEGSZERZETT KINCSEK</div>
            <div class="main-title">Gy≈±jtem√©ny</div>
          </div>

          <div
            id="collection-placeholder"
            style="
              flex: 1;
              display: flex;
              flex-direction: column;
              align-items: center;
              justify-content: center;
              opacity: 0.6;
            "
          >
            <i
              class="bi bi-box-seam"
              style="font-size: 50px; display: block; margin-bottom: 10px"
            ></i>
            <p>M√©g nem nyitott√°l ki egy napot sem.</p>
          </div>

          <div
            id="collection-content"
            class="collection-grid"
            style="display: none"
          ></div>
        </div>

        <div
          id="gallery-view"
          class="grid-view-container"
          style="display: none"
        >
          <div class="header">
            <div class="app-title">EGY√úTT T√ñLT√ñTT PILLANATOK</div>
            <div class="main-title">Gal√©ria</div>
          </div>

          <div
            id="gallery-placeholder"
            style="
              flex: 1;
              display: flex;
              flex-direction: column;
              align-items: center;
              justify-content: center;
              opacity: 0.6;
            "
          >
            <i
              class="bi bi-images"
              style="font-size: 50px; display: block; margin-bottom: 10px"
            ></i>
            <p>Hamarosan itt jelennek meg a k√©pek.</p>
          </div>

          <div
            id="gallery-content"
            class="gallery-grid"
            style="display: none"
          ></div>
        </div>

        <div class="tab-bar">
          <div id="tab-grid" class="tab-item active clickable">
            <i class="bi bi-grid-fill tab-icon"></i>
            <span class="tab-label">Napt√°r</span>
          </div>

          <div id="tab-collection" class="tab-item clickable">
            <i class="bi bi-collection-play-fill tab-icon"></i>
            <span class="tab-label">Gy≈±jtem√©ny</span>
          </div>

          <div id="tab-gallery" class="tab-item clickable">
            <i class="bi bi-images tab-icon"></i>
            <span class="tab-label">Gal√©ria</span>
          </div>

          <div id="tab-chat" class="tab-item clickable">
            <div style="position: relative">
              <i class="bi bi-chat-fill tab-icon"></i>
              <div id="unread-badge" class="badge" style="display: none"></div>
            </div>
            <span class="tab-label">√úzenetek</span>
          </div>
        </div>

        <div id="story-modal" class="modal-overlay">
          <div class="story-card">
            <div id="story-title" class="story-title"></div>
            <div id="story-page-1" class="story-text story-page"></div>
            <div
              id="story-page-2"
              class="story-text story-page"
              style="display: none"
            ></div>

            <div
              id="story-nav"
              style="
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-top: 10px;
              "
            >
              <button
                id="story-prev-btn"
                class="story-btn clickable"
                style="
                  width: 20%;
                  background: rgba(255, 255, 255, 0.1);
                  color: #fff;
                "
              >
                <i class="bi bi-chevron-left"></i>
              </button>
              <div id="story-dots" style="display: flex; gap: 8px">
                <span id="dot-1" class="dot-indicator active"></span>
                <span id="dot-2" class="dot-indicator"></span>
              </div>
              <button
                id="story-next-btn"
                class="story-btn clickable"
                style="width: 20%"
              >
                <i class="bi bi-chevron-right"></i>
              </button>
            </div>
            <button
              id="story-close-btn"
              class="story-btn clickable"
              style="margin-top: 15px"
            >
              Bez√°r√°s
            </button>
          </div>
        </div>

        <div id="chat-screen-list" class="chat-screen-container">
          <div
            class="chat-header"
            style="justify-content: center; position: relative"
          >
            <div style="font-weight: bold; font-size: 17">√úzenetek</div>
            <div
              id="chat-list-close-btn"
              class="clickable"
              style="
                position: absolute;
                left: 15px;
                color: #007aff;
                cursor: pointer;
              "
            >
              Bez√°r√°s
            </div>
          </div>
          <div
            id="chat-list-body"
            class="chat-body"
            style="padding: 0; padding-top: 10px"
          ></div>
        </div>

        <div id="chat-screen-detail" class="chat-screen-container">
          <div class="chat-header">
            <div id="chat-detail-back-btn" class="back-btn clickable">
              <i class="bi bi-chevron-left"></i> Vissza
            </div>
            <div
              id="chat-detail-avatar-header"
              class="chat-avatar-header clickable"
            >
              <div id="chat-detail-icon" class="header-avatar"></div>
              <div id="chat-detail-name" class="header-name"></div>
            </div>
            <div style="width: 50px"></div>
          </div>
          <div id="chat-detail-body" class="chat-body"></div>
          <div id="reply-chips" class="reply-chips" style="display: none"></div>
          <div class="chat-input-bar">
            <input
              id="chat-input"
              class="ios-input"
              placeholder="iMessage"
              type="text"
            />
            <div id="chat-send-circle" class="send-circle disabled clickable">
              <i class="bi bi-arrow-up"></i>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // --- HANGOK (Base64) ---
      const SOUNDS = {
        pop: new Audio(
          "data:audio/wav;base64,UklGRl9vT19XQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU..."
        ),
        ding: new Audio(
          "data:audio/wav;base64,UklGRl9vT19XQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU..."
        ),
        paper: new Audio(
          "data:audio/wav;base64,UklGRl9vT19XQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU..."
        ),
      };

      // Egyszer≈± hanggener√°l√°s JS-b≈ël
      const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

      function playTone(freq, type, duration) {
        if (audioCtx.state === "suspended") audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(
          0.001,
          audioCtx.currentTime + duration
        );
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start();
        osc.stop(audioCtx.currentTime + duration);
      }

      function playSound(type) {
        if (type === "pop") playTone(600, "sine", 0.1);
        if (type === "ding") playTone(1200, "sine", 0.3);
        if (type === "paper") playTone(200, "triangle", 0.15);
      }

      // --- √ÅLLAND√ìK √âS ADATOK ---
      const ELEMENTS = {
        gridContainer: document.getElementById("grid-container"),
        gridView: document.getElementById("grid-view"),

        // --- √öJ ELEMEK ---
        collectionView: document.getElementById("collection-view"),
        galleryView: document.getElementById("gallery-view"),
        tabCollection: document.getElementById("tab-collection"),
        tabGallery: document.getElementById("tab-gallery"),
        collectionPlaceholder: document.getElementById(
          "collection-placeholder"
        ),
        collectionContent: document.getElementById("collection-content"),
        galleryPlaceholder: document.getElementById("gallery-placeholder"),
        galleryContent: document.getElementById("gallery-content"),
        // -----------------

        storyModal: document.getElementById("story-modal"),
        storyTitle: document.getElementById("story-title"),
        storyPage1: document.getElementById("story-page-1"),
        storyPage2: document.getElementById("story-page-2"),
        storyPrevBtn: document.getElementById("story-prev-btn"),
        storyNextBtn: document.getElementById("story-next-btn"),
        storyDot1: document.getElementById("dot-1"),
        storyDot2: document.getElementById("dot-2"),
        storyCloseBtn: document.getElementById("story-close-btn"),
        countdown: document.getElementById("countdown"),
        unreadBadge: document.getElementById("unread-badge"),

        tabGrid: document.getElementById("tab-grid"),
        tabChat: document.getElementById("tab-chat"),

        apiModal: document.getElementById("api-modal"),
        apiInput: document.getElementById("api-input"),
        apiSaveBtn: document.getElementById("api-save-btn"),
        notificationContainer: document.getElementById(
          "notification-container"
        ),
        chatScreenList: document.getElementById("chat-screen-list"),
        chatScreenDetail: document.getElementById("chat-screen-detail"),
        chatListBody: document.getElementById("chat-list-body"),
        chatDetailBody: document.getElementById("chat-detail-body"),
        chatInput: document.getElementById("chat-input"),
        chatSendCircle: document.getElementById("chat-send-circle"),
        replyChips: document.getElementById("reply-chips"),
        chatDetailIcon: document.getElementById("chat-detail-icon"),
        chatDetailName: document.getElementById("chat-detail-name"),
        testBtn: document.getElementById("test-btn"),
      };

      const CHARACTERS = {
        hanna: {
          name: "Hanna",
          icon: "üéÄ",
          desc: "r√≥zsasz√≠n, gondoskod√≥ l√°ny v√≠zil√≥",
          style:
            "Kedves, cuki kis cocli. Nagyon szereti a kaka√≥t, √©s m√©g b√∂lcsibe j√°r. Hobbija a szalt√≥z√°s √©s a t√°nciz√°s.",
          key: "hanna",
        },
        herold: {
          name: "Herold",
          icon: "ü¶õ",
          desc: "lila, puf√≥k √©s fal√°nk v√≠zil√≥. Nagyon szereti a kaka√≥t √©s m√°r oviba j√°r. Hobbika a kaka√≥ √©s a coccantgat√°s",
          style: "Vicces, √©hes, szeleburdi.",
          key: "herold",
        },
        bucko: {
          name: "Buck√≥",
          icon: "üê≥",
          desc: "k√©k, b√°tor kis b√°lna",
          style: "B√°tor, lelkes, nagyon szereti a vizet.",
          key: "bucko",
        },
      };

      // --- DORG√ÅL√ì √úZENETEK LIST√ÅJA ---
      const SCOLDING_MESSAGES = {
        hanna: [
          "Mama, ne rosszalkodj, ezt m√©g nem szabad!",
          "T√ºrelem, Mama! A meglepet√©sek √∫ton vannak.",
          "Ejnye-bejnye, valaki nagyon k√≠v√°ncsi!",
          "MAMA!! NEM!",
          "Mama nagyon gyorsan fejezd be",
        ],
        herold: [
          "Mama, most azonnal fejezd be!",
          "Mama, ezt nem szabad!",
          "Kicsit v√°rj m√°r, Mama!",
          "Mama most azonnal fejezd ezt be!",
          "Mama, ne nyomkodj m√°r r√° ezekre!",
        ],
        bucko: [
          "Mama, nem!",
          "Buck√≥ vagyok, √©s ezt nem engedem meg Mama.",
          "Ezt be lehet fejezni Mama!",
          "Mama, l√©gyszi fejezd be.",
          "Mama, olyat fogok mondani, hogy csak na.",
        ],
      };

      const CHAT_CONTACTS = [
        CHARACTERS.hanna,
        CHARACTERS.herold,
        CHARACTERS.bucko,
      ];

      const STORY_DATA = [
        // 1. HANNA
        {
          id: 1,
          char: "hanna",
          title: "A nagy elutaz√°s",
          gift: "Mini k√©zkr√©m",
          storyPage1: `A reggel k√∂d√∂sen indult, a leveg≈ëben m√°r √©rezni lehetett a t√©l illat√°t. Papa √©s Mama √≥ri√°si b≈ër√∂nd√∂ket cipeltek ki az aut√≥hoz. Herold coc√≥ az ablakban √°llt, √©s az orr√°t az √ºveghez nyomta, amit≈ël az egy kicsit lapos √©s vicces lett. Egy apr√≥ k√∂nnycsepp csillogott a szem√©ben. 
          ‚Äì Ne szomorkodj, Herold! ‚Äì l√©pett oda hozz√° Hanna coc√≥, √©s b√°tran √°t√∂lelte testv√©r√©t. 
          ‚Äì Mienk az eg√©sz h√°z, azt csin√°lunk, amit akarunk!`,
          storyPage2: `Ekkor megjelent Buck√≥, a kis b√°lna, fej√©n egy ford√≠tott t√©sztasz≈±r≈ëvel, ami √∫gy n√©zett ki, mint egy sisak.
            ‚Äì Jelentem, a b√°zis v√©delm√©t √°tvettem! ‚Äì harsogta m√©ly hangj√°n. ‚Äì Senki nem l√©phet be enged√©ly n√©lk√ºl, csak a post√°s, ha hoz csomagot!
            Papa √©s Mama meg√≠g√©rt√©k: kar√°csonyra, mire az els≈ë csillag felj√∂n, itthon lesznek.`,
          storyImageText:
            "N√©zd, √©pp most k√©sz√≠tettem egy k√©pet, ahogy integet√ºnk!",
          storyImageUrl:
            "https://res.cloudinary.com/dpgelqvbl/image/upload/v1764525804/Gemini_Generated_Image_cnwf5icnwf5icnwf_qtgnn1.png",
          msgs: [
            "Szia Mama! ‚ù§Ô∏è Ne agg√≥dj √©rt√ºnk, nagyon √ºgyesek vagyunk itthon! Herold m√°r nem is s√≠r. Vigy√°zz magadra! Puszilunk!",
            "A kist√°sk√°dba tettem egy kis k√©zkr√©met, haszn√°ld, nehogy kisz√°radjon a sz√©p kezed!",
          ],
          replies: [],
        },
        // 2. BUCK√ì
        {
          id: 2,
          char: "bucko",
          title: "Az els≈ë csendes este",
          gift: "M√©zeskal√°csos f√ºrd≈ëbomba",
          storyPage1:
            "Furcsa volt a h√°z a sz√ºl≈ëk n√©lk√ºl. Valahogy minden √°rny√©k nagyobbnak t≈±nt, √©s a padl√≥ is hangosabban recsegett, mintha l√©pkedne valaki. ‚Äì Szerintetek a szellem, aki a padl√°son lakik, szereti a kaka√≥t? ‚Äì k√©rdezte Herold vacsora k√∂zben remeg≈ë hangon, √©s a takar√≥ja al√° b√∫jt. ‚Äì Nincs is szellem, csak a sz√©l z√∂rgeti a cserepeket! ‚Äì nyugtatta meg Hanna, b√°r ≈ë is s≈±r≈±bben pislogott a s√∂t√©t folyos√≥ fel√©.",
          storyPage2:
            "Buck√≥ nem f√©lt. ≈ê a f√ºrd≈ëk√°dban rendezte be a f≈ëhadisz√°ll√°s√°t, mert hi√°nyzott neki a tenger. ‚Äì A v√≠zben jobban terjed a hang! ‚Äì magyar√°zta a t√∂bbieknek. ‚Äì Ha bet√∂r≈ë j√∂n, azonnal jelezni fogok: csapkodni fogok a farkammal, j√≥ hangosan! V√©g√ºl mindh√°rman a f√ºrd≈ëszoba sz≈ënyeg√©n aludtak el, a cs√∂p√∂g≈ë csap megnyugtat√≥ ritmus√°ra.",
          storyImageText:
            "N√©zd, √©pp most k√©sz√≠tettem egy k√©pet a f≈ëhadisz√°ll√°sr√≥l!",
          storyImageUrl:
            "https://res.cloudinary.com/dpgelqvbl/image/upload/v1764508586/Gemini_Generated_Image_lamfmdlamfmdlamf_1_kvugmy.png",
          msgs: [
            "Jelentem: a h√°z biztons√°gos! A f√ºrd≈ëk√°dban alszom, onnan mindent hallok. üê≥",
            "Hogy te is nyugodtan aludj, k√ºld√∂k neked egy M√©zeskal√°csos f√ºrd≈ëbomb√°t. Sz√©p √°lmokat!",
          ],
          replies: [],
        },
        // 3. HANNA
        {
          id: 3,
          char: "hanna",
          title: "A lila palacsinta party",
          gift: "Kr√©mes arcmaszk",
          storyPage1:
            "‚Äì Ma √©n vagyok a szak√°cs! ‚Äì jelentette ki Hanna coc√≥ m√°snap reggel, √©s felk√∂t√∂tte Mama legnagyobb k√∂t√©ny√©t, amiben k√©tszer is elf√©rt volna. √ögy d√∂nt√∂ttek, palacsint√°t s√ºtnek. De nem ak√°rmilyet! Herold lila √©telfest√©ket csemp√©szett a t√©szt√°ba, Hanna pedig r√≥zsasz√≠n cukork√°kat sz√≥rt bele.",
          storyPage2:
            "‚Äì Hopp! ‚Äì Hanna feldobta az els≈ë palacsint√°t, de az nem esett le. ‚Äì Hova t≈±nt? ‚Äì k√©rdezte Herold. Mindketten feln√©ztek: a lila t√©szta r√°tapadt a plafonra, mint egy furcsa csill√°r. Buck√≥ speci√°lis, s√≥s palacsint√°t k√©rt, de mivel nem volt alga otthon, spen√≥ttal helyettes√≠tett√©k. A v√©g√©n a konyha √∫gy n√©zett ki, mintha felrobbannt volna egy sziv√°rv√°nygy√°r, de a palacsinta isteni finom volt!",
          storyImageText: "N√©zd, mi lett az els≈ë palacsint√°b√≥l! üòÖ",
          storyImageUrl:
            "https://res.cloudinary.com/dpgelqvbl/image/upload/v1764525815/Gemini_Generated_Image_kkazkbkkazkbkkaz_akggft.png",
          msgs: [
            "Bocsi a konyh√°√©rt... üòÖ Kicsit lila lett a plafon. De √≠g√©rem, letakar√≠tjuk!",
            "Ha m√°r mi √∂sszekent√ºk magunkat, te kend be az arcodat ezzel a finom Kr√©mes arcmaszkkal. J√≥t fog tenni!",
          ],
          replies: [],
        },
        // 4. HEROLD
        {
          id: 4,
          char: "herold",
          title: "A nagy takar√≠t√≥ hadm≈±velet",
          gift: "Micell√°s v√≠z",
          storyPage1:
            "M√°snap reggel sz√∂rny≈± l√°tv√°ny fogadta ≈ëket a konyh√°ban. A tegnapi palacsint√°z√°s nyomai mindenhol ott √©ktelenkedtek. A liszt √∫gy sz√°llt a leveg≈ëben, mint a h√≥es√©s, a padl√≥ pedig ragadt a szirupt√≥l. ‚Äì Ezt nem hagyhatjuk √≠gy, mit sz√≥lnak majd Any√°√©k? ‚Äì s√≥hajtott Hanna. Herold el≈ëhozta a porsz√≠v√≥t, amit 'Sz√∂rnyetegnek' h√≠vott, mert mindig megpr√≥b√°lta bekapni a l√°bujj√°t.",
          storyPage2:
            "Buck√≥ v√°llalta a felmos√°st. Telet√∂lt√∂tte a sz√°j√°t v√≠zzel, √©s mint egy kis t≈±zolt√≥aut√≥, v√©gigspriccelte a k√∂vet. ‚Äì Buck√≥! Ez nem medenc√©s buli! ‚Äì ki√°ltotta Herold, mik√∂zben elcs√∫szott egy t√≥cs√°ban, √©s v√©gigsz√°nk√°zott a nappalin. D√©lut√°nra m√©gis csillogott-villogott minden. M√©g a plafonr√≥l is lekapart√°k a r√°sz√°radt palacsint√°t.",
          storyImageText: "N√©zd, milyen b√°tor voltam!",
          storyImageUrl:
            "https://res.cloudinary.com/dpgelqvbl/image/upload/v1764527021/Gemini_Generated_Image_ly0nxaly0nxaly0n_pmkuap.png",
          msgs: [
            "Mama! Ma √©n voltam a porsz√≠v√≥-kir√°ly! üëë B√°r elcs√∫sztam egy t√≥cs√°ban, de a h√°z ragyog. B√ºszke lenn√©l r√°nk!",
            "Neked csak a pihen√©s maradt: itt van egy Micell√°s v√≠z, hogy az arcod is olyan tiszta legyen, mint a padl√≥nk!",
          ],
          replies: [],
        },
        // 5. BUCK√ì
        {
          id: 5,
          char: "bucko",
          title: "Kincsvad√°szat a padl√°son",
          gift: "Arany szemmaszk",
          storyPage1: `Az es≈ë esett, √≠gy nem mehettek ki az udvarra. Felmentek a padl√°sra, ahol a r√©gi dobozok k√∂z√∂tt kutattak. A porcic√°k t√°ncot j√°rtak a besz≈±r≈ëd≈ë f√©nyben. 
            ‚Äì N√©zz√©tek! ‚Äì ki√°ltotta Buck√≥. 
            ‚Äì Ez egy igazi kal√≥zt√©rk√©p! Egy megs√°rgult pap√≠r volt az, amin furcsa vonalak kanyarogtak a nappali alaprajz√°n. 
            ‚Äì Itt az X! A kanap√© alatt! ‚Äì suttogta izgatottan Herold. 
            ‚Äì Biztosan aranyat rejt!`,
          storyPage2:
            "Lemosakodtak a f√∂ldszintre, √©s hason cs√∫szva, l√°mp√°ssal a k√©zben bek√∫sztak a kanap√© al√°. Kincsesl√°da helyett tal√°ltak: k√©t elveszettnek hitt leg√≥kock√°t, egy mogyor√≥t √©s Papa f√©l p√°r papucs√°t, amit m√°r tavaly √≥ta keresett. ‚Äì Ez a papucs √©rt√©kesebb b√°rmilyen aranyn√°l! Papa nagyon √∂r√ºlni fog! ‚Äì √°llap√≠totta meg b√∂lcsen Hanna.",
          storyImageText: "N√©zd, itt √©ppen vizsg√°ljuk a t√©rk√©pet:",
          storyImageUrl:
            "https://res.cloudinary.com/dpgelqvbl/image/upload/v1764527377/kalozok_pkorzx.jpg",
          msgs: [
            "K√©pzeld! Tal√°ltunk kincset!! üè¥‚Äç‚ò†Ô∏è J√≥, nem aranyat, hanem Apa papucs√°t, de szerintem ez m√©g √©rt√©kesebb.",
            "De neked tal√°ltunk igazi aranyat! Tedd fel ezt az Arany szemmaszkot, √©s ragyogj!",
          ],
          replies: [],
        },
        // 6. HANNA
        {
          id: 6,
          char: "hanna",
          title: "K√©sz√ºl≈ëd√©s a Mikul√°sra",
          gift: "K√∂r√∂mlakk",
          storyPage1:
            "December 5-e est√©je volt. A legfontosabb feladat v√°rt r√°juk: a cip≈ëpucol√°s. Herold a legnagyobb t√©li bakancs√°t vette el≈ë, √©s addig d√∂rzs√∂lte, am√≠g l√°tni nem lehetett benne az arc√°t. ‚Äì Ebbe sok csoki f√©r! ‚Äì kacsintott. Hanna a legcsinosabb lakkcip≈ëj√©t f√©nyes√≠tette ronggyal.",
          storyPage2:
            "De mi legyen Buck√≥val? Neki nincs l√°ba, √≠gy cip≈ëje sincs. Szomor√∫an l√≥gatta az orr√°t. ‚Äì Ne b√∫sulj, Buck√≥! ‚Äì mondta Hanna. ‚Äì Itt van a felmos√≥v√∂d√∂r! Kitiszt√≠tjuk, √©s ez lesz a te csizm√°d! Este mindh√°rman az ablakba tett√©k a l√°bbeliket (√©s a v√∂dr√∂t), majd izgatottan figyelt√©k az eget. ‚Äì Szerintetek a r√©nszarvasok tudnak √∫szni? ‚Äì k√©rdezte Buck√≥ √°s√≠tva, miel≈ëtt elnyomta az √°lom.",
          storyImageText: "Ezt n√©zd, √≠gy k√©sz√ºl√ºnk:",
          storyImageUrl:
            "https://res.cloudinary.com/dpgelqvbl/image/upload/v1764527622/Gemini_Generated_Image_v98j73v98j73v98j_mp9goj.png",
          msgs: [
            "Kif√©nyes√≠tett√ºk a cip≈ëket! ‚ú® Buck√≥nak a felmos√≥v√∂dr√∂t adtuk oda. Szerinted a Mikul√°s hoz neki abba is aj√°nd√©kot?",
            "Itt az ideje, hogy a te k√∂rmeid is ragyogjanak! K√ºld√ºnk egy sz√©p K√∂r√∂mlakkot az √ºnnepekre. üíÖ",
          ],
          replies: [],
        },
        // 7. BUCK√ì
        {
          id: 7,
          char: "bucko",
          title: "Mit hozott a T√©lap√≥?",
          gift: "Selyem hajgumi",
          storyPage1:
            "Reggel m√©g a nap sem kelt fel, de Herold m√°r kiugrott az √°gyb√≥l. ‚Äì Itt j√°rt! ITT J√ÅRT! ‚Äì vis√≠totta, √©s berontott a nappaliba. A bakancsok tele voltak finoms√°ggal. Herold kapott egy zacsk√≥ lila gumicukrot √©s egy kis aut√≥t. Hanna cip≈ëj√©ben csillog√≥ hajcsatok √©s mogyor√≥s csoki lapult.",
          storyPage2:
            "√âs Buck√≥ v√∂dre? Az volt a legnehezebb! Tele volt v√≠zi-j√°t√©kokkal √©s egy hatalmas csomag gumihallal. ‚Äì M√©gis tudta! ‚Äì ujjongott Buck√≥, √©s belevetette mag√°t a v√∂d√∂rbe. ‚Äì Tudta, hogy itt lakik egy b√°lna! Eg√©sz d√©lel≈ëtt csokit ettek reggelire, eb√©dre √©s uzsonn√°ra is. (De fogat mosni az√©rt nem felejtettek el!)",
          storyImageText: "N√©zd, a Mikul√°s aj√°nd√©ka a v√∂dr√∂mben! üòç",
          storyImageUrl:
            "https://res.cloudinary.com/dpgelqvbl/image/upload/v1764527921/Gemini_Generated_Image_wdhltywdhltywdhl_rv4ba3.png",
          msgs: [
            "MAMA!!! A Mikul√°s tudta!!! üòç Hozott gumihalat a v√∂dr√∂mbe! Ez a legjobb napom!",
            "Neked is hozott valamit! Ezt a puha Selyem hajgumit a kis dobozban tal√°lod. üéÄ",
          ],
          replies: [],
        },
        // 8. HEROLD
        {
          id: 8,
          char: "herold",
          title: "Az els≈ë h√≥pih√©k",
          gift: "Test√°pol√≥",
          storyPage1:
            "D√©lut√°n valami csoda t√∂rt√©nt. Az √©gb≈ël apr√≥, feh√©r vattacukrok kezdtek hullani. ‚Äì H√ì! ‚Äì ki√°ltotta egyszerre a h√°rom bar√°t, √©s az ablakhoz tapadtak. Gyorsan fel√∂lt√∂ztek. Hanna s√°lat k√∂t√∂tt, Herold sapk√°t h√∫zott, Buck√≥ pedig kapott egy speci√°lis, v√≠z√°ll√≥ kis mell√©nyt, hogy ne f√°zzon a hasa a hidegben.",
          storyPage2:
            "A kert feh√©rbe √∂lt√∂z√∂tt. Herold kiny√∫jtotta a nyelv√©t, √©s elkapott egy h√≥pih√©t. ‚Äì Milyen √≠ze van? ‚Äì k√©rdezte Hanna. ‚Äì Olyan, mint a hideg limon√°d√©, csak citrom √©s cukor n√©lk√ºl! ‚Äì v√°laszolta Herold. Buck√≥ megpr√≥b√°lt 'h√≥angyalt' csin√°lni, de mivel nincsenek karjai √©s l√°bai, ink√°bb egy nagy 'h√≥-kiflit' siker√ºlt alkotnia a h√≥ban hemperg≈ëzve.",
          storyImageText: "N√©zd, ez lett Buck√≥ h√≥-kiflije ü§£",
          storyImageUrl:
            "https://res.cloudinary.com/dpgelqvbl/image/upload/v1764528165/h%C3%B3_cgxjkw.jpg",
          msgs: [
            "Esik a h√≥! ‚ùÑÔ∏è Megk√≥stoltam, olyan mint a fagyott v√≠z, csak √≠z n√©lk√ºl. Kiment√ºnk j√°tszani!",
            "Hogy te se f√°zz, itt egy finom illat√∫ Test√°pol√≥. Kend be magad vele f√ºrd√©s ut√°n! ü••",
          ],
          replies: [],
        },
        // 9. BUCK√ì
        {
          id: 9,
          char: "bucko",
          title: "H√≥-b√°lna √©p√≠t√©s",
          gift: "Hidrat√°l√≥ f√°tyolmaszk",
          storyPage1:
            "Mindenki h√≥embert √©p√≠t t√©len. De nem ≈ëk! ≈êk valami k√ºl√∂nlegeset akartak. ‚Äì √âp√≠ts√ºnk egy H√≥-b√°ln√°t! ‚Äì javasolta Hanna, √©s Buck√≥ra kacsintott. Hatalmas h√≥goly√≥kat gy√∫rtak √∂ssze, de nem egym√°s tetej√©re tett√©k ≈ëket, hanem egym√°s mell√©, hossz√∫ sorban. A H√≥-b√°lna uszonya j√©gcsapb√≥l k√©sz√ºlt, a szeme pedig k√©t nagy darab sz√©n volt, amit a f√©szerben tal√°ltak.",
          storyPage2:
            "‚Äì De mi legyen az orr√°val? ‚Äì t≈±n≈ëd√∂tt Herold. V√©g√ºl egy s√°rgar√©p√°t nyomtak a feje tetej√©re. ‚Äì Ez nem az orra, te butus! Ez a l√©gz≈ëny√≠l√°sa! ‚Äì magyar√°zta b√ºszk√©n Buck√≥, √©s boldogan p√≥zolt a h√≥b√≥l k√©sz√ºlt, fagyos hasonm√°sa mellett.",
          storyImageText: "N√©zd, √≠gy n√©z ki a H√≥-b√°lna s√°rgar√©pa l√©gz≈ëny√≠l√°sa!",
          storyImageUrl:
            "https://res.cloudinary.com/dpgelqvbl/image/upload/v1764528342/hoember_ttwbie.jpg",
          msgs: [
            "Csin√°ltunk egy h√≥embert, ami √∫gy n√©z ki, mint √©n! ‚òÉÔ∏è K√ºld√ºnk r√≥la fot√≥t (gondolatban).",
            "A b√°ln√°k √©s a H√≥-b√°ln√°k is im√°dj√°k a vizet. Ezt a Hidrat√°l√≥ f√°tyolmaszkot neked k√ºld√∂m, hogy hidrat√°lt maradj! üíß",
          ],
          replies: [],
        },
        // 10. HEROLD
        {
          id: 10,
          char: "herold",
          title: "A forr√≥ csoki hadm≈±velet",
          gift: "Meleg√≠t≈ë szemmaszk",
          storyPage1:
            "A nagy h√≥ban j√°t√©k ut√°n mindh√°rman vacogva mentek be a h√°zba. Az orruk piros volt, a kez√ºk j√©ghideg. ‚Äì Forr√≥ csoki id≈ë! ‚Äì jelentette be Hanna hat√°rozottan. Feltett√©k a tejet a t≈±zhelyre. Herold feladata volt a csokol√°d√© t√∂rdel√©se, de valahogy minden harmadik kocka a sz√°j√°ban k√∂t√∂tt ki a l√°bas helyett.",
          storyPage2:
            "‚Äì Herold, ha √≠gy folytatod, csak forr√≥ tej√ºnk lesz csoki n√©lk√ºl! ‚Äì nevetett Hanna. V√©g√ºl elk√©sz√ºlt a g≈ëz√∂lg≈ë ital. Tettek bele tejsz√≠nhabot, √©s annyi pillecukrot, hogy azok kis szigetekk√©nt √∫szk√°ltak a tetej√©n. Buck√≥ b√∂gr√©je akkora volt, mint egy v√°za, de egy hajt√°sra kiitta az eg√©szet.",
          storyImageText:
            "N√©zd Mama, Buck√≥ itt m√°r el is mosta a b√∂gr√©j√©t, olyan gyorsan itta meg:",
          storyImageUrl:
            "https://res.cloudinary.com/dpgelqvbl/image/upload/v1764528578/forrocsoki_actsh9.jpg",
          msgs: [
            "F≈ëzt√ºnk forr√≥ csokit! ‚òï V√©letlen√ºl beleborult a pillecukor zacsk√≥... De legal√°bb felmelegedt√ºnk.",
            "Neked k√ºld√ºnk egy kis extra melegs√©get: egy Meleg√≠t≈ë szemmaszkot. Pihenj le vele 10 percre! ‚òï",
          ],
          replies: [],
        },
        // 11. HANNA
        {
          id: 11,
          char: "hanna",
          title: "Lev√©l a t√°volba",
          gift: "Hidrat√°l√≥ k√©zmaszk",
          storyPage1:
            "M√°r nagyon hi√°nyoztak a sz√ºl≈ëk. Est√©nk√©nt sokat besz√©lgettek r√≥luk. ‚Äì √çrjunk nekik levelet! ‚Äì javasolta Herold. El≈ëvettek egy nagy √≠v pap√≠rt √©s a sz√≠nes ceruz√°kat. Herold lerajzolta a H√≥-b√°ln√°t (b√°r ink√°bb hasonl√≠tott egy nagy feh√©r krumplira, aminek kalapja van). Hanna gy√∂ngybet≈±kkel r√°√≠rta: 'Nagyon j√≥l vagyunk, de a palacsinta a plafonra ragadt (m√°r leszedt√ºk!).'",
          storyPage2:
            "Buck√≥ is akart √≠rni. ‚Äì √ân b√°lnanyelven √ºzenek! ‚Äì mondta. Bem√°rtotta az uszony√°t a k√©k fest√©kbe, √©s egy nagy pac√°t nyomott a pap√≠r k√∂zep√©re. ‚Äì Ez azt jelenti: Szeretlek titeket! ‚Äì ford√≠totta le b√ºszk√©n a t√∂bbieknek.",
          storyImageText: "N√©zd, itt √©pp √≠rjuk a levelet:",
          storyImageUrl:
            "https://res.cloudinary.com/dpgelqvbl/image/upload/v1764528810/rajz_z3ttol.jpg",
          msgs: [
            "√çrtunk levelet! üìù √ân √≠rtam, Herold rajzolt, Buck√≥ meg... h√°t ≈ë nyomott egy k√©k pac√°t.",
            "A sok k√∂rm√∂l√©sben elf√°radt a mancsunk. Neked k√ºld√ºnk egy Hidrat√°l√≥ k√©zmaszkot, hogy pihe-puha legyen a kezed! üß§",
          ],
          replies: [],
        },
        // 12. BUCK√ì
        {
          id: 12,
          char: "bucko",
          title: "A viharos √©jszaka",
          gift: "Puha vastag zokni",
          storyPage1:
            "√âjszaka hatalmas sz√©l t√°madt. Az ablakok z√∂r√∂gtek, az √°gak kopogtattak az √ºvegen, mintha be akarn√°nak j√∂nni. Hirtelen: CSATT! Egy hatalmas d√∂rg√©s r√°zta meg a h√°zat. Buck√≥, aki √°ltal√°ban b√°tor, most ijedt√©ben be akart b√∫jni az √°gy al√°. De sajnos az ut√≥bbi napokban t√∫l sok m√©zeskal√°csot evett, √≠gy a pocakja beszorult.",
          storyPage2:
            "‚Äì Seg√≠ts√©g! A pocakom csapd√°ba esett! ‚Äì kiab√°lta k√©ts√©gbeesetten. Herold √©s Hanna azonnal ugrottak. Egyik√ºk h√∫zta a fark√°t, m√°sikuk tolta az orr√°t. ‚Äì H√∫zd be a leveg≈ët, Buck√≥! ‚Äì vez√©nyelt Hanna. V√©g√ºl egy nagy 'PLOPP' hanggal kiszabadult. Aznap √©jjel mindh√°rman egy nagy kupacban, egym√°st √∂lelve aludtak el a nappali sz≈ënyeg√©n, biztons√°gban.",
          storyImageText: "Ebb≈ël a bujcib√≥l k√°r, hogy kimaradtatok:",
          storyImageUrl:
            "https://res.cloudinary.com/dpgelqvbl/image/upload/v1764529002/bujci_zrcl5e.jpg",
          msgs: [
            "Kicsit f√©ltem az √©gzeng√©st≈ël... üå©Ô∏è De Herold√©k megv√©dtek. Most m√°r b√°tor vagyok.",
            "Ha te is f√°zn√°l, h√∫zd fel ezt a Puha vastag zoknit, √©s b√∫jj be az √°gyba! üß¶",
          ],
          replies: [],
        },
        // 13. HANNA
        {
          id: 13,
          char: "hanna",
          title: "Gubancok √©s g√∂mb√∂k",
          gift: "Hajpakol√°s",
          storyPage1:
            "El√©rkezett az id≈ë a d√≠szek ellen≈ërz√©s√©re. Hanna lehozta a padl√°sr√≥l a dobozokat. ‚Äì Jaj ne! ‚Äì ki√°ltott fel, amint kinyitotta az els≈ët. A kar√°csonyi izz√≥sor egyetlen hatalmas, rem√©nytelen gomb√≥cc√° gabalyodott √∂ssze, mintha egy vil√°g√≠t√≥ spagetti lenne.",
          storyPage2:
            "‚Äì √ân megoldom! ‚Äì aj√°nlkozott Herold, √©s b√°tran belevetette mag√°t a k√°belrengetegbe. T√≠z perc m√∫lva m√°r ≈ë is bele volt tekeredve, mint egy kar√°csonyi herny√≥. Csak a szeme l√°tszott ki. V√©g√ºl Hanna szabad√≠totta ki ≈ët is √©s az √©g≈ësort is. K√∂zben Buck√≥ a g√∂mb√∂ket v√°logatta sz√≠nek szerint: a k√©kek voltak a kedvencei, mert a tengerre eml√©keztett√©k.",
          storyImageText: "N√©zd, ez volt Herold a gubancban! ü§£",
          storyImageUrl:
            "https://res.cloudinary.com/dpgelqvbl/image/upload/v1764529171/diszek_bd5cv8.jpg",
          msgs: [
            "Jaj Mama, az √©g≈ësor megt√°madta Heroldot! üéÑ √ögy n√©zett ki, mint egy vil√°g√≠t√≥ m√∫mia a padl√≥n. De m√°r kiszabad√≠tottam.",
            "Hogy a te hajad ne legyen gubancos, k√ºld√ºnk egy szuper Hajpakol√°st. Csillogni fogsz! üíá‚Äç‚ôÄÔ∏è",
          ],
          replies: [],
        },
        // 14. HEROLD
        {
          id: 14,
          char: "herold",
          title: "A s√≥s s√ºtem√©ny rejt√©lye",
          gift: "Cukros testrad√≠r",
          storyPage1:
            "√öjra s√ºt√©sre adt√°k a fej√ºket. Most m√©zeskal√°csot k√©sz√≠tettek, mert annak olyan j√≥ illata van. Hanna nagyon figyelt a receptre. ‚Äì Liszt, toj√°s, m√©z... √©s cukor! ‚Äì sorolta, √©s bele√∂nt√∂tt egy nagy b√∂gre feh√©r port a t√©szt√°ba. Amikor kis√ºltek a form√°k, Herold azonnal bekapott egyet, m√©g forr√≥n.",
          storyPage2:
            "De a mosolya hirtelen lefagyott az arc√°r√≥l. ‚Äì Pf√∫j! Ez borzalmas! ‚Äì k√∂pte ki a falatot. Hanna megk√≥stolta. ‚Äì Jaj, ez nem cukor volt, hanem s√≥! Kider√ºlt, hogy Hanna √∂sszekeverte a dobozokat! Az eg√©sz adag a kuk√°ban v√©gezte, de legal√°bb j√≥t nevettek a 's√≥s-kal√°cson'. ‚Äì A s√≥s vizet szeretem, de a s√≥s m√©zeskal√°csot m√©g √©n sem! ‚Äì √°llap√≠totta meg Buck√≥.",
          storyImageText: "Itt Hanna √©pp k√≥stolja a s√ºtit:",
          storyImageUrl:
            "https://res.cloudinary.com/dpgelqvbl/image/upload/v1764529367/s%C3%B3s_lsd1e5.jpg",
          msgs: [
            "Soha ne egy√©l Hanna mai s√ºtij√©b≈ël! ü§¢ S√ìS volt! Azt hittem, menten el√°julok.",
            "Megtal√°ltuk a cukrot, ami a s√ºtib≈ël kimaradt! Bocs√°natk√©ppen itt egy Cukros testrad√≠r. Ezzel √©desebb lesz a napod! üç¨",
          ],
          replies: [],
        },
        // 15. HANNA
        {
          id: 15,
          char: "hanna",
          title: "A t√∂k√©letes figur√°k",
          gift: "Gua Sha k≈ë",
          storyPage1:
            "A s√≥s katasztr√≥fa ut√°n √∫jra nekil√°ttak. Most Herold h√°romszor is megk√≥stolta a feh√©r port: Cukor! Mehet bele! Nagyon kreat√≠vak voltak a form√°z√°sn√°l. Hanna csin√°lt egy Mama-figur√°t √©s egy Papa-figur√°t, cukorm√°z-mosollyal √©s kis cukorgy√∂ngy szemekkel.",
          storyPage2:
            "Herold egy puf√≥k vizilovat form√°zott (saj√°t mag√°r√≥l), aminek mazsola volt a k√∂ld√∂ke. Buck√≥ pedig egy b√°ln√°t gy√∫rt, de mivel a t√©szta s√ºt√©s k√∂zben megn≈ëtt, a b√°lna akkora lett, mint egy kisebb keny√©r. ‚Äì Ezt el kell tenn√ºnk nekik! ‚Äì mondt√°k, √©s a legszebbeket egy f√©mdobozba z√°rt√°k, hogy frissek maradjanak a sz√ºl≈ëk √©rkez√©s√©ig.",
          storyImageText: "N√©zd, mivel v√°runk titeket:",
          storyImageUrl:
            "https://res.cloudinary.com/dpgelqvbl/image/upload/v1764529680/s%C3%BCti_x8swrv.jpg",
          msgs: [
            "Na, a m√°sodik adag m√°r siker√ºlt! üç™ Csin√°ltunk egy r√≥lad form√°zott kekszet is.",
            "Mi a t√©szt√°t gy√∫rtuk form√°ra, te pedig k√©nyeztesd az arcodat ezzel a Gua Sha k≈ëvel. Sim√≠tsd ki vele a r√°ncokat! üóø",
          ],
          replies: [],
        },
        // 16. BUCK√ì
        {
          id: 16,
          char: "bucko",
          title: "Mozi a nappaliban",
          gift: "L√°bmaszk",
          storyPage1:
            "Kint s√∂t√©t volt √©s hideg, de bent igazi mozi-hangulat uralkodott. √âp√≠tettek egy hatalmas er≈ëd√∂t p√°rn√°kb√≥l √©s takar√≥kb√≥l a TV el≈ëtt. Ez volt a VIP p√°holy. Kukoric√°t pattogtattak, ami nagyon vicces volt, mert Herold elfelejtette r√°tenni a fed≈ët a l√°basra. A pattogatott kukorica szanasz√©t rep√ºlt a konyh√°ban, mintha √°gy√∫b√≥l l≈ëtt√©k volna! Buck√≥ a leveg≈ëben kapdosta el a szemeket.",
          storyPage2:
            "Betett√©k a 'Reszkessetek, bet√∂r≈ëket!'-et. Herold a has√°t fogta a nevet√©st≈ël, amikor a bet√∂r≈ëk elestek. Hanna viszont a meghat√≥ r√©szekn√©l s√≠rva fakadt. ‚Äì Olyan sz√©p, amikor a v√©g√©n mindenki tal√°lkozik! ‚Äì szipogta, √©s egy pap√≠rzsebkend≈ëvel t√∂r√∂lgette a f√∫j√≥ny√≠l√°s√°t.",
          storyImageText: "N√©zd, √©p√≠tett√ºnk egy VIP p√°rnaer≈ëd√∂t!",
          storyImageUrl:
            "https://res.cloudinary.com/dpgelqvbl/image/upload/v1764529887/mozi_sibul7.jpg",
          msgs: [
            "N√©zt√ºnk filmet a p√°rnaer≈ëdb≈ël! üé¨ S√≠rtam a v√©g√©n, de csak mert olyan sz√©p volt.",
            "Ind√≠tsd el te is a kedvenc filmedet! Pont addig tart, am√≠g ez a L√°bmaszk pihenteti a l√°badat. J√≥ moziz√°st! ü¶∂",
          ],
          replies: [],
        },
        // 17. HEROLD
        {
          id: 17,
          char: "herold",
          title: "A ferde feny≈ëfa",
          gift: "Z√∂ld agyagos maszk",
          storyPage1:
            "Reggel csengettek. Meg√©rkezett a feny≈ëfa! ‚Äì H≈±, de magas! ‚Äì √°mult el Hanna, alig l√°tta a tetej√©t. Nagy nehezen bevonszolt√°k a nappaliba. Herold tartotta a t√∂rzset, Hanna csavarta a talpat. ‚Äì M√©g egy kicsit balra... most jobbra... most d≈ël! VIGY√ÅZZ!",
          storyPage2:
            "A fa elindult, √©s puff! Egyenesen a fotelre d≈ëlt, maga al√° temetve egy d√≠szp√°rn√°t. Fel√°ll√≠tott√°k √∫jra. Kicsit ferde volt, kicsit kopasz volt az egyik oldala, √©s kicsit gyant√°s lett t≈ële a sz≈ënyeg. ‚Äì Szerintem t√∂k√©letes ‚Äì mondta Buck√≥, √©s szeretettel n√©zett a f√°ra. ‚Äì Olyan, mint mi. Kicsit szeleburdi, de a mienk!",
          storyImageText: "musz√°j volt k√©sz√≠teni egy k√©pet a katasztr√≥f√°r√≥l:",
          storyImageUrl:
            "https://res.cloudinary.com/dpgelqvbl/image/upload/v1764530145/karifa_rlv5ax.jpg",
          msgs: [
            "Megj√∂tt a fa! üå≤ Kicsit d√ºl√∂ng√©l, mint √©n korcsoly√°z√°s k√∂zben, √©s r√°borult a fotelre, de szerintem nagyon sz√©p.",
            "A f√°nk z√∂ld √©s illatos, ez a Z√∂ld agyagos maszkis pont ilyen! Kend fel, √©s t√∂lt≈ëdj fel! üåø",
          ],
          replies: [],
        },
        // 18. HANNA
        {
          id: 18,
          char: "hanna",
          title: "Csillagsz√≥r√≥ √©s girland",
          gift: "Ajakolaj",
          storyPage1:
            "A mai nap a fa d√≠sz√≠t√©s√©r≈ël sz√≥lt. Felker√ºltek a tegnap megmentett g√∂mb√∂k. Hanna gy√∂ny√∂r≈± masnikat k√∂t√∂tt az √°gakra. Herold a szaloncukrokat aggatta fel, de valami rejt√©lyes okn√°l fogva a szaloncukrok fele √ºres volt, mire a f√°ra ker√ºlt. Csak az √ºres, csillog√≥ pap√≠rok l√≥gtak.",
          storyPage2:
            "‚Äì Herold, mi√©rt van csoki a sz√°dban? ‚Äì k√©rdezte gyanakv√≥an Hanna. ‚Äì Csak ellen≈ëriztem a min≈ës√©get! Nem tehet√ºnk fel romlott csokit! ‚Äì v√©dekezett teli sz√°jjal Herold. A cs√∫csd√≠sz felrak√°sa volt a legnehezebb. Herold felm√°szott egy sz√©kre, Buck√≥ megtolta az orr√°val a fenek√©t, Hanna pedig navig√°lt. Siker√ºlt! A csillag ferd√©n, de b√ºszk√©n ragyogott a fa tetej√©n.",
          storyImageText: "N√©zd, a cs√∫csd√≠sz a hely√©n!",
          storyImageUrl:
            "https://res.cloudinary.com/dpgelqvbl/image/upload/v1764530574/diszitett_fhytzl.jpg",
          msgs: [
            "K√©sz a fa! ‚ú® Herold megevett 3 szaloncukrot, pedig mondtam neki, hogy az d√≠sz.",
            "A kar√°csonyfa m√°r csillog-villog, most a mosolyodon a sor! Ez az Ajakolaj √∫gy ragyog majd a sz√°don, mint a legszebb d√≠sz. üíÑ",
          ],
          replies: [],
        },
        // 19. HEROLD
        {
          id: 19,
          char: "herold",
          title: "A v√°ratlan vend√©g",
          gift: "Fekete maszk",
          storyPage1:
            "Mik√∂zben te√°ztak, furcsa kapar√°sz√°st hallottak a k√©m√©ny fel≈ël. ‚Äì J√∂n a J√©zuska? ‚Äì suttogta Herold t√°gra ny√≠lt szemekkel. De nem a J√©zuska volt, hanem egy kormos, kicsi ver√©b, aki v√©letlen√ºl beesett a kandall√≥ba!",
          storyPage2:
            "Szeg√©ny mad√°rka ijedten repkedett k√∂rbe-k√∂rbe, kormot sz√≥rva a frissen felmosott padl√≥ra √©s a feh√©r f√ºgg√∂nyre. Hanna gyorsan kinyitotta az ablakot. Buck√≥ kedvesen, halkan csipogott neki (b√°lnanyelven), hogy megnyugtassa. V√©g√ºl a kismad√°r kital√°lt a szabadba. ‚Äì Nevezz√ºk el Kormosnak! ‚Äì mondta Herold. ‚Äì Rem√©lem, visszaj√∂n kar√°csonyra, de legk√∂zelebb ink√°bb az ajt√≥n kereszt√ºl.",
          storyImageText: "N√©zd, Kormos m√°r elrep√ºlt!",
          storyImageUrl:
            "https://res.cloudinary.com/dpgelqvbl/image/upload/v1764530708/rigo_urusg3.jpg",
          msgs: [
            "Volt egy vend√©g√ºnk! Egy kismad√°r beesett a k√©m√©nybe. üê¶ Kicsit kormos lett a sz≈ënyeg.",
            "A mad√°rk√°r√≥l jutott esz√ºnkbe ez a Fekete maszk. Ne ijedj meg a sz√≠n√©t≈ël, te szebb leszel t≈ële! üñ§",
          ],
          replies: [],
        },
        // 20. HANNA
        {
          id: 20,
          char: "hanna",
          title: "Titkos m≈±hely",
          gift: "K√∂z√∂s fot√≥",
          storyPage1:
            "A sz√ºl≈ëknek is kell aj√°nd√©k! De mib≈ël? Zsebp√©nz√ºk m√°r nem maradt, √≠gy a saj√°t tehets√©g√ºket haszn√°lt√°k. Herold, aki im√°dott festeni, k√©sz√≠tett egy portr√©t a csal√°dr√≥l. Igaz, Pap√°nak z√∂ld lett a feje, mert elfogyott a b≈ërsz√≠n≈± fest√©k, de a szeretet volt a l√©nyeg.",
          storyPage2:
            "Hanna egy gy√∂ny√∂r≈± nyakl√°ncot f≈±z√∂tt Mam√°nak sz√°razt√©szt√°b√≥l, amit aranyra festett csill√°mporral. Buck√≥ pedig √≠rt egy dalt. ‚Äì Ezt majd el√©neklem nekik, amikor bel√©pnek! ‚Äì mondta. A dal c√≠me ez volt: 'A legszebb √≥ce√°n a csal√°dom szeretete'. Herold kicsit megk√∂nnyezte a pr√≥b√°t.",
          storyImageText: "N√©zd, egy kis k√©p a titkos m≈±helyb≈ël:",
          storyImageUrl:
            "https://res.cloudinary.com/dpgelqvbl/image/upload/v1764530900/ajandekok_w4kdka.jpg",
          msgs: [
            "Eg√©sz nap alkottunk, Mama! Nagyon kreat√≠vak voltunk, ez egy nagyon j√≥ nap volt.",
            "Mi festett√ºnk, de Apa seg√≠tett kinyomtatni a legszebb eml√©ket: egy K√∂z√∂s fot√≥t r√≥lunk! Tedd ki az asztalra! ‚ù§Ô∏è",
          ],
          replies: [],
        },
        // 21. HEROLD
        {
          id: 21,
          char: "herold",
          title: "A nagy sz√°nk√≥-futam",
          gift: "Ajak√°pol√≥",
          storyPage1:
            "A domboldalon vastag h√≥ √°llt, a nap h√©t √°gra s√ºt√∂tt. ‚Äì Versenyezz√ºnk! ‚Äì ki√°ltotta Herold. De csak egy nagy sz√°nk√≥juk volt. √çgy h√°t fel√ºltek r√° mindh√°rman: el√∂l a kis b√°lna (≈ë volt az √°ramvonalas orr), k√∂z√©pen Hanna, h√°tul Herold, a s√∫ly. ‚Äì 3, 2, 1, RAJT!",
          storyPage2:
            "A sz√°nk√≥ sz√°guldott lefel√©, gyorsabban, mint egy rak√©ta. ‚Äì F√âKEZZ! F√âKEZZ! ‚Äì vis√≠totta Hanna. ‚Äì NEM TUDOK! ‚Äì ord√≠totta Herold. Belecsap√≥dtak egy hatalmas h√≥buck√°ba a domb alj√°n. H√≥ bor√≠totta be ≈ëket tet≈ët≈ël talpig. Amikor ki√°st√°k magukat, √∫gy n√©ztek ki, mint h√°rom dundi h√≥ember. Soha ilyen j√≥t nem nevettek m√©g!",
          storyImageText: "N√©zd, √≠gy lett bel≈ëlem h√≥ember! ü§£",
          storyImageUrl:
            "https://res.cloudinary.com/dpgelqvbl/image/upload/v1764531064/szanko_yn3qrl.jpg",
          msgs: [
            "SZ√ÅNK√ìZTUNK! üõ∑ Akkor√°t est√ºnk, hogy h√≥ember lett bel≈ëlem.",
            "H√∫, de s√ºv√≠t a sz√©l kint! Itt egy Ajak√°pol√≥, kend be a sz√°d, nehogy kicserepesedjen a nagy nevet√©sben! üíã",
          ],
          replies: [],
        },
        // 22. HANNA
        {
          id: 22,
          char: "hanna",
          title: "Az utols√≥ sim√≠t√°sok",
          gift: "Sz√©p√≠t≈ë ampulla",
          storyPage1:
            "M√°r csak kett≈ët kell aludni! A fesz√ºlts√©g szinte tapinthat√≥ volt a h√°zban. Ma mindent √∫jra ellen≈ëriztek, mintha egy fontos vizsg√°ra k√©sz√ºln√©nek. Tiszta a lak√°s? Igen (a kormos foltokat elt√ºntett√©k). Megvannak a s√ºtik? Igen (a doboz biztons√°gban a polc tetej√©n, ahol Herold nem √©ri el). Megvannak az aj√°nd√©kok? Igen, sz√©pen becsomagolva a fa alatt.",
          storyPage2:
            "Herold m√©g a fog√°t is h√°romszor mosta meg este, √©s a legszebb, cs√≠kos pizsam√°j√°t k√©sz√≠tette ki. ‚Äì √ögy izgulok, hogy remeg a pocakom! ‚Äì mondta az √°gyban. ‚Äì Az eny√©m is! ‚Äì tette hozz√° Buck√≥. ‚Äì Pedig nekem vastag zs√≠rr√©tegem van! N√©zt√©k a villog√≥ f√©nyeket, √©s lassan, nagyon lassan elnyomta ≈ëket az √°lom.",
          storyImageText: "N√©zd, m√°r nagyon v√°rjuk a kar√°csonyt!",
          storyImageUrl:
            "https://res.cloudinary.com/dpgelqvbl/image/upload/v1764531298/v%C3%A1rakoz%C3%A1s_b1kbvv.jpg",
          msgs: [
            "M√°r csak kett≈ët kell aludni?? üò± Annyira izgulok, hogy remeg a pocakom.",
            "Herold fogat mosott, mi takar√≠tottunk. Itt egy Sz√©p√≠t≈ë ampulla, hogy holnap te legy√©l a legszebb az √ºnnepen! ‚ú®",
          ],
          replies: [],
        },
        // 23. BUCK√ì
        {
          id: 23,
          char: "bucko",
          title: "Szenteste el≈ëtti √©jjel",
          gift: "Csillagsz√≥r√≥",
          storyPage1:
            "Minden k√©sz volt. A fa f√©nyei √©gtek, a h√°zban fah√©j, feny≈ë √©s szeretet illata terjengett. Nem tudtak elaludni a h√°l√≥szob√°ban. T√∫l nagy volt a csend. ‚Äì Menj√ºnk le! ‚Äì javasolta Hanna. Levitt√©k a h√°l√≥zs√°kokat a nappaliba, √©s mindh√°rman a kar√°csonyfa al√° fek√ºdtek.",
          storyPage2:
            "‚Äì Szerintetek sokat n≈ëttek a sz√ºl≈ëk, am√≠g nem l√°ttuk ≈ëket? ‚Äì k√©rdezte Herold √°lmosan. ‚Äì A feln≈ëttek m√°r nem n≈ënek ‚Äì suttogta Hanna, √©s megsimogatta a fej√©t. ‚Äì De a szeretet√ºk biztosan n≈ëtt, mert annyira hi√°nyzunk nekik. ‚Äì Holnap ilyenkor m√°r itt lesznek... ‚Äì s√≥hajtott boldogan Buck√≥. N√©zt√©k a villog√≥ f√©nyeket, √©s lassan, nagyon lassan elnyomta ≈ëket az √°lom.",
          storyImageText: "N√©zd, a fa alatt alszunk!",
          storyImageUrl:
            "https://res.cloudinary.com/dpgelqvbl/image/upload/v1764531428/karifav%C3%A1rakoz%C3%A1s_y7ayit.jpg",
          msgs: [
            "Ma a fa alatt alszunk! ‚õ∫Ô∏è √çgy biztosan √©szrevessz√ºk, ha megj√∂tt√∂k.",
            "Ma este gy√∫jtsd meg ezt a Csillagsz√≥r√≥t, √©s gondolj r√°nk! M√°r alig v√°rjuk a holnapot... ‚≠ê",
          ],
          replies: [],
        },
        // 24. HEROLD
        {
          id: 24,
          char: "herold",
          title: "A CSODA",
          gift: "F≈ë Aj√°nd√©k",
          storyPage1:
            "Reggel cs√∂rg√∂tt a kulcs a z√°rban. A h√°rom j√≥bar√°t egyszerre pattant fel, mintha rug√≥ lett volna alattuk. Az ajt√≥ kiny√≠lt, √©s ott √°lltak! Papa √©s Mama, kipirulva a hidegt≈ël, teli karral csomagokkal. ‚Äì MEGJ√ñTTEK! ‚Äì ord√≠totta Herold, √©s akkor√°t ugrott √∂r√∂m√©ben, hogy majdnem fell√∂kte a fogast.",
          storyPage2:
            "A sz√ºl≈ëk ledobt√°k a t√°sk√°kat, √©s a f√∂ldre t√©rdeltek. Herold, Hanna √©s Buck√≥ egyszerre vetett√©k magukat a nyakukba. Volt ott s√≠r√°s, nevet√©s, √∂lel√©s √©s puszihegyek. ‚Äì Ti voltatok a leg√ºgyesebb h√°z≈ërz≈ëk a vil√°gon! ‚Äì mondta Mama, √©s megpuszilta Buck√≥ orr√°t. Ez volt a legszebb kar√°csony, mert a legnagyobb aj√°nd√©k nem a fa alatt volt, hanem az √∂lel√©s√ºkben: a csal√°d √∫jra egy√ºtt volt.",
          storyImageText: "N√©zd, mekkor√°t ugrunk √∂r√∂m√ºnkben! ü§£",
          storyImageUrl:
            "https://res.cloudinary.com/dpgelqvbl/image/upload/v1764532831/pap%C3%A1%C3%A9k_ilnm8l.jpg",
          msgs: [
            "ITTHON VAGYTOK!!! Ez a legjobb kar√°csony a vil√°gon! Gyertek, √∂lelj√ºk meg egym√°st! ‚ù§Ô∏èüéÑ",
            "√âs most... nyisd ki a F≈ë Aj√°nd√©kot! Ezt neked ≈ërizt√ºk! Boldog Kar√°csonyt! üéÅ",
          ],
          replies: [],
        },
      ];

      // --- √ÅLLAPOTOK ---
      let state = {
        apiKey: localStorage.getItem("geminiKey") || "",
        unlockedDays: JSON.parse(localStorage.getItem("openedDays") || "[]"),
        chatHistory: JSON.parse(localStorage.getItem("chatHistory3") || "{}"),
        currentDayId: null,
        view: "grid", // grid, collection, gallery, story, chatList, chatDetail
        typing: false,
        testMode: false,
        notifAfterCloseDayId: null,
        storyPage: 1,
      };

      // --- FUNKCI√ìK ---

      function renderCollection() {
        // 1. √ñsszeszedj√ºk a kinyitott napok adatait
        const unlockedData = STORY_DATA.filter((day) =>
          state.unlockedDays.includes(day.id)
        );

        // 2. Ha nincs semmi, mutassuk a placeholdert
        if (unlockedData.length === 0) {
          ELEMENTS.collectionPlaceholder.style.display = "flex";
          ELEMENTS.collectionContent.style.display = "none";
          return;
        }

        // 3. Ha van, elrejtj√ºk a placeholdert √©s gener√°lunk
        ELEMENTS.collectionPlaceholder.style.display = "none";
        ELEMENTS.collectionContent.style.display = "grid";
        ELEMENTS.collectionContent.innerHTML = ""; // T√∂rl√©s √∫jragener√°l√°s el≈ëtt

        // Ford√≠tott sorrend, hogy a leg√∫jabb legyen el√∂l (opcion√°lis)
        [...unlockedData].reverse().forEach((day, index) => {
          const card = document.createElement("div");
          card.className = "collection-card";
          // Anim√°ci√≥ k√©sleltet√©s, hogy sz√©pen sorban j√∂jjenek be
          card.style.animationDelay = `${index * 0.05}s`;

          card.innerHTML = `
            <div class="gift-icon">üéÅ</div>
            <div class="gift-name">${day.gift}</div>
            <div class="gift-day">${day.id}. Nap</div>
          `;
          ELEMENTS.collectionContent.appendChild(card);
        });
      }

      function renderGallery() {
        // 1. √ñsszeszedj√ºk a kinyitott napokat
        const unlockedData = STORY_DATA.filter((day) =>
          state.unlockedDays.includes(day.id)
        );

        // 2. Placeholder kezel√©s
        if (unlockedData.length === 0) {
          ELEMENTS.galleryPlaceholder.style.display = "flex";
          ELEMENTS.galleryContent.style.display = "none";
          return;
        }

        ELEMENTS.galleryPlaceholder.style.display = "none";
        ELEMENTS.galleryContent.style.display = "grid";
        ELEMENTS.galleryContent.innerHTML = "";

        [...unlockedData].reverse().forEach((day, index) => {
          const item = document.createElement("div");
          item.className = "gallery-item";
          item.style.animationDelay = `${index * 0.05}s`;

          // Ha r√°kattint, megnyitjuk a nagy sztori k√©pet (opcion√°lis extra)
          item.onclick = () => {
            // Itt ak√°r megnyithatn√°d a sztorit √∫jra:
            // handleDayClick(day);
            // Vagy csak egy effekt:
            playSound("pop");
          };

          item.innerHTML = `
            <img src="${day.storyImageUrl}" loading="lazy" alt="Nap ${day.id}" />
          `;
          ELEMENTS.galleryContent.appendChild(item);
        });
      }

      function saveState(key, value) {
        if (key === "unlockedDays") {
          localStorage.setItem("openedDays", JSON.stringify(value));
          state.unlockedDays = value;
        } else if (key === "chatHistory") {
          localStorage.setItem("chatHistory3", JSON.stringify(value));
          state.chatHistory = value;
        } else if (key === "apiKey") {
          localStorage.setItem("geminiKey", value);
          state.apiKey = value;
        }
        renderApp();
      }

      function addNotification(name, msg, icon) {
        playSound("ding");
        const notifEl = document.createElement("div");
        notifEl.className = "ios-notification";
        notifEl.innerHTML = `
                <div class="notif-icon">${icon}</div>
                <div class="notif-content">
                    <div class="notif-header"><span class="notif-title">${name}</span><span class="notif-time">Most</span></div>
                    <div class="notif-msg">${msg}</div>
                </div>
            `;

        notifEl.onclick = () => {
          setView("chatList");
          notifEl.remove();
        };

        ELEMENTS.notificationContainer.appendChild(notifEl);
        setTimeout(() => notifEl.remove(), 5000);
      }

      function setView(newView, dayId = null) {
        // NOTIFIK√ÅCI√ìK LOGIK√ÅJA
        if (
          state.view === "story" &&
          newView === "grid" &&
          state.notifAfterCloseDayId !== null
        ) {
          const day = STORY_DATA.find(
            (d) => d.id === state.notifAfterCloseDayId
          );
          if (day) {
            const char = CHARACTERS[day.char];

            // 1. Reakci√≥
            setTimeout(() => {
              addNotification(char.name, day.msgs[0], char.icon);
            }, 400);

            // 2. K√©p √©rtes√≠t√©s
            const imageNotifText = `${char.name} k√©pet k√ºld√∂tt!`;
            setTimeout(() => {
              addNotification(char.name, imageNotifText, char.icon);
            }, 2500);

            // 3. Aj√°nd√©k
            setTimeout(() => {
              addNotification(char.name, day.msgs[day.msgs.length - 1], "üéÅ");
            }, 4500);
          }
          state.notifAfterCloseDayId = null;
        }

        state.view = newView;
        if (dayId !== null) state.currentDayId = dayId;
        if (newView === "story") state.storyPage = 1;

        // Chat k√©perny≈ëk anim√°ci√≥s kezel√©se
        /* A renderApp majd kezeli ezt a r√©szt */
        renderApp();
      }

      function updateStoryModalPages() {
        playSound("paper");
        const day = STORY_DATA.find((d) => d.id === state.currentDayId);
        if (!day) return;

        // --- JAV√çT√ÅS KEZDETE ---
        // Ha nincs k√ºl√∂n storyPage1, haszn√°ljuk a message-t
        const text1 = day.storyPage1 || day.message || "";
        const text2 = day.storyPage2 || ""; // Ha nincs 2. oldal, √ºres marad

        ELEMENTS.storyPage1.innerHTML = text1
          .split("\n")
          .map((p) => `<p>${p}</p>`)
          .join("");

        ELEMENTS.storyPage2.innerHTML = text2
          .split("\n")
          .map((p) => `<p>${p}</p>`)
          .join("");
        // --- JAV√çT√ÅS V√âGE ---

        ELEMENTS.storyPage1.style.display =
          state.storyPage === 1 ? "block" : "none";
        ELEMENTS.storyPage2.style.display =
          state.storyPage === 2 ? "block" : "none";

        // Gombok letilt√°sa, ha nincs 2. oldal
        ELEMENTS.storyPrevBtn.disabled = state.storyPage === 1;

        // Csak akkor engedj√ºk a tov√°bbl√©p√©st, ha van sz√∂veg a 2. oldalon
        const hasPage2 = text2.trim().length > 0;
        ELEMENTS.storyNextBtn.disabled = !hasPage2 || state.storyPage === 2;

        ELEMENTS.storyPrevBtn.style.opacity =
          state.storyPage === 1 ? "0.5" : "1";
        ELEMENTS.storyNextBtn.style.opacity =
          !hasPage2 || state.storyPage === 2 ? "0.5" : "1";

        ELEMENTS.storyDot1.classList.toggle("active", state.storyPage === 1);
        ELEMENTS.storyDot2.classList.toggle("active", state.storyPage === 2);
      }

      // --- GEMINI API ---
      // --- GEMINI API LOGIKA ---
      // --- AI SERVICE (GEMINI 2.0 FLASH) - BIZTONS√ÅGOS KULCSKEZEL√âS ---
      async function callGemini(apiKey, userMessage, characterKey, context) {
        const char = CHARACTERS[characterKey];
        const systemPrompt = `You are ${char.name}, a ${char.desc}. You are texting your owner 'Mama'. Style: ${char.style}.  Context: ${context} Reply to: "${userMessage}". Keep it short (max 2 sentences), cute, funny. End with a goodbye reason. Language: Hungarian.`;

        const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`;
        const payload = {
          contents: [{ parts: [{ text: systemPrompt }] }],
          generationConfig: { temperature: 0.7 },
        };

        try {
          const response = await fetch(url, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          });
          const data = await response.json();
          if (!response.ok) throw new Error(data.error?.message || "API Error");
          return data.candidates[0].content.parts[0].text;
        } catch (e) {
          console.error(e);
          return "Most tele a sz√°m bejglivel, de egyet√©rtek! ü•Ø (Offline m√≥d)";
        }
      }
      function handleDayClick(day) {
        playSound("pop");
        const today = state.testMode ? 31 : new Date().getDate();
        const isAvailable = day.id <= today;

        if (isAvailable) {
          if (!state.unlockedDays.includes(day.id)) {
            const newUnlocked = [...state.unlockedDays, day.id];
            saveState("unlockedDays", newUnlocked);

            const initialMsgs = [];
            initialMsgs.push({ text: day.msgs[0], isMe: false });
            initialMsgs.push({
              text: day.storyImageText,
              isMe: false,
              isImageText: true,
            });
            initialMsgs.push({
              text: `<img src="${day.storyImageUrl}" alt="K√©p">`,
              isMe: false,
              isImage: true,
            });
            initialMsgs.push({ text: day.msgs[1], isMe: false });

            const newHist = {
              ...state.chatHistory,
              [day.id]: { msgs: initialMsgs, seen: false },
            };
            saveState("chatHistory", newHist);
            state.notifAfterCloseDayId = day.id;
          }

          ELEMENTS.storyTitle.textContent = "üìú " + day.title;
          setView("story", day.id);
        } else {
          // --- DORG√ÅL√ì LOGIKA ---
          const charKeys = Object.keys(SCOLDING_MESSAGES);
          const randomCharKey =
            charKeys[Math.floor(Math.random() * charKeys.length)];
          const messages = SCOLDING_MESSAGES[randomCharKey];
          const randomMsg =
            messages[Math.floor(Math.random() * messages.length)];
          const character = CHARACTERS[randomCharKey];

          addNotification(character.name, randomMsg, character.icon);
        }
      }

      // --- √úZENETK√úLD√âS KEZEL√âSE ---
      async function sendMessage(text) {
        const trimmedText = text.trim();

        // Ha √ºres a sz√∂veg, vagy √©pp √≠r az AI, vagy nincs kiv√°lasztva nap, nem csin√°lunk semmit
        if (!trimmedText || state.typing || !state.currentDayId) return;

        playSound("pop"); // Hang lej√°tsz√°sa

        // 1. Adatok el≈ëk√©sz√≠t√©se
        const dayId = state.currentDayId;
        const day = STORY_DATA.find((d) => d.id === dayId);
        if (!day) return;

        let currentHist = state.chatHistory[dayId] || { msgs: [] };

        // 2. A felhaszn√°l√≥ √ºzenet√©nek azonnali megjelen√≠t√©se
        const userMessage = { text: trimmedText, isMe: true };
        const msgsAfterUser = [...currentHist.msgs, userMessage];

        // Ment√©s √©s renderel√©s (hogy l√°sd, amit √≠rt√°l)
        saveState("chatHistory", {
          ...state.chatHistory,
          [dayId]: { ...currentHist, msgs: msgsAfterUser, seen: true },
        });

        // Input mez≈ë t√∂rl√©se
        ELEMENTS.chatInput.value = "";
        ELEMENTS.chatSendCircle.classList.add("disabled");

        // 3. "√çr..." √°llapot bekapcsol√°sa
        state.typing = true;
        renderChatDetail(); // Ez kirajzolja a h√°rom p√∂tty√∂t (typing bubble)

        // 4. K√©sleltet√©s (hogy term√©szetesebbnek t≈±nj√∂n) + API h√≠v√°s
        // √ñssze√°ll√≠tjuk a kontextust az AI-nak (mese eleje + aj√°nd√©k)
        const contextInfo = `Mese r√©szlet: ${day.storyPage1.substring(
          0,
          100
        )}... Mama ezt aj√°nd√©kot kapta ma: ${day.gift}`;

        const responseText = await callGemini(
          state.apiKey, // <--- Ezt hagytad ki!
          trimmedText,
          day.char,
          contextInfo
        );

        // 5. V√°lasz meg√©rkezett
        state.typing = false;
        playSound("ding"); // √ârtes√≠t≈ë hang

        // 6. AI v√°lasz hozz√°ad√°sa a list√°hoz
        const finalMsgs = [
          ...msgsAfterUser,
          { text: responseText, isMe: false },
        ];

        // V√©gs≈ë ment√©s √©s renderel√©s
        saveState("chatHistory", {
          ...state.chatHistory,
          [dayId]: { msgs: finalMsgs, seen: true },
        });
      }

      // --- RENDEREREK ---
      function createSnowflake() {
        const snowflakeEl = document.createElement("div");
        snowflakeEl.className = "snowflake";
        snowflakeEl.style.left = Math.random() * 100 + "%";
        snowflakeEl.style.animationDuration = Math.random() * 5 + 3 + "s";
        snowflakeEl.style.width = Math.random() * 4 + 2 + "px";
        snowflakeEl.style.height = Math.random() * 4 + 2 + "px";
        document.querySelector(".app-screen").appendChild(snowflakeEl);
        setTimeout(() => snowflakeEl.remove(), (Math.random() * 5 + 8) * 1000);
      }

      function updateCountdown() {
        const now = new Date();
        const xmas = new Date(now.getFullYear(), 11, 24);
        const diff = Math.ceil((xmas - now) / (1000 * 60 * 60 * 24));
        ELEMENTS.countdown.textContent =
          diff > 0 ? `M√©g ${diff} nap kar√°csonyig!` : "Boldog Kar√°csonyt!";
      }

      function renderGrid() {
        ELEMENTS.gridContainer.innerHTML = "";
        const today = state.testMode ? 31 : new Date().getDate();

        STORY_DATA.forEach((day) => {
          const isOpen = state.unlockedDays.includes(day.id);
          const isLocked = day.id > today && !isOpen && !state.testMode;

          const cardEl = document.createElement("div");
          cardEl.className = `day-card ${isOpen ? "opened" : ""} ${
            isLocked ? "locked" : ""
          } clickable`;
          cardEl.onclick = () => handleDayClick(day);

          cardEl.innerHTML = isOpen
            ? `<div class="status-icon">‚úÖ</div>`
            : `<div class="day-num">${day.id}</div>`;

          if (isLocked)
            cardEl.innerHTML += `<div style="position:absolute; bottom:20px; font-size:20px;">üîí</div>`;

          ELEMENTS.gridContainer.appendChild(cardEl);
        });

        // G√ñRGET√âS
        setTimeout(() => {
          let targetId = Math.min(today, 24);
          if (targetId < 1) targetId = 1;
          const cardIndex = targetId - 1;
          const cards = ELEMENTS.gridContainer.children;
          if (cards[cardIndex]) {
            cards[cardIndex].scrollIntoView({
              behavior: "smooth",
              inline: "center",
              block: "center",
            });
          }
        }, 300);
      }

      function renderChatList() {
        ELEMENTS.chatListBody.innerHTML = "";
        let totalUnread = 0;

        CHAT_CONTACTS.forEach((contact) => {
          const charDays = STORY_DATA.filter(
            (d) => d.char === contact.key && state.unlockedDays.includes(d.id)
          ).sort((a, b) => b.id - a.id);
          if (charDays.length === 0) return;

          let isUnread = false;
          let lastMsg = "Nincs √ºzenet";
          let latestDayId = charDays[0].id;

          const latestHist = state.chatHistory[latestDayId] || { msgs: [] };

          for (const day of charDays) {
            const hist = state.chatHistory[day.id] || { msgs: [] };
            if (!hist.seen) {
              isUnread = true;
              totalUnread++;
            }
          }

          if (latestHist.msgs.length > 0) {
            const last = latestHist.msgs[latestHist.msgs.length - 1];
            lastMsg = (last.isMe ? "√ân: " : "") + last.text;
          } else if (charDays[0].msgs.length > 0) {
            lastMsg = charDays[0].msgs[0];
          }

          const listItem = document.createElement("div");
          listItem.onclick = () => {
            playSound("pop");
            setView("chatDetail", latestDayId);
          };
          listItem.style.cssText =
            "display:flex; gap:15px; padding:15px; border-bottom:1px solid #222; cursor:pointer;";
          listItem.classList.add("clickable");

          listItem.innerHTML = `
                    <div style="font-size:30px;">${contact.icon}</div>
                    <div style="flex:1;">
                        <div style="display:flex; justify-content:space-between;"><span style="font-weight:bold; color:white;">${
                          contact.name
                        }</span><span style="color:#666; font-size:14px;">Ma</span></div>
                        <div style="color:${
                          isUnread ? "white" : "#888"
                        }; font-size:15px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; width:250px; font-weight:${
            isUnread ? "bold" : "normal"
          };">${lastMsg}</div>
                    </div>
                    ${
                      isUnread
                        ? '<div style="width:10px; height:10px; border-radius:50%; background:#007AFF; align-self:center;"></div>'
                        : ""
                    }
                `;
          ELEMENTS.chatListBody.appendChild(listItem);
        });

        ELEMENTS.unreadBadge.textContent = totalUnread;
        ELEMENTS.unreadBadge.style.display = totalUnread > 0 ? "flex" : "none";
      }

      function renderChatDetail() {
        const dayId = state.currentDayId;
        if (!dayId) return;
        const selectedDay = STORY_DATA.find((d) => d.id === dayId);
        const char = CHARACTERS[selectedDay.char];
        const allCharDays = STORY_DATA.filter(
          (d) =>
            d.char === selectedDay.char && state.unlockedDays.includes(d.id)
        ).sort((a, b) => a.id - b.id);

        let allMessages = [];
        let shouldMarkAsSeen = false;

        for (const day of allCharDays) {
          const hist = state.chatHistory[day.id] || { msgs: [] };
          allMessages.push({ text: `iMessage ‚Ä¢ ${day.title}`, isSystem: true });
          allMessages = allMessages.concat(hist.msgs);
          if (!hist.seen) {
            shouldMarkAsSeen = true;
            state.chatHistory[day.id] = { ...hist, seen: true };
          }
        }

        ELEMENTS.chatDetailIcon.textContent = char.icon;
        ELEMENTS.chatDetailName.textContent = char.name;
        ELEMENTS.chatDetailBody.innerHTML = "";

        allMessages.forEach((msg) => {
          if (msg.isSystem) {
            ELEMENTS.chatDetailBody.innerHTML += `<div style="text-align:center; color:#666; font-size:11px; margin:10px 0;">${msg.text}</div>`;
            return;
          }
          const msgRow = document.createElement("div");
          msgRow.className = `message-row ${msg.isMe ? "me" : "them"}`;
          const avatarHtml = !msg.isMe
            ? `<div class="avatar-small">${char.icon}</div>`
            : "";
          let bubbleClass = "bubble";
          if (msg.isImage) bubbleClass += " image-bubble";
          const contentHtml = msg.isImage ? msg.text : msg.text;
          const bubbleHtml = `<div class="bubble ${msg.isMe ? "me" : "them"} ${
            msg.isImage ? "image-bubble" : ""
          }">${contentHtml}</div>`;
          msgRow.innerHTML = msg.isMe ? bubbleHtml : avatarHtml + bubbleHtml;
          ELEMENTS.chatDetailBody.appendChild(msgRow);
        });

        // Typing
        const typingEl = ELEMENTS.chatDetailBody.querySelector(
          ".typing-indicator-row"
        );
        if (state.typing && !typingEl) {
          const typingRow = document.createElement("div");
          typingRow.className = "message-row them typing-indicator-row";
          typingRow.innerHTML = `<div class="avatar-small">${char.icon}</div><div class="typing-bubble"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>`;
          ELEMENTS.chatDetailBody.appendChild(typingRow);
        } else if (!state.typing && typingEl) {
          typingEl.remove();
        }

        ELEMENTS.chatDetailBody.scrollTop =
          ELEMENTS.chatDetailBody.scrollHeight;

        // Reply Chips
        const latestHist = state.chatHistory[selectedDay.id] || { msgs: [] };
        if (
          !latestHist.msgs.some((m) => m.isMe) &&
          selectedDay.replies.length > 0
        ) {
          ELEMENTS.replyChips.style.display = "flex";
          ELEMENTS.replyChips.innerHTML = "";
          selectedDay.replies.forEach((reply) => {
            const chip = document.createElement("div");
            chip.className = "chip clickable";
            chip.textContent = reply.u;
            chip.onclick = () => sendMessage(reply.u);
            ELEMENTS.replyChips.appendChild(chip);
          });
        } else {
          ELEMENTS.replyChips.style.display = "none";
        }

        if (shouldMarkAsSeen) saveState("chatHistory", state.chatHistory);
      }

      function renderApp() {
        ELEMENTS.apiModal.style.display = state.apiKey ? "none" : "flex";
        if (!state.apiKey) return;

        // --- N√âZETEK KEZEL√âSE ---
        ELEMENTS.gridView.style.display =
          state.view === "grid" ? "flex" : "none";
        if (ELEMENTS.collectionView) {
          ELEMENTS.collectionView.style.display =
            state.view === "collection" ? "column" : "none"; // Fontos: flex helyett column, hogy a scroll menjen
          // ITT A V√ÅLTOZ√ÅS: Ha ez a n√©zet akt√≠v, renderelj√ºnk!
          if (state.view === "collection") renderCollection();
        }

        if (ELEMENTS.galleryView) {
          ELEMENTS.galleryView.style.display =
            state.view === "gallery" ? "column" : "none"; // Fontos: flex helyett column
          // ITT A V√ÅLTOZ√ÅS: Ha ez a n√©zet akt√≠v, renderelj√ºnk!
          if (state.view === "gallery") renderGallery();
        }
        // Biztons√°gi ellen≈ërz√©s √©s megjelen√≠t√©s
        if (ELEMENTS.collectionView) {
          ELEMENTS.collectionView.style.display =
            state.view === "collection" ? "flex" : "none";
        }
        if (ELEMENTS.galleryView) {
          ELEMENTS.galleryView.style.display =
            state.view === "gallery" ? "flex" : "none";
        }

        ELEMENTS.storyModal.classList.toggle("active", state.view === "story");

        const isChatView =
          state.view === "chatList" || state.view === "chatDetail";
        ELEMENTS.chatScreenList.classList.toggle("active", isChatView);
        ELEMENTS.chatScreenDetail.classList.toggle(
          "active",
          state.view === "chatDetail"
        );

        // --- TAB BAR STATUS ---
        if (ELEMENTS.tabGrid) ELEMENTS.tabGrid.classList.remove("active");
        if (ELEMENTS.tabCollection)
          ELEMENTS.tabCollection.classList.remove("active");
        if (ELEMENTS.tabGallery) ELEMENTS.tabGallery.classList.remove("active");
        if (ELEMENTS.tabChat) ELEMENTS.tabChat.classList.remove("active");

        if (state.view === "grid" || state.view === "story") {
          ELEMENTS.tabGrid.classList.add("active");
        } else if (state.view === "collection") {
          if (ELEMENTS.tabCollection)
            ELEMENTS.tabCollection.classList.add("active");
        } else if (state.view === "gallery") {
          if (ELEMENTS.tabGallery) ELEMENTS.tabGallery.classList.add("active");
        } else if (isChatView) {
          ELEMENTS.tabChat.classList.add("active");
        }

        if (state.view === "grid") {
          renderGrid();
        } else if (state.view === "story") {
          updateStoryModalPages();
        } else if (state.view === "chatDetail") {
          renderChatDetail();
        }

        renderChatList();

        const hasText = ELEMENTS.chatInput.value.trim().length > 0;
        ELEMENTS.chatSendCircle.classList.toggle(
          "disabled",
          !hasText || state.typing
        );
      }

      // --- INIT ---
      for (let i = 0; i < 40; i++) createSnowflake();
      setInterval(updateCountdown, 1000);

      ELEMENTS.apiSaveBtn.onclick = () => {
        playSound("pop");
        if (ELEMENTS.apiInput.value.trim().length > 10) {
          saveState("apiKey", ELEMENTS.apiInput.value.trim());
          ELEMENTS.apiModal.style.display = "none";
          renderApp();
        } else alert("Hib√°s kulcs!");
      };

      // --- NAVIG√ÅCI√ìS GOMBOK ---
      ELEMENTS.tabGrid.onclick = () => {
        playSound("pop");
        setView("grid");
      };
      // √öJ GOMBOK KEZEL√âSE
      if (ELEMENTS.tabCollection) {
        ELEMENTS.tabCollection.onclick = () => {
          playSound("pop");
          setView("collection");
        };
      }
      if (ELEMENTS.tabGallery) {
        ELEMENTS.tabGallery.onclick = () => {
          playSound("pop");
          setView("gallery");
        };
      }

      ELEMENTS.tabChat.onclick = () => {
        playSound("pop");
        setView("chatList");
      };

      ELEMENTS.storyCloseBtn.onclick = () => {
        playSound("pop");
        setView("grid");
      };
      ELEMENTS.storyPrevBtn.onclick = () => {
        if (state.storyPage > 1) {
          state.storyPage--;
          renderApp();
        }
      };
      ELEMENTS.storyNextBtn.onclick = () => {
        if (state.storyPage < 2) {
          state.storyPage++;
          renderApp();
        }
      };
      document.getElementById("chat-list-close-btn").onclick = () => {
        playSound("pop");
        setView("grid");
      };
      document.getElementById("chat-detail-back-btn").onclick = () => {
        playSound("pop");
        setView("chatList", state.currentDayId);
      };

      ELEMENTS.chatInput.oninput = () => {
        ELEMENTS.chatSendCircle.classList.toggle(
          "disabled",
          !ELEMENTS.chatInput.value.trim() || state.typing
        );
      };
      ELEMENTS.chatSendCircle.onclick = () =>
        sendMessage(ELEMENTS.chatInput.value);

      ELEMENTS.testBtn.onclick = () => {
        state.testMode = !state.testMode;
        addNotification(
          "Rendszer",
          `Teszt M√≥d: ${state.testMode ? "BE" : "KI"}`,
          "‚öôÔ∏è"
        );
        renderApp();
      };

      window.onload = renderApp;
    </script>
  </body>
</html>
