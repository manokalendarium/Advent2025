<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mama Kalend√°riuma 2025</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&display=swap" rel="stylesheet">
    
    <style>
        :root { --accent: #66ccff; --text-primary: #ffffff; --text-secondary: rgba(255, 255, 255, 0.7); --luxury-red: #80001a; --glass: rgba(20, 20, 30, 0.6); --glass-border: rgba(255, 255, 255, 0.15); --msg-me: #007aff; --msg-them: rgba(255, 255, 255, 0.1); }
        body { margin: 0; font-family: 'Nunito', sans-serif; background: #050515; color: white; overflow: hidden; height: 100vh; width: 100vw; }
        .aurora-bg { position: absolute; width: 100%; height: 100%; z-index: -1; overflow: hidden; background: radial-gradient(circle at 50% 100%, #1a0b2e, #000); }
        .orb { position: absolute; border-radius: 50%; filter: blur(90px); opacity: 0.5; animation: float 10s infinite alternate; }
        @keyframes float { from { transform: translate(0,0); } to { transform: translate(30px, 50px); } }
        .snowflake { position: absolute; background: white; border-radius: 50%; animation: fall linear infinite; pointer-events: none; }
        @keyframes fall { to { transform: translateY(105vh); } }
        #root { height: 100%; }
        .app-container { display: flex; flex-direction: column; height: 100%; max-width: 600px; margin: 0 auto; padding: 20px; box-sizing: border-box; position: relative; }
        header { text-align: center; margin-bottom: 15px; margin-top: 10px; }
        h1 { margin: 0; font-weight: 900; font-size: 28px; background: linear-gradient(45deg, #cca43b, #ffd700); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-shadow: 0 0 20px rgba(255, 215, 0, 0.3); }
        .countdown { font-family: monospace; font-size: 12px; color: var(--accent); background: rgba(0,0,0,0.6); padding: 6px 12px; border-radius: 12px; margin-top: 8px; display: inline-block; border: 1px solid var(--glass-border); }
        .grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; overflow-y: auto; padding: 15px; background: var(--glass); border: 1px solid var(--glass-border); border-radius: 24px; backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); scrollbar-width: none; flex-grow: 1; }
        .grid::-webkit-scrollbar { display: none; }
        .day-cell { aspect-ratio: 1; background: rgba(255,255,255,0.03); border-radius: 18px; display: flex; flex-direction: column; align-items: center; justify-content: center; font-weight: bold; font-size: 22px; color: white; border: 1px solid rgba(255,255,255,0.05); transition: all 0.2s; cursor: pointer; position: relative; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .day-cell:active { transform: scale(0.95); }
        .day-cell.unlocked { border-color: var(--accent); background: rgba(102, 204, 255, 0.15); box-shadow: 0 0 15px rgba(102, 204, 255, 0.3); color: var(--accent); }
        .day-cell.locked { opacity: 0.5; color: #777; background: rgba(50,0,0,0.3); border-color: rgba(255,0,0,0.2); }
        .lock-icon { font-size: 12px; margin-top: 5px; opacity: 0.6; }
        .gift-icon { font-size: 28px; }
        .bottom-bar { margin-top: 15px; display: flex; justify-content: center; }
        .msg-btn { background: var(--luxury-red); border: 1px solid rgba(255, 215, 0, 0.3); color: #ffe6a0; padding: 14px 30px; border-radius: 25px; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 16px; box-shadow: 0 5px 20px rgba(128, 0, 26, 0.4); transition: transform 0.1s; position: relative; }
        .msg-btn:active { transform: scale(0.95); }
        .badge { background: red; color: white; font-size: 10px; width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; position: absolute; top: -5px; right: -5px; border: 2px solid #fff; }
        .notification-container { position: absolute; top: 10px; left: 10px; right: 10px; display: flex; flex-direction: column; gap: 10px; pointer-events: none; z-index: 200; }
        .notification { background: rgba(30, 30, 40, 0.95); backdrop-filter: blur(15px); padding: 15px; border-radius: 18px; border: 1px solid rgba(255,255,255,0.15); display: flex; gap: 12px; align-items: start; box-shadow: 0 10px 30px rgba(0,0,0,0.6); pointer-events: auto; cursor: pointer; animation: slideIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); transform-origin: top center; }
        @keyframes slideIn { from { transform: translateY(-50px) scale(0.9); opacity: 0; } to { transform: translateY(0) scale(1); opacity: 1; } }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); backdrop-filter: blur(8px); z-index: 50; display: flex; align-items: center; justify-content: center; animation: fadeIn 0.3s; }
        .modal-content { width: 90%; max-width: 450px; background: #fffaf0; color: #333; border-radius: 24px; overflow: hidden; display: flex; flex-direction: column; box-shadow: 0 25px 50px rgba(0,0,0,0.5); border: 2px solid #cca43b; max-height: 80vh; }
        .story-header { background: var(--luxury-red); color: #ffe6a0; padding: 20px; text-align: center; font-size: 24px; font-family: 'Times New Roman', serif; font-weight: bold; }
        .story-body { padding: 25px; font-size: 18px; line-height: 1.6; overflow-y: auto; font-family: 'Times New Roman', serif; }
        .story-footer { padding: 20px; text-align: center; border-top: 1px solid rgba(0,0,0,0.1); background: #fffaf0; }
        .close-btn { width: 100%; padding: 12px; background: var(--luxury-red); color: white; border: none; border-radius: 12px; font-weight: bold; font-size: 16px; cursor: pointer; }
        .chat-modal { width: 100%; height: 100%; max-width: 100%; max-height: 100%; background: #000; border-radius: 0; display: flex; flex-direction: column; }
        .chat-header { padding: 15px; background: rgba(20,20,20,0.9); border-bottom: 1px solid #333; display: flex; align-items: center; justify-content: space-between; }
        .chat-list { flex-grow: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; background: radial-gradient(circle at center, #1a1a2e, #000); }
        .msg-group { display: flex; flex-direction: column; gap: 5px; }
        .date-label { text-align: center; font-size: 11px; color: #666; margin: 10px 0; }
        .msg { max-width: 75%; padding: 10px 14px; border-radius: 18px; font-size: 15px; line-height: 1.4; position: relative; word-wrap: break-word; }
        .msg.them { background: var(--msg-them); color: white; align-self: flex-start; border-bottom-left-radius: 4px; }
        .msg.me { background: var(--msg-me); color: white; align-self: flex-end; border-bottom-right-radius: 4px; }
        .chat-input-area { padding: 10px 15px; background: rgba(30,30,30,0.9); border-top: 1px solid #333; display: flex; gap: 10px; align-items: center; }
        .chat-input { flex-grow: 1; background: #333; border: none; color: white; padding: 10px 15px; border-radius: 20px; font-size: 16px; outline: none; }
        .send-btn { background: none; border: none; font-size: 24px; cursor: pointer; color: var(--accent); }
        .send-btn:disabled { color: #555; }
        .typing { display: flex; gap: 4px; padding: 10px 15px; background: var(--msg-them); border-radius: 18px; width: fit-content; align-self: flex-start; border-bottom-left-radius: 4px; }
        .dot { width: 6px; height: 6px; background: #aaa; border-radius: 50%; animation: bounce 1.4s infinite ease-in-out both; }
        .dot:nth-child(1) { animation-delay: -0.32s; } .dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }
        .test-btn { position: absolute; top: 20px; left: 20px; font-size: 24px; opacity: 0.3; cursor: pointer; z-index: 10; }
        .test-panel { position: absolute; top: 60px; left: 20px; background: rgba(0,0,0,0.9); padding: 15px; border-radius: 15px; border: 1px solid #555; z-index: 200; }
        .reply-area { padding: 15px; background: #1a1a1a; display: flex; gap: 10px; overflow-x: auto; }
        .reply-chip { background: rgba(102, 204, 255, 0.1); border: 1px solid var(--accent); color: var(--accent); padding: 8px 16px; border-radius: 20px; white-space: nowrap; cursor: pointer; font-size: 14px; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useLayoutEffect } = React;

        const API_KEY = "AIzaSyBSk3j5AAD4Gwge3pe5IUay8wQ5jqyFyPc";

        // --- ADATOK ---
        const characters = {
            hanna: { name: "Hanna", icon: "üéÄ", desc: "r√≥zsasz√≠n, gondoskod√≥ l√°ny v√≠zil√≥", style: "Kedves, any√°skod√≥, sok emojit haszn√°l." },
            herold: { name: "Herold", icon: "ü¶õ", desc: "lila, puf√≥k √©s fal√°nk v√≠zil√≥", style: "Vicces, √©hes, szeleburdi." },
            bucko: { name: "Buck√≥", icon: "üê≥", desc: "k√©k, b√°tor kis b√°lna", style: "B√°tor, lelkes, vizet emleget." }
        };

        const storyData = [
            { id: 1, title: "A nagy elutaz√°s", message: "A reggel k√∂d√∂sen indult... Papa √©s Mama elindultak. Herold coc√≥ az ablakban √°llt. 'Ne itasd az egereket!' ‚Äì mondta Hanna. Buck√≥ t√©sztasz≈±r≈ëvel a fej√©n tisztelgett.", char: "hanna", msgs: ["Szia Mama! ‚ù§Ô∏è Ne agg√≥dj √©rt√ºnk, nagyon √ºgyesek vagyunk itt otthon! Herold m√°r nem is s√≠r. Vigy√°zz magadra! Puszilunk!", "K√©sz√≠tettem neked egy kis csomagot az √∫tra. Haszn√°ld ezt a Mini k√©zkr√©met, hogy puha maradjon a kezed!"], replies: [{u: "K√∂sz√∂n√∂m, Hanna! ‚ù§Ô∏è", c: "Sz√≠vesen! Most megyek, seg√≠tek Heroldnak kipakolni. Szia! üëã"}, {u: "Ti is vigy√°zzatok!", c: "√çg√©rj√ºk! Na szaladok, mert Buck√≥ beszorult. Szia!"}] },
            { id: 2, title: "Els≈ë este", message: "Furcsa csend. Buck√≥ a k√°dban aludt, mert hi√°nyzott neki a tenger. A t√∂bbiek a sz≈ënyegen kempingeztek. 'Ha bet√∂r≈ë j√∂n, csapkodni fogok!'", char: "bucko", msgs: ["Jelentem: a h√°z biztons√°gos! A f√ºrd≈ëk√°dban alszom, onnan mindent hallok. üê≥", "Hogy te is nyugodtan aludj, k√ºld√∂k neked egy kis Levendul√°s p√°rnapermentet. Sz√©p √°lmokat!"], replies: [{u: "J√≥ √©jt, Buck√≥! üåô", c: "Neked is! Megyek csobbanok egyet. Sz√©p √°lmokat! üõÅ"}, {u: "B√°tor vagy!", c: "K√∂szi! De most beb√∫jok a habok al√°. Szia! ü´ß"}] },
            { id: 3, title: "Palacsinta party", message: "Hanna f≈ëz√∂tt. Lila fest√©k ker√ºlt a t√©szt√°ba. Az els≈ë palacsinta a plafonra ragadt. Buck√≥ s√≥sat k√©rt, de spen√≥tos lett.", char: "hanna", msgs: ["Bocsi a konyh√°√©rt... üòÖ Kicsit lila lett a plafon. De √≠g√©rem, letakar√≠tjuk!", "Ha m√°r mi √∂sszekent√ºk magunkat, te kend be az arcodat ezzel a finom Kr√©mes arcmaszkkal. J√≥t fog tenni!"], replies: [{u: "Jaj, ti kis maszatok!", c: "H√°t ja... na megyek, mert cs√∂p√∂g a t√©szta. Szia!"}, {u: "Im√°dom a maszkot!", c: "K√∂szi! Most lemosom magamr√≥l a lisztet. Puszi!"}] },
        ];

        for(let i=storyData.length + 1; i<=24; i++) {
            storyData.push({ id: i, title: `${i}. Nap`, message: "M√©g k√©sz√ºl a t√∂rt√©net...", char: "herold", msgs: ["Szia Mama! M√©g dolgozunk ezen a napon!", "Addig is itt egy kis szeretet csomag!"], replies: [{u: "K√∂szi!", c: "Sz√≠vesen! Szia!"}] });
        }

        // --- GEMINI AI 2.5 FLASH ---
        async function callGemini(userMessage, characterKey, context) {
            const char = characters[characterKey];
            const systemPrompt = `
            Te vagy ${char.name}, egy ${char.desc}.
            A gazd√°dnak, 'Mam√°nak' √≠rsz chat √ºzenetet. St√≠lusod: ${char.style}.
            A mai nap esem√©nye: ${context}.
            V√°laszolj a Mam√°nak az ≈ë √ºzenet√©re.
            Legy√©l r√∂vid (max 2 mondat), kedves √©s vicces. K√∂sz√∂nj el a v√©g√©n, mert dolgod van.
            `;

            // A dokument√°ci√≥ alapj√°n a Gemini 2.5 (vagy 2.0 Flash) h√≠v√°sa:
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${API_KEY}`;
            
            const payload = {
                contents: [
                    {
                        role: "user",
                        parts: [{ text: systemPrompt + "\n\n√úzenet: " + userMessage }]
                    }
                ],
                generationConfig: {
                    thinkingConfig: { thinkingBudget: 0 } // Flash modelln√©l kikapcsoljuk a thinkinget a sebess√©g miatt, ahogy a doksi √≠rta
                }
            };

            try {
                const response = await fetch(url, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(payload)
                });
                
                if (!response.ok) {
                    const err = await response.json();
                    console.error("API Hiba:", err);
                    return `‚ö†Ô∏è Hiba (${response.status}): ${err.error?.message || 'Ismeretlen hiba'}`;
                }

                const data = await response.json();
                return data.candidates[0].content.parts[0].text;
            } catch (e) {
                console.error("Network Error:", e);
                return `‚ö†Ô∏è H√°l√≥zati hiba: ${e.message}`;
            }
        }

        function App() {
            const [unlockedDays, setUnlockedDays] = useState(() => JSON.parse(localStorage.getItem('openedDays')) || []);
            const [chatHistory, setChatHistory] = useState(() => JSON.parse(localStorage.getItem('chatHistory2')) || {});
            const [activeModal, setActiveModal] = useState(null);
            const [currentDay, setCurrentDay] = useState(null);
            const [notifications, setNotifications] = useState([]);
            const [unreadCount, setUnreadCount] = useState(0);
            const [testMode, setTestMode] = useState(false);
            const [showTestMenu, setShowTestMenu] = useState(false);
            const [countdown, setCountdown] = useState("Sz√°mol√°s...");
            const [typingDay, setTypingDay] = useState(null);
            const [inputValue, setInputValue] = useState("");
            const chatEndRef = useRef(null);

            useEffect(() => {
                setUnreadCount(unlockedDays.length > 0 ? 1 : 0);
            }, []);

            useEffect(() => {
                const t = setInterval(() => {
                    const target = new Date("Dec 24, 2025 18:00:00").getTime();
                    const diff = target - new Date().getTime();
                    if (diff > 0) {
                        const d = Math.floor(diff / (1000 * 60 * 60 * 24));
                        const h = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                        const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                        setCountdown(`M√©g ${d} nap ${h} √≥ra ${m} perc`);
                    } else setCountdown("BOLDOG KAR√ÅCSONYT!");
                }, 1000);
                return () => clearInterval(t);
            }, []);

            useLayoutEffect(() => {
                chatEndRef.current?.scrollIntoView({ behavior: "smooth" });
            }, [chatHistory, activeModal, typingDay]);

            const addNotification = (name, text, icon) => {
                const id = Date.now();
                setNotifications(prev => [{id, name, text, icon}, ...prev]);
                setTimeout(() => setNotifications(prev => prev.filter(n => n.id !== id)), 6000);
            };

            const handleDayClick = (day) => {
                const today = new Date().getDate();
                const isAvailable = testMode || day.id <= today;
                
                if (isAvailable) {
                    if (!unlockedDays.includes(day.id)) {
                        const newUnlocked = [...unlockedDays, day.id];
                        setUnlockedDays(newUnlocked);
                        localStorage.setItem('openedDays', JSON.stringify(newUnlocked));
                        
                        const initialMsgs = day.msgs.map(m => ({ text: m, isMe: false }));
                        const newChats = { ...chatHistory, [day.id]: initialMsgs };
                        setChatHistory(newChats);
                        localStorage.setItem('chatHistory2', JSON.stringify(newChats));
                        setUnreadCount(prev => prev + 1);
                        
                        const char = characters[day.char];
                        addNotification(char.name, day.msgs[0], char.icon);
                        setTimeout(() => addNotification(char.name, day.msgs[1], "üéÅ"), 4000);
                    }
                    setCurrentDay(day);
                    setActiveModal('story');
                } else {
                    const scolds = ["M√©g nem szabad! ü§´", "Ez m√©g alszik! üò¥", "Ejnye-bejnye! üëÄ"];
                    addNotification("Rendszer", scolds[Math.floor(Math.random()*scolds.length)], "üîí");
                }
            };

            const openChatList = () => { setUnreadCount(0); setActiveModal('chatList'); };
            const openChatDetail = (charKey) => {
                const relevantDays = unlockedDays.map(id => storyData.find(d => d.id === id)).filter(d => d.char === charKey).sort((a,b) => a.id - b.id);
                if (relevantDays.length > 0) {
                    setActiveModal('chatDetail');
                    setCurrentDay(relevantDays[relevantDays.length-1]); 
                }
            };

            const handleSendMessage = async () => {
                if (!inputValue.trim() || !currentDay) return;
                const text = inputValue;
                setInputValue("");
                
                const dayId = currentDay.id;
                const newMsg = { text, isMe: true };
                const updatedHistory = { ...chatHistory, [dayId]: [...(chatHistory[dayId] || []), newMsg] };
                setChatHistory(updatedHistory);
                
                setTypingDay(dayId);
                
                // K√©sleltet√©s
                await new Promise(r => setTimeout(r, 2000));

                const charKey = currentDay.char;
                const context = `Mese: ${currentDay.message}. Aj√°nd√©k: ${currentDay.msgs[1]}`;
                const aiResponseText = await callGemini(text, charKey, context);
                
                const aiMsg = { text: aiResponseText, isMe: false };
                const finalHistory = { ...updatedHistory, [dayId]: [...updatedHistory[dayId], aiMsg] };
                
                setTypingDay(null);
                setChatHistory(finalHistory);
                localStorage.setItem('chatHistory2', JSON.stringify(finalHistory));
            };

            const handleReply = (dayId, replyIndex) => {
                const day = storyData.find(d => d.id === dayId);
                const reply = day.replies[replyIndex];
                
                let currentChats = chatHistory[dayId] || [];
                currentChats = [...currentChats, { text: reply.u, isMe: true }];
                
                const tempHistory = { ...chatHistory, [dayId]: currentChats };
                setChatHistory(tempHistory);
                setTypingDay(dayId);

                setTimeout(() => {
                   currentChats = [...currentChats, { text: reply.c, isMe: false }];
                   const finalHistory = { ...chatHistory, [dayId]: currentChats };
                   setTypingDay(null);
                   setChatHistory(finalHistory);
                   localStorage.setItem('chatHistory2', JSON.stringify(finalHistory));
                }, 2000);
            };

            const fullReset = () => { localStorage.clear(); location.reload(); };

            return (
                <div className="app-container">
                    <div className="test-btn" onClick={() => setShowTestMenu(!showTestMenu)}>‚öôÔ∏è</div>
                    {showTestMenu && (
                        <div className="test-panel">
                            <h3>Teszt Panel</h3>
                            <label><input type="checkbox" checked={testMode} onChange={e => setTestMode(e.target.checked)} /> Teszt M√≥d</label>
                            <br /><br />
                            <button onClick={fullReset} style={{background:'red', color:'white', border:'none', padding:'5px', borderRadius:'5px'}}>üóëÔ∏è RESET</button>
                        </div>
                    )}

                    <div className="aurora-bg"><div className="orb orb-1"></div><div className="orb orb-2"></div><div className="orb orb-3"></div></div>
                    <div id="snow-container">{[...Array(50)].map((_, i) => <div key={i} className="snowflake" style={{left: Math.random()*100+'%', animationDuration: (Math.random()*3+2)+'s', width: (Math.random()*4+2)+'px', height: (Math.random()*4+2)+'px', animationDelay: Math.random()*5+'s'}}></div>)}</div>

                    <div className="notification-container">
                        {notifications.map(n => (
                            <div key={n.id} className="notification" onClick={openChatList}>
                                <div style={{fontSize: '24px'}}>{n.icon}</div>
                                <div><div style={{fontWeight: 'bold', marginBottom: '2px'}}>{n.name}</div><div style={{fontSize: '12px', opacity: 0.8}}>{n.text}</div></div>
                            </div>
                        ))}
                    </div>

                    <header>
                        <h1>MAMA KALEND√ÅRIUMA</h1>
                        <div className="countdown">{countdown}</div>
                    </header>

                    <div className="grid">
                        {storyData.map(day => {
                             const isUnlocked = unlockedDays.includes(day.id);
                             const isAvailable = testMode || day.id <= new Date().getDate();
                             return (
                                <div key={day.id} className={`day-cell ${isUnlocked ? 'unlocked' : (isAvailable ? '' : 'locked')}`} onClick={() => handleDayClick(day)}>
                                    {isUnlocked ? <div className="gift-icon">üéÅ</div> : <div>{day.id}</div>}
                                    {!isUnlocked && !isAvailable && <div className="lock-icon">üîí</div>}
                                </div>
                             );
                        })}
                    </div>

                    <div className="bottom-bar">
                        <div className="msg-btn" onClick={openChatList}>üí¨ √úzenetek {unreadCount > 0 && <div className="badge">{unreadCount}</div>}</div>
                    </div>

                    {activeModal === 'story' && currentDay && (
                        <div className="modal-overlay" onClick={() => setActiveModal(null)}>
                            <div className="modal-content" onClick={e => e.stopPropagation()}>
                                <div className="story-header">üìú {currentDay.title}</div>
                                <div className="story-body">{currentDay.message}</div>
                                <div className="story-footer"><div style={{color: 'var(--accent)', fontStyle: 'italic', marginBottom: '10px'}}>üí° N√©zd meg az √ºzeneteket!</div><button className="close-btn" onClick={() => setActiveModal(null)}>Bez√°r√°s</button></div>
                            </div>
                        </div>
                    )}

                    {activeModal === 'chatList' && (
                        <div className="modal-overlay" onClick={() => setActiveModal(null)}>
                            <div className="modal-content chat-modal" onClick={e => e.stopPropagation()}>
                                <div className="chat-header"><span style={{fontWeight:'bold', fontSize:'18px'}}>√úzenetek</span><button onClick={() => setActiveModal(null)} style={{background:'none',border:'none',color:'var(--accent)',fontSize:'16px'}}>Bez√°r√°s</button></div>
                                <div className="chat-list" style={{padding:0}}>
                                    {['herold', 'hanna', 'bucko'].map(key => {
                                        const char = characters[key];
                                        const relevantDays = unlockedDays.map(id => storyData.find(d => d.id === id)).filter(d => d.char === key).sort((a,b) => a.id - b.id);
                                        if (relevantDays.length === 0) return null;
                                        const lastDay = relevantDays[relevantDays.length-1];
                                        const history = chatHistory[lastDay.id] || [];
                                        const lastMsg = history.length > 0 ? history[history.length-1].text : "√öj √ºzenet...";
                                        return (
                                            <div key={key} onClick={() => openChatDetail(key)} style={{display:'flex', gap:'15px', padding:'15px', borderBottom:'1px solid #333', cursor:'pointer', background:'rgba(255,255,255,0.05)'}}>
                                                <div style={{fontSize:'30px', width:'50px', textAlign:'center'}}>{char.icon}</div>
                                                <div style={{flexGrow:1}}><div style={{fontWeight:'bold', fontSize:'16px'}}>{char.name}</div><div style={{fontSize:'13px', color:'#aaa', overflow:'hidden', textOverflow:'ellipsis', whiteSpace:'nowrap', maxWidth:'200px'}}>{lastMsg}</div></div>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        </div>
                    )}

                    {activeModal === 'chatDetail' && currentDay && (
                        <div className="modal-overlay" onClick={() => setActiveModal('chatList')}>
                            <div className="modal-content chat-modal" onClick={e => e.stopPropagation()}>
                                <div className="chat-header">
                                    <div style={{display:'flex', alignItems:'center', gap:'10px'}}><button onClick={() => setActiveModal('chatList')} style={{background:'none',border:'none',color:'var(--accent)',fontSize:'20px'}}>‚Äπ</button><span style={{fontSize:'24px'}}>{characters[currentDay.char].icon}</span><span style={{fontWeight:'bold', fontSize:'18px'}}>{characters[currentDay.char].name}</span></div>
                                </div>
                                <div className="chat-list">
                                    {unlockedDays.map(id => storyData.find(d => d.id === id)).filter(d => d.char === currentDay.char).sort((a,b) => a.id - b.id).map(day => {
                                        const history = chatHistory[day.id] || [];
                                        const hasUserReplied = history.some(m => m.isMe);
                                        return (
                                            <div key={day.id} className="msg-group">
                                                <div className="date-label">December {day.id}.</div>
                                                {history.map((msg, idx) => (
                                                    <div key={idx} className="msg-row" style={{justifyContent: msg.isMe ? 'flex-end' : 'flex-start', display:'flex'}}>
                                                        {!msg.isMe && <div className="avatar">{characters[day.char].icon}</div>}
                                                        <div className={`msg ${msg.isMe ? 'me' : 'them'}`}>{msg.text}</div>
                                                    </div>
                                                ))}
                                                {!hasUserReplied && day.id === currentDay.id && !typingDay && (
                                                    <div className="reply-area">
                                                        {day.replies.map((r, idx) => (
                                                            <div key={idx} className="reply-chip" onClick={() => handleReply(day.id, idx)}>{r.u}</div>
                                                        ))}
                                                    </div>
                                                )}
                                            </div>
                                        )
                                    })}
                                    {typingDay && <div className="msg-row" style={{display:'flex'}}><div className="avatar">{characters[storyData.find(d=>d.id===typingDay).char].icon}</div><div className="typing"><div className="dot"></div><div className="dot"></div><div className="dot"></div></div></div>}
                                    <div ref={chatEndRef} />
                                </div>
                                <div className="chat-input-area">
                                    <input className="chat-input" placeholder="√çrj neki..." value={inputValue} onChange={e => setInputValue(e.target.value)} onKeyPress={e => e.key === 'Enter' && handleSendMessage()} disabled={!!typingDay} />
                                    <button className="send-btn" onClick={handleSendMessage} disabled={!inputValue.trim() || !!typingDay}>‚û§</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
