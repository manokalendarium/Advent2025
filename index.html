<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mama Kalend√°riuma</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    
    <style>
        :root {
            --ios-blue: #007AFF;
            --ios-gray: #262629;
            --ios-bg: #000000;
            --ios-text: #FFFFFF;
            --ios-gray-text: #8E8E93;
            --glass: rgba(30, 30, 30, 0.6);
            --glass-border: rgba(255, 255, 255, 0.15);
            --royal-gold: #FFD700;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { 
            margin: 0; font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: #000; color: white; overflow: hidden; height: 100vh; width: 100vw;
        }

        /* --- H√ÅTT√âR & EFFEKTEK --- */
        .background {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
            background: radial-gradient(circle at top left, #1a1a2e, #000);
        }
        .orb {
            position: absolute; border-radius: 50%; filter: blur(80px); opacity: 0.4;
            animation: float 15s infinite ease-in-out alternate;
        }
        .orb-1 { width: 300px; height: 300px; background: #007AFF; top: -50px; left: -50px; }
        .orb-2 { width: 400px; height: 400px; background: #5E5CE6; bottom: -100px; right: -100px; animation-delay: -5s; }
        
        @keyframes float { 0% { transform: translate(0,0); } 100% { transform: translate(40px, 60px); } }

        /* H√ìES√âS */
        .snowflake { position: absolute; background: white; border-radius: 50%; opacity: 0.7; pointer-events: none; animation: fall linear infinite; }
        @keyframes fall { to { transform: translateY(105vh); } }

        /* --- F≈ê TART√ÅLY --- */
        #root { height: 100%; display: flex; justify-content: center; }
        .app-screen {
            width: 100%; max-width: 480px; height: 100%; 
            display: flex; flex-direction: column; position: relative;
            background: rgba(0,0,0,0.2);
        }

        /* --- HEADER --- */
        .header {
            padding: 20px; text-align: center; position: relative; z-index: 10;
        }
        .app-title {
            font-size: 12px; letter-spacing: 2px; text-transform: uppercase; color: rgba(255,255,255,0.5); margin-bottom: 5px;
        }
        .main-title {
            font-size: 28px; font-weight: 800;
            background: linear-gradient(135deg, #fff, #ccc); -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            text-shadow: 0 4px 20px rgba(255,255,255,0.3);
        }
        .countdown {
            font-family: monospace; font-size: 11px; background: rgba(255,255,255,0.1); 
            padding: 4px 8px; border-radius: 6px; display: inline-block; margin-top: 8px;
            border: 1px solid rgba(255,255,255,0.1); color: var(--royal-gold);
        }

        /* --- GRID (NAPT√ÅR) --- */
        .grid-container {
            flex: 1; overflow-y: auto; padding: 20px;
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px;
            align-content: start;
        }
        .grid-container::-webkit-scrollbar { display: none; }

        .day-card {
            aspect-ratio: 1;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 18px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            position: relative; cursor: pointer;
            transition: all 0.2s cubic-bezier(0.25, 0.8, 0.25, 1);
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        .day-card:active { transform: scale(0.92); background: rgba(255,255,255,0.15); }
        .day-card.locked { opacity: 0.4; background: rgba(0,0,0,0.3); border-color: rgba(255,255,255,0.05); }
        
        .day-num { font-size: 20px; font-weight: 700; }
        .status-icon { font-size: 24px; }
        
        .day-card.opened {
            background: rgba(0, 122, 255, 0.2);
            border-color: rgba(0, 122, 255, 0.5);
            box-shadow: 0 0 20px rgba(0, 122, 255, 0.3);
        }

        /* --- ALS√ì TAB BAR --- */
        .tab-bar {
            background: rgba(20, 20, 20, 0.85); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255,255,255,0.1);
            padding: 10px 30px 30px 30px;
            display: flex; justify-content: space-around;
        }
        .tab-item {
            display: flex; flex-direction: column; align-items: center; gap: 4px;
            color: #888; cursor: pointer; transition: color 0.2s; position: relative;
        }
        .tab-item.active { color: #007AFF; }
        .tab-icon { font-size: 24px; }
        .tab-label { font-size: 10px; font-weight: 500; }
        .badge {
            position: absolute; top: -2px; right: -5px;
            background: #FF3B30; color: white; font-size: 10px; font-weight: bold;
            min-width: 16px; height: 16px; border-radius: 8px;
            display: flex; align-items: center; justify-content: center; padding: 2px;
        }

        /* --- MESE MODAL --- */
        .modal-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); backdrop-filter: blur(5px);
            z-index: 50; display: flex; align-items: center; justify-content: center;
            animation: fadeIn 0.2s;
        }
        .story-card {
            width: 85%; max-height: 70%; background: #1C1C1E;
            border-radius: 24px; padding: 24px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.8);
            border: 1px solid rgba(255,255,255,0.1);
            display: flex; flex-direction: column;
            animation: scaleUp 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .story-title { font-size: 22px; font-weight: 700; margin-bottom: 15px; color: white; text-align: center; }
        .story-text { font-size: 17px; line-height: 1.5; color: #ddd; overflow-y: auto; flex: 1; margin-bottom: 20px; font-family: "Times New Roman", serif; }
        .story-btn {
            background: #007AFF; color: white; border: none; padding: 14px;
            border-radius: 14px; font-size: 17px; font-weight: 600; width: 100%; cursor: pointer;
        }

        /* --- API KULCS MODAL --- */
        .api-modal {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 999; display: flex; align-items: center; justify-content: center;
        }
        .api-card {
            width: 85%; background: #1C1C1E; padding: 30px; border-radius: 24px; text-align: center; border: 1px solid #333;
        }
        .api-input {
            width: 100%; padding: 12px; margin: 15px 0; background: #2C2C2E; border: 1px solid #444; border-radius: 12px; color: white; font-size: 16px;
        }

        /* --- iMESSAGE CHAT --- */
        .chat-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 100;
            display: flex; flex-direction: column;
            animation: slideLeft 0.3s ease-out;
        }
        
        .chat-header {
            background: rgba(20, 20, 20, 0.85); backdrop-filter: blur(20px);
            padding: 15px 10px; display: flex; align-items: center;
            border-bottom: 1px solid rgba(255,255,255,0.1); z-index: 20;
        }
        .back-btn { color: #007AFF; font-size: 17px; display: flex; align-items: center; gap: 5px; cursor: pointer; }
        .chat-avatar-header {
            display: flex; flex-direction: column; align-items: center; flex: 1; margin-right: 40px;
        }
        .header-avatar { font-size: 24px; margin-bottom: 2px; transition: transform 0.2s; cursor: pointer; }
        .header-avatar:active { transform: scale(1.2); }
        .header-name { font-size: 12px; color: #fff; font-weight: 500; }

        .chat-body {
            flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 8px;
            padding-bottom: 80px;
        }
        
        .message-row { display: flex; width: 100%; margin-bottom: 4px; }
        .message-row.me { justify-content: flex-end; }
        .message-row.them { justify-content: flex-start; align-items: flex-end; }
        
        .avatar-small { width: 30px; height: 30px; border-radius: 50%; background: #333; display: flex; align-items: center; justify-content: center; font-size: 16px; margin-right: 8px; }

        .bubble {
            max-width: 75%; padding: 10px 16px; font-size: 17px; line-height: 1.4; position: relative;
        }
        .bubble.me {
            background: #007AFF; color: white; border-radius: 20px 20px 4px 20px;
        }
        .bubble.them {
            background: #262628; color: white; border-radius: 20px 20px 20px 4px;
        }

        .chat-input-bar {
            position: absolute; bottom: 0; width: 100%;
            background: rgba(20, 20, 20, 0.9); backdrop-filter: blur(20px);
            padding: 10px 15px 30px 15px; border-top: 1px solid rgba(255,255,255,0.1);
            display: flex; align-items: center; gap: 10px;
        }
        .ios-input {
            flex: 1; background: #1C1C1E; border: 1px solid #333;
            border-radius: 20px; padding: 8px 15px; color: white; font-size: 17px; outline: none;
        }
        .send-circle {
            width: 30px; height: 30px; background: #007AFF; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; color: white; font-size: 16px; cursor: pointer;
        }
        .send-circle.disabled { background: #444; color: #888; }

        /* TYPING INDICATOR */
        .typing-bubble {
            background: #262628; padding: 12px 16px; border-radius: 20px; width: fit-content;
            display: flex; gap: 4px; align-items: center; margin-left: 38px; border-bottom-left-radius: 4px;
        }
        .dot { width: 6px; height: 6px; background: #8E8E93; border-radius: 50%; animation: bounce 1.4s infinite ease-in-out both; }
        .dot:nth-child(1) { animation-delay: -0.32s; } .dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce { 0%, 80%, 100% { transform: scale(0); } 40% { transform: scale(1); } }

        /* iOS NOTIFICATION */
        .ios-notification {
            position: absolute; top: 10px; left: 10px; right: 10px;
            background: rgba(30, 30, 30, 0.85); backdrop-filter: blur(25px);
            border-radius: 18px; padding: 12px;
            display: flex; gap: 12px; box-shadow: 0 5px 20px rgba(0,0,0,0.5);
            z-index: 200; cursor: pointer;
            animation: notifSlide 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
            border: 1px solid rgba(255,255,255,0.1);
        }
        .notif-icon {
            width: 40px; height: 40px; background: #333; border-radius: 10px;
            display: flex; align-items: center; justify-content: center; font-size: 22px;
        }
        .notif-content { flex: 1; }
        .notif-header { display: flex; justify-content: space-between; margin-bottom: 2px; }
        .notif-title { font-weight: 600; font-size: 14px; color: white; }
        .notif-msg { font-size: 14px; color: #fff; line-height: 1.2; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }

        @keyframes notifSlide { from { transform: translateY(-100px); } to { transform: translateY(0); } }
        @keyframes slideLeft { from { transform: translateX(100%); } to { transform: translateX(0); } }
        @keyframes scaleUp { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .reply-chips { display: flex; gap: 8px; padding: 10px 15px; overflow-x: auto; }
        .chip { background: #1C1C1E; color: #007AFF; border: 1px solid #007AFF; padding: 8px 16px; border-radius: 20px; font-size: 15px; white-space: nowrap; cursor: pointer; }
        
        .test-btn { position: absolute; top: 20px; left: 20px; font-size: 24px; opacity: 0.3; cursor: pointer; z-index: 10; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useLayoutEffect } = React;

        // --- ADATOK ---
        const characters = {
            hanna: { name: "Hanna", icon: "üéÄ", desc: "r√≥zsasz√≠n, gondoskod√≥ l√°ny v√≠zil√≥", style: "Kedves, any√°skod√≥, sok emojit haszn√°l." },
            herold: { name: "Herold", icon: "ü¶õ", desc: "lila, puf√≥k √©s fal√°nk v√≠zil√≥", style: "Vicces, √©hes, szeleburdi." },
            bucko: { name: "Buck√≥", icon: "üê≥", desc: "k√©k, b√°tor kis b√°lna", style: "B√°tor, lelkes, vizet emleget." }
        };

        const storyData = [
            { id: 1, title: "A nagy elutaz√°s", message: "A reggel k√∂d√∂sen indult... Papa √©s Mama elindultak. Herold coc√≥ az ablakban √°llt. 'Ne itasd az egereket!' ‚Äì mondta Hanna. Buck√≥ t√©sztasz≈±r≈ëvel a fej√©n tisztelgett.", char: "hanna", msgs: ["Szia Mama! ‚ù§Ô∏è Ne agg√≥dj √©rt√ºnk, nagyon √ºgyesek vagyunk itt otthon! Herold m√°r nem is s√≠r. Vigy√°zz magadra! Puszilunk!", "K√©sz√≠tettem neked egy kis csomagot az √∫tra. Haszn√°ld ezt a Mini k√©zkr√©met, hogy puha maradjon a kezed!"], replies: [{u: "K√∂sz√∂n√∂m, Hanna! ‚ù§Ô∏è", c: "Sz√≠vesen! Most megyek, seg√≠tek Heroldnak kipakolni. Szia! üëã"}, {u: "Ti is vigy√°zzatok!", c: "√çg√©rj√ºk! Na szaladok, mert Buck√≥ beszorult. Szia!"}] },
            { id: 2, title: "Els≈ë este", message: "Furcsa csend. Buck√≥ a k√°dban aludt, mert hi√°nyzott neki a tenger. A t√∂bbiek a sz≈ënyegen kempingeztek. 'Ha bet√∂r≈ë j√∂n, csapkodni fogok!'", char: "bucko", msgs: ["Jelentem: a h√°z biztons√°gos! A f√ºrd≈ëk√°dban alszom, onnan mindent hallok. üê≥", "Hogy te is nyugodtan aludj, k√ºld√∂k neked egy kis Levendul√°s p√°rnapermentet. Sz√©p √°lmokat!"], replies: [{u: "J√≥ √©jt, Buck√≥! üåô", c: "Neked is! Megyek csobbanok egyet. Sz√©p √°lmokat! üõÅ"}, {u: "B√°tor vagy!", c: "K√∂szi! De most beb√∫jok a habok al√°. Szia! ü´ß"}] },
            // ... Gener√°ljuk a t√∂bbit a p√©lda kedv√©√©rt
        ];

        for(let i=3; i<=24; i++) {
            storyData.push({ id: i, title: `${i}. Nap`, message: "A t√∂rt√©net hamarosan √©rkezik...", char: "herold", msgs: ["Szia Mama! M√©g k√©sz√ºl√ºnk!", "Itt egy kis szeretet csomag neked!"], replies: [{u: "K√∂szi!", c: "Puszi!"}] });
        }

        // --- AI SERVICE (GEMINI 2.0 FLASH) - BIZTONS√ÅGOS KULCSKEZEL√âS ---
        async function callGemini(apiKey, userMessage, characterKey, context) {
            const char = characters[characterKey];
            const systemPrompt = `You are ${char.name}, a ${char.desc}. You are texting your owner 'Mama'. Style: ${char.style}. Context: ${context}. Reply to: "${userMessage}". Keep it short (max 2 sentences), cute, funny. End with a goodbye reason. Language: Hungarian.`;

            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${apiKey}`;
            
            const payload = {
                contents: [{ parts: [{ text: systemPrompt }] }],
                generationConfig: { temperature: 0.7 }
            };

            try {
                const response = await fetch(url, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(payload)
                });
                const data = await response.json();
                if(!response.ok) throw new Error(data.error?.message || "API Error");
                return data.candidates[0].content.parts[0].text;
            } catch (e) {
                console.error(e);
                return "Most tele a sz√°m bejglivel, de egyet√©rtek! ü•Ø (Offline m√≥d)";
            }
        }

        // --- APP COMPONENT ---
        function App() {
            // --- KULCS KEZEL√âS ---
            const [apiKey, setApiKey] = useState(() => localStorage.getItem('geminiKey') || "");
            const [showKeyModal, setShowKeyModal] = useState(false);
            const [tempKey, setTempKey] = useState("");

            useEffect(() => { if(!apiKey) setShowKeyModal(true); }, [apiKey]);

            const saveKey = () => {
                if(tempKey.length > 10) {
                    localStorage.setItem('geminiKey', tempKey);
                    setApiKey(tempKey);
                    setShowKeyModal(false);
                } else alert("√ârv√©nytelen kulcs!");
            };

            // √Ållapotok
            const [unlockedDays, setUnlockedDays] = useState(() => JSON.parse(localStorage.getItem('openedDays')) || []);
            const [chatHistory, setChatHistory] = useState(() => JSON.parse(localStorage.getItem('chatHistory3')) || {});
            const [view, setView] = useState('grid'); // 'grid', 'story', 'chatList', 'chatDetail'
            const [currentDay, setCurrentDay] = useState(null); 
            const [notifications, setNotifications] = useState([]);
            const [unreadCount, setUnreadCount] = useState(0);
            const [countdown, setCountdown] = useState("");
            const [typing, setTyping] = useState(false);
            const [inputText, setInputText] = useState("");
            const [testMode, setTestMode] = useState(false);
            
            const chatEndRef = useRef(null);

            useEffect(() => {
                const t = setInterval(() => {
                    const target = new Date("Dec 24, 2025 18:00:00").getTime();
                    const diff = target - new Date().getTime();
                    if (diff > 0) {
                        const d = Math.floor(diff / (86400000));
                        setCountdown(`M√©g ${d} nap kar√°csonyig`);
                    } else setCountdown("BOLDOG KAR√ÅCSONYT!");
                }, 1000);
                
                const count = unlockedDays.length - Object.values(chatHistory).filter(c => c.seen).length;
                setUnreadCount(Math.max(0, count));
                
                return () => clearInterval(t);
            }, [unlockedDays, chatHistory]);

            useLayoutEffect(() => {
                if(view === 'chatDetail') chatEndRef.current?.scrollIntoView({ behavior: "smooth" });
            }, [chatHistory, view, typing]);

            const addNotification = (name, msg, icon) => {
                const id = Date.now();
                setNotifications(prev => [{id, name, msg, icon}, ...prev]);
                setTimeout(() => setNotifications(prev => prev.filter(n => n.id !== id)), 5000);
            };

            const handleDayClick = (day) => {
                const today = new Date().getDate();
                const isAvailable = testMode || day.id <= today; // Teszt m√≥d
                
                if (isAvailable) {
                    if (!unlockedDays.includes(day.id)) {
                        const newUnlocked = [...unlockedDays, day.id];
                        setUnlockedDays(newUnlocked);
                        localStorage.setItem('openedDays', JSON.stringify(newUnlocked));
                        
                        const initialMsgs = day.msgs.map(m => ({ text: m, isMe: false }));
                        const newHist = { ...chatHistory, [day.id]: { msgs: initialMsgs, seen: false } };
                        setChatHistory(newHist);
                        localStorage.setItem('chatHistory3', JSON.stringify(newHist));
                        
                        const char = characters[day.char];
                        addNotification(char.name, day.msgs[0], char.icon);
                        setTimeout(() => addNotification(char.name, day.msgs[1], "üéÅ"), 3000);
                    }
                    setCurrentDay(day);
                    setView('story');
                } else {
                    addNotification("Rendszer", "M√©g nem szabad! ü§´", "üîí");
                }
            };

            const handlePetting = () => {
                if (navigator.vibrate) navigator.vibrate(50);
                addNotification(characters[currentDay.char].name, "H√∫, de j√≥lesett! ‚ù§Ô∏è", "ü•∞");
            };

            const sendMessage = async (text) => {
                if(!text.trim()) return;
                
                const dayId = currentDay.id;
                const oldData = chatHistory[dayId] || { msgs: [] };
                const newMsgs = [...oldData.msgs, { text, isMe: true }];
                
                setChatHistory(prev => ({ ...prev, [dayId]: { ...prev[dayId], msgs: newMsgs } }));
                setInputText("");
                setTyping(true);

                await new Promise(r => setTimeout(r, 2000)); 
                const context = `Mese: ${currentDay.message}. Aj√°nd√©k: ${currentDay.msgs[1]}`;
                const response = await callGemini(apiKey, text, currentDay.char, context); // ITT a kulcs!
                
                setTyping(false);
                const finalMsgs = [...newMsgs, { text: response, isMe: false }];
                const finalHist = { ...chatHistory, [dayId]: { msgs: finalMsgs, seen: true } };
                
                setChatHistory(finalHist);
                localStorage.setItem('chatHistory3', JSON.stringify(finalHist));
            };

            // --- RENDER ---
            return (
                <div className="app-screen">
                    {/* API MODAL */}
                    {showKeyModal && (
                        <div className="api-modal">
                            <div className="api-card">
                                <div style={{fontSize:'40px'}}>üîë</div>
                                <h2>Szia!</h2>
                                <p>K√©rlek add meg a Gemini API kulcsodat, hogy a pl√ºss√∂k tudjanak besz√©lni!</p>
                                <input className="api-input" placeholder="M√°sold ide a kulcsot..." value={tempKey} onChange={e => setTempKey(e.target.value)} />
                                <button className="story-btn" onClick={saveKey}>Ment√©s √©s Ind√≠t√°s</button>
                            </div>
                        </div>
                    )}

                    {/* TESZT M√ìD KAPCSOL√ì (Bal fel√ºl rejtett) */}
                    <div className="test-btn" onClick={() => setTestMode(!testMode)}>‚öôÔ∏è</div>

                    <div className="background"><div className="orb orb-1"></div><div className="orb orb-2"></div></div>
                    {[...Array(40)].map((_,i) => <div key={i} className="snowflake" style={{left:Math.random()*100+'%', animationDuration:(Math.random()*5+3)+'s', width:Math.random()*4+2+'px', height:Math.random()*4+2+'px', animationDelay:Math.random()*5+'s'}}></div>)}

                    <div className="notification-container">
                        {notifications.map(n => (
                            <div key={n.id} className="ios-notification" onClick={() => { setView('chatList'); setNotifications([]); }}>
                                <div className="notif-icon">{n.icon}</div>
                                <div className="notif-content">
                                    <div className="notif-header"><span className="notif-title">{n.name}</span><span className="notif-time">Most</span></div>
                                    <div className="notif-msg">{n.msg}</div>
                                </div>
                            </div>
                        ))}
                    </div>

                    {view === 'grid' && (
                        <>
                            <div className="header">
                                <div className="app-title">MAMA KALEND√ÅRIUMA</div>
                                <div className="main-title">2025</div>
                                <div className="countdown">{countdown}</div>
                            </div>
                            <div className="grid-container">
                                {storyData.map(day => {
                                    const isOpen = unlockedDays.includes(day.id);
                                    const isLocked = day.id > new Date().getDate() && !isOpen && !testMode;
                                    return (
                                        <div key={day.id} className={`day-card ${isOpen ? 'opened' : ''} ${isLocked ? 'locked' : ''}`} onClick={() => !isLocked && handleDayClick(day)}>
                                            {isOpen ? <div className="status-icon">üéÅ</div> : <div className="day-num">{day.id}</div>}
                                            {isLocked && <div style={{position:'absolute', bottom:5, fontSize:10}}>üîí</div>}
                                        </div>
                                    )
                                })}
                            </div>
                            <div className="tab-bar">
                                <div className="tab-item active"><i className="bi bi-grid-fill tab-icon"></i><span className="tab-label">Napt√°r</span></div>
                                <div className="tab-item" onClick={() => setView('chatList')}><div style={{position:'relative'}}><i className="bi bi-chat-fill tab-icon"></i>{unreadCount > 0 && <div className="badge">{unreadCount}</div>}</div><span className="tab-label">√úzenetek</span></div>
                            </div>
                        </>
                    )}

                    {view === 'story' && currentDay && (
                        <div className="modal-overlay" onClick={() => setView('grid')}>
                            <div className="story-card" onClick={e => e.stopPropagation()}>
                                <div className="story-title">üìú {currentDay.title}</div>
                                <div className="story-text">{currentDay.message}</div>
                                <button className="story-btn" onClick={() => { setView('grid'); setTimeout(() => setView('chatDetail'), 300); }}>Megn√©zem az √ºzenetet</button>
                            </div>
                        </div>
                    )}

                    {view === 'chatList' && (
                        <div className="chat-screen" style={{background:'black'}}>
                            <div className="chat-header" style={{justifyContent:'center'}}>
                                <div style={{fontWeight:'bold', fontSize:17}}>√úzenetek</div>
                                <div style={{position:'absolute', left:15, color:'#007AFF', cursor:'pointer'}} onClick={() => setView('grid')}>Bez√°r√°s</div>
                            </div>
                            <div className="chat-body" style={{padding:0}}>
                                {unlockedDays.map(id => {
                                    const day = storyData.find(d => d.id === id);
                                    const char = characters[day.char];
                                    const hist = chatHistory[id] || { msgs: [] };
                                    const lastMsg = hist.msgs[hist.msgs.length-1]?.text || "";
                                    return (
                                        <div key={id} onClick={() => { setCurrentDay(day); setView('chatDetail'); }} style={{display:'flex', gap:15, padding:15, borderBottom:'1px solid #222', cursor:'pointer'}}>
                                            <div style={{fontSize:30}}>{char.icon}</div>
                                            <div style={{flex:1}}>
                                                <div style={{display:'flex', justifyContent:'space-between'}}><span style={{fontWeight:'bold'}}>{char.name}</span><span style={{color:'#666', fontSize:14}}>Most</span></div>
                                                <div style={{color:'#888', fontSize:15, overflow:'hidden', textOverflow:'ellipsis', whiteSpace:'nowrap', width:'250px'}}>{lastMsg}</div>
                                            </div>
                                            {!hist.seen && <div style={{width:10, height:10, borderRadius:'50%', background:'#007AFF', alignSelf:'center'}}></div>}
                                        </div>
                                    )
                                })}
                            </div>
                        </div>
                    )}

                    {view === 'chatDetail' && currentDay && (
                        <div className="chat-screen">
                            <div className="chat-header">
                                <div className="back-btn" onClick={() => setView('chatList')}><i className="bi bi-chevron-left"></i> Vissza</div>
                                <div className="chat-avatar-header" onClick={handlePetting}>
                                    <div className="header-avatar">{characters[currentDay.char].icon}</div>
                                    <div className="header-name">{characters[currentDay.char].name}</div>
                                </div>
                                <div style={{width:50}}></div>
                            </div>
                            <div className="chat-body">
                                <div style={{textAlign:'center', color:'#666', fontSize:11, margin:'10px 0'}}>iMessage ‚Ä¢ Ma</div>
                                {(chatHistory[currentDay.id]?.msgs || []).map((msg, i) => (
                                    <div key={i} className={`message-row ${msg.isMe ? 'me' : 'them'}`}>
                                        {!msg.isMe && <div className="avatar-small">{characters[currentDay.char].icon}</div>}
                                        <div className={`bubble ${msg.isMe ? 'me' : 'them'}`}>{msg.text}</div>
                                    </div>
                                ))}
                                {typing && <div className="typing-bubble"><div className="dot"></div><div className="dot"></div><div className="dot"></div></div>}
                                <div ref={chatEndRef} />
                            </div>
                            {(!chatHistory[currentDay.id]?.msgs.some(m => m.isMe)) && (
                                <div className="reply-chips">
                                    {currentDay.replies?.map((rep, idx) => (
                                        <div key={idx} className="chip" onClick={() => sendMessage(rep.u)}>{rep.u}</div>
                                    ))}
                                </div>
                            )}
                            <div className="chat-input-bar">
                                <input className="ios-input" placeholder="iMessage" value={inputText} onChange={e => setInputText(e.target.value)} />
                                <div className={`send-circle ${!inputText.trim() && !typing ? 'disabled' : ''}`} onClick={() => sendMessage(inputText)}><i className="bi bi-arrow-up"></i></div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
